
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Make the freetextbox work inside an atlas updatpanel - Ivan Porto Carrero</title>
  <meta name="author" content="Ivan Porto Carrero">

  
  <meta name="description" content="A while ago I blogged about making the freetextbox work inside an updatepanel. I didn&#8217;t put the code at that time because it wasn&#8217;t what &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://flanders.co.nz/2006/07/21/make-the-freetextbox-work-inside-an-atlas-updatpanel">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Ivan Porto Carrero" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-240612-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ivan Porto Carrero</a></h1>
  
    <h2>IO(thoughts) foreach (_.propagandize)</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:flanders.co.nz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Make the Freetextbox Work Inside an Atlas Updatpanel</h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-21T00:03:21+02:00" pubdate data-updated="true">Jul 21<span>st</span>, 2006</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>A while ago I blogged about <a href="http://www.flanders.co.nz/Blog/2006/05/22/ATLASContinuedGetTheFreetextboxGoing.aspx">making the freetextbox work inside an updatepanel</a>. I didn&#8217;t put the code at that time because it wasn&#8217;t what it should be.</p>

<p>For the NBlogr engine I do need a working version of that control. And it should work on firefox and internet explorer. Now I have it somewhat working.Â  I thought it would be best to share this, as I&#8217;m sure that there are others that are facing the same problem.</p>

<p>You basically wrap it in an iframe so that it loads it&#8217;s script in a page that does not have an update panel on it.
through javascript you get the value of the entered in the freetextbox and set it in an hiddenfield. and voila you&#8217;re done.</p>

<p>FreeTextBoxWrapper.ascx :</p>

<p>&lt;</p>

<p>iframe</p>

<p>runat
=&#8221;server&#8221;</p>

<p>id
=&#8221;ifrmTxt&#8221;</p>

<p>width
=&#8221;600&#8221;</p>

<p>height
=&#8221;400&#8221;</p>

<p>frameborder
=&#8221;0&#8221;</p>

<blockquote><p>iframe</p></blockquote>

<p>&lt;</p>

<p>asp
:
HiddenField</p>

<p>ID
=&#8221;hfFtbValue&#8221;</p>

<p>runat
=&#8221;server&#8221;</p>

<p>/></p>

<p>And the codebehind for the ascx :</p>

<p>12 [ValidationProperty(&#8220;Text&#8221;)]</p>

<p>13 publicpartialclassApp_Components_FreeTextBoxWrapper : System.Web.UI.UserControl</p>

<p>14 {</p>

<p>15 publicstringText</p>

<p>16 {</p>

<p>17 get</p>

<p>18 {</p>

<p>19 returnhfFtbValue.Value;</p>

<p>20 }</p>

<p>21 set</p>

<p>22 {</p>

<p>23 hfFtbValue.Value = value;</p>

<p>24 }</p>

<p>25 }</p>

<p>26 publicstringWidth</p>

<p>27 {</p>

<p>28 get</p>

<p>29 {</p>

<p>30 returnifrmTxt.Attributes[&#8220;width&#8221;];</p>

<p>31 }</p>

<p>32 set</p>

<p>33 {</p>

<p>34 ifrmTxt.Attributes[&#8220;width&#8221;] = value;</p>

<p>35 }</p>

<p>36 }</p>

<p>37 publicstringHeight</p>

<p>38 {</p>

<p>39 get</p>

<p>40 {</p>

<p>41 returnifrmTxt.Attributes[&#8220;height&#8221;];</p>

<p>42 }</p>

<p>43 set</p>

<p>44 {</p>

<p>45 ifrmTxt.Attributes[&#8220;height&#8221;] = value;</p>

<p>46 }</p>

<p>47 }</p>

<p>48 protectedvoidPage_Load(objectsender, EventArgse)</p>

<p>49 {</p>

<p>50 //load the freetextbox page that has no theme and no masterpage set. The background color is the one I chose to blend in with my design</p>

<p>51 ifrmTxt.Attributes[&#8220;Src&#8221;] = ResolveUrl(string.Format(&#8220;~/App_Components/FreeTextBox.aspx?hf={0}&amp;w={1}&amp;h={2}&#8221;, hfFtbValue.ClientID,Width,Height));</p>

<p>52 ifrmTxt.Attributes[&#8220;Name&#8221;] = ifrmTxt.ClientID;</p>

<p>53</p>

<p>54 if (!IsPostBack)</p>

<p>55 {</p>

<p>56 Session[hfFtbValue.ClientID] = hfFtbValue.Value;</p>

<p>57 }</p>

<p>58 }</p>

<p>59</p>

<p>60 protectedoverridevoidOnDataBinding(EventArgse)</p>

<p>61 {</p>

<p>62 base.OnDataBinding(e);</p>

<p>63 Session[hfFtbValue.ClientID] = hfFtbValue.Value;</p>

<p>64 }</p>

<p>65 }</p>

<p>And the page that contains the freetextbox control :</p>

<p>&lt;%</p>

<p>@</p>

<p>Page</p>

<p>Language
=&#8221;C#&#8221;</p>

<p>AutoEventWireup
=&#8221;true&#8221;</p>

<p>Theme
=&#8221;&#8221;</p>

<p>CodeFile
=&#8221;FreeTextBox.aspx.cs&#8221;</p>

<p>Inherits
=&#8221;App_Components_FreeTextBox&#8221;</p>

<p>ValidateRequest
=&#8221;false&#8221;
%></p>

<p>DOCTYPE</p>

<p>html</p>

<p>PUBLIC</p>

<p>&#8221;-//W3C//DTD XHTML 1.0 Transitional//EN&#8221;</p>

<p>&#8220;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&#8221;>
&lt;
html</p>

<p>xmlns
=&#8221;http://www.w3.org/1999/xhtml&#8221;</p>

<blockquote><p>&lt;
head</p></blockquote>

<p>runat
=&#8221;server&#8221;></p>

<p>&lt;
title</p>

<blockquote><p>A wrapper for the freetextbox in an atlas:updatepanel</p></blockquote>

<p>title</p>

<blockquote></blockquote>

<p>&lt;
style</p>

<p>type
=&#8221;text/css&#8221;></p>

<p>body
{</p>

<p>background
:</p>

<h1>ffdaa0</h1>

<p>;//Set your color here</p>

<p>margin
:
0
;
}</p>

<p>style</p>

<blockquote></blockquote>

<p>head</p>

<blockquote><p>&lt;
body</p></blockquote>

<p>&lt;
form</p>

<p>id
=&#8221;form1&#8221;</p>

<p>runat
=&#8221;server&#8221;></p>

<p>&lt;
div</p>

<blockquote></blockquote>

<p>&lt;
FTB
:
FreeTextBox</p>

<p>ID
=&#8221;ftb&#8221;</p>

<p>runat
=&#8221;server&#8221;</p>

<p>SupportFolder
=&#8221;~/&#8221;</p>

<p>ClientSideTextChanged
=&#8221;onFtbClientTextChanged&#8221;></p>

<p>FTB
:
FreeTextBox</p>

<blockquote></blockquote>

<p>div</p>

<blockquote></blockquote>

<p>&lt;
script</p>

<p>type
=&#8221;text/javascript&#8221;></p>

<p>//The lengthy constructor is there so that firefox also knows where to get the text.</p>

<p>function</p>

<p>onFtbClientTextChanged
(){</p>

<p>window
.
parent
.
document
.
getElementById
(
&#8216;&lt;%= MainPageField %>&#8217;
).</p>

<h1>value</h1>

<p>document
.
getElementById
(
&#8216;&lt;%= ftb.ClientID %>_designEditor&#8217;
).
contentWindow
.
document
.
body
.
innerHTML
;
};</p>

<p>if
(
navigator
.
userAgent
.
indexOf
(
&#8220;Firefox&#8221;
)!=-1)</p>

<p>document
.
getElementById
(
&#8220;&lt;%= ftb.ClientID %>_htmlEditorArea&#8221;
).
addEventListener
(
&#8216;change&#8217;
,
onFtbClientTextChanged
,
true
);
//for firefox</p>

<p>script</p>

<blockquote></blockquote>

<p>form</p>

<blockquote></blockquote>

<p>body</p>

<blockquote></blockquote>

<p>html</p>

<blockquote></blockquote>

<p>With it&#8217;s codebehind:</p>

<p>12 publicpartialclassApp_Components_FreeTextBox : System.Web.UI.Page</p>

<p>13 {</p>

<p>14 protectedstringMainPageField;</p>

<p>15</p>

<p>16 protectedvoidPage_Load(objectsender, EventArgse)</p>

<p>17 {</p>

<p>18 MainPageField = Request.QueryString[&#8220;hf&#8221;];</p>

<p>19</p>

<p>20 if (!IsPostBack)</p>

<p>21 {</p>

<p>22 //When the page first loads we need to set the freetextbox with the value from the hiddenfield for databinding etc.</p>

<p>23 stringsetTextScript = string.Empty;</p>

<p>24 if(Request.Browser.Browser != &#8220;IE&#8221;)//for firefox we need to reach the freetextbox design editor to place our html</p>

<p>25 setTextScript = string.Format(&#8220;document.getElementById(&#8216;{0}_designEditor&#8217;).contentWindow.document.body.innerHTML = window.parent.document.getElementById(&#8216;{1}&#8217;).value;\r\n&#8221;, ftb.ClientID, MainPageField);</p>

<p>26 else</p>

<p>27 setTextScript = string.Format(&#8220;document.getElementById(&#8216;{0}&#8217;).innerHTML = window.parent.document.getElementById(&#8216;{1}&#8217;).value;\r\n&#8221;, ftb.ClientID, MainPageField);</p>

<p>28</p>

<p>29 Page.ClientScript.RegisterStartupScript(this.GetType(), &#8220;setText&#8221;, setTextScript, true);</p>

<p>30 ftb.Text = Session[MainPageField].ToString();</p>

<p>31 }</p>

<p>32 //Set the width to 99% so that the freetextbox displays completely</p>

<p>33 ftb.Width = Unit.Percentage(99);</p>

<p>34</p>

<p>35 //Get the height and widht and set the height relative to the width of the iframe (the toolbars move)</p>

<p>36 intheight = int.Parse(Request.QueryString[&#8220;h&#8221;]);</p>

<p>37 intwidth = int.Parse(Request.QueryString[&#8220;w&#8221;]);</p>

<p>38 if (width &lt; 550)</p>

<p>39 ftb.Height = Unit.Pixel(height - 130);</p>

<p>40 elseif (width &lt; 600)</p>

<p>41 ftb.Height = Unit.Pixel(height - 120);</p>

<p>42 else</p>

<p>43 ftb.Height = Unit.Pixel(height - 90);</p>

<p>44</p>

<p>45 }</p>

<p>46</p>

<p>47 }</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

      








  


<time datetime="2006-07-21T00:03:21+02:00" pubdate data-updated="true">Jul 21<span>st</span>, 2006</time>
      

<span class="categories">
  
    <a class='category' href='/categories/-net-2-0/'>.NET 2.0</a>, <a class='category' href='/categories/atlas/'>Atlas</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://flanders.co.nz/2006/07/21/make-the-freetextbox-work-inside-an-atlas-updatpanel/" data-via="casualjim" data-counturl="http://flanders.co.nz/2006/07/21/make-the-freetextbox-work-inside-an-atlas-updatpanel/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2006/07/20/now-heres-an-interesting-idea-with-good-tips-on-raising/" title="Previous Post: Now here's an interesting idea with good tips on raising starting capital for your idea.">&laquo; Now here's an interesting idea with good tips on raising starting capital for your idea.</a>
      
      
        <a class="basic-alignment right" href="/2006/07/23/congrats-to-tim-and-his-wife-with-their-new-baby/" title="Next Post: Congrats to Tim and his wife with their new baby">Congrats to Tim and his wife with their new baby &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/09/03/scalatra-is-a-dsl-in-a-string/">Scalatra is a DSL in a string</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/01/backchat-developers/">work for backchat</a>
      </li>
    
      <li class="post">
        <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
      </li>
    
      <li class="post">
        <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
      </li>
    
      <li class="post">
        <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/casualjim">@casualjim</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'casualjim',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("casualjim", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/casualjim" class="twitter-follow-button" data-show-count="false">Follow @casualjim</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/casualjim?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/casualjim">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/106536131996809745163?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Ivan Porto Carrero -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'casualjim';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
