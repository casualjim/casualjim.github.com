
<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <meta charset="utf-8">
  <title>Ivan Porto Carrero</title>
  <meta name="author" content="Ivan Porto Carrero">

  
  <meta name="description" content="This morning I found an announcement for the visual studio tools gallery. I went and had a look they have collected heaps of tools, some free most of &hellip;">
  

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- http://t.co/dKP3o1e -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="canonical" href="http://flanders.co.nz/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/css/base.css" rel="stylesheet" type="text/css">
  <link href="/css/skeleton.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">
  <link href="/css/style.css" rel="stylesheet" type="text/css">
  <link href="/css/skins/blue.css" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

  <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>  
  <script src="/js/modernizr.js" type="text/javascript"></script>
  <script src="/js/jquery.easing.1.3.js" type="text/javascript"></script>
  <script type="text/javascript" src="/js/jquery.illuminate.0.7.min.js"></script>
  <!-- tweet
  <script type="text/javascript" src="/js/tweet/twitter.js"></script>
  <script type="text/javascript" src="/js/tweet/setting.js"></script> -->
  
  <script type="text/javascript" src="/js/custom.js"></script>
  <link href="/atom.xml" rel="alternate" title="Ivan Porto Carrero" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-240612-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <div id="wrapper">
    <header role="banner"> <div class="container">
    <div class="row clearfix">
      <hdgroup>
        <div class="four columns">
          <div class="logo">
            <img src="/images/logo.png" alt="" />
            <h2>Rants &amp; ramblings</h2>
          </div>  
        </div>
      </hdgroup>
      <nav role="navigation"><!-- <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:flanders.co.nz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
   -->
<ul>
  <li>
    <a href="/">Home
      <span>Homepage</span>
    </a>    
  </li>
  <li>
    <a href="/archives">Archives
      <span>Articles</span>
    </a>    
  </li>
  <li>
    <a href="/projects">Projects
      <span>Open-Source</span>
    </a>    
  </li>
  <li>
    <a href="/about">About me
      <span>Introduction</span>
    </a>    
  </li>
</ul>
</nav>

    </div>
  </div>  
<!-- <hgroup>
  <h1><a href="/">Ivan Porto Carrero</a></h1>
  
    <h2>IO(thoughts) foreach (_.propagandize)</h2>
  
</hgroup>
 -->
</header>
    <div class="container bodycontent">
      <div class="row clearfix">
        <div class="sixteen columns headline">
          <h2>Ivan Porto Carrero</h2>
          <p class="italic">IO(thoughts) foreach (_.propagandize)</p>
        </div>
      </div>  

      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <!-- start of row -->
      <div class="row clearfix">
        <div class="sixteen columns">
          <!-- twitter feed -->
          <div class="twitter_feed">
            <ul class="tweet_list"></ul>
          </div>
        </div>
      </div>  
      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <div id="maincontent" class="clearfix">
        <div class="five columns">  
  <aside class="left-sidebar">
    
        
<div class="widget row">
  <h5>Search form</h5>  
  <div id="search-form">
    <form action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:flanders.co.nz" />
        <input id="search-box" type="text" name="q" results="0" placeholder="Search"/>
        <input type="submit" value="Search" id="search-button" />
        <div class="clear"></div>
      </fieldset>
    </form>
  </div>
</div>
   <section>
  <div class="widget row">
    <h5>Recent Posts</h5>  
    <ul id="recent_posts">
      
        <li class="post">
          <a href="/2011/08/01/backchat-developers/">work for backchat</a>
        </li>
      
        <li class="post">
          <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
        </li>
      
        <li class="post">
          <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
        </li>
      
        <li class="post">
          <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
        </li>
      
        <li class="post">
          <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
        </li>
      
    </ul>
  </div>
</section>

<section>
  <div class="widget row">
    <h5>GitHub Repos</h5>
    <ul id="gh_repos">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    
    <a href="https://github.com/casualjim">@casualjim</a> on GitHub
    
  </div>
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = 'javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'casualjim',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"></script>
</section>


<section>
  <div class="widget row">
    <h5>Latest Tweets</h5>
    <ul id="tweets">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    <script type="text/javascript">
      $(document).ready(function(){
        // getTwitterFeed("casualjim", 4, false);
      });
    </script>
    
      <a href="http://twitter.com/casualjim" class="twitter-follow-button" data-show-count="false">Follow @casualjim</a>
    
  </div>
</section>


<section>
  <div class="widget row">
    <h5>On Delicious</h5>
    <div id="delicious"></div>
    <script type="text/javascript" src="http://feeds.delicious.com/v2/json/casualjim?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
    <p><a href="http://delicious.com/casualjim">My Delicious Bookmarks &raquo;</a></p>
  </div>
</section>


<section class="googleplus">
  <div class="widget row">
    <h5>
      <a href="https://plus.google.com/106536131996809745163?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h5>
  </div>
</section>



    
  </aside>
</div>
<div class="eleven columns">
<div class="blog-index">
  
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">27</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/27/visual-studio-gallery/" title="">Visual Studio Gallery</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>This morning I found an announcement for the <a href="http://visualstudiogallery.com">visual studio tools gallery</a>. I went and had a look they have collected heaps of tools, some free most of them not into a website.</p>

<p>I promptly downloaded a couple of tools. One of them is something I recently discovered I need, local history. That is in between check-ins a file can also change but that isn&#8217;t recorded in source control so i can&#8217;t revert or view differences. Turns out that there is a <a href="http://www.codeplex.com/VLH2005/">project on codeplex</a> that allows you to do just that. It&#8217;s called local history :)</p>

<p><img src="http://www.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=VLH2005&amp;DownloadId=26632" alt="" /></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">27</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/27/consuming-youtube-using-xlinq/" title="">Consuming YouTube Using XLinq</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I had to implement an integration with youtube for a client yesterday. Google provides API&#8217;s but they are for Java and PHP. I&#8217;m using C# for this project. So I decided to use XLinq to fetch the feeds and parse them into classes for what I needed.</p>

<p>I only need titles, movies and a thumbnail for each item. So I haven&#8217;t implemented all of the properties. And I am impressed. From having no exposure to XLinq whatsoever to having it parse feeds and being able to use those feeds in my monorail application took me about an hour. Since this is the very first time I use XLinq I imagine there is room for improvement, please tell me so when I&#8217;m wrong.</p>

<p>The classes I show here can be used as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">YouTubePlayList</span><span class="p">.</span><span class="n">LoadForUser</span><span class="p">(</span><span class="s">&quot;&lt;&lt;username&gt;&gt;&quot;</span><span class="p">).</span><span class="n">ForEach</span><span class="p">(</span><span class="n">pl</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;&lt;span style=&quot;</span><span class="n">color</span><span class="p">:</span> <span class="n">blue</span><span class="s">&quot;&gt;&quot;</span> <span class="p">+</span> <span class="n">pl</span><span class="p">.</span><span class="n">Id</span> <span class="p">+</span> <span class="s">&quot;&lt;/span&gt;&lt;br&gt;&lt;/br&gt;&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="n">http</span><span class="p">:</span><span class="c1">//gdata.youtube.com/feeds/api/playlists/&lt;&lt;playlistid&gt;;</span>
</span><span class='line'><span class="n">YouTubeCollection</span><span class="p">.</span><span class="n">LoadFrom</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">ForEach</span><span class="p">(</span><span class="n">yt</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">yt</span><span class="p">.</span><span class="n">Title</span> <span class="p">+</span> <span class="s">&quot;, &quot;</span> <span class="p">+</span> <span class="n">yt</span><span class="p">.</span><span class="n">MovieUrl</span> <span class="p">+</span> <span class="s">&quot;&lt;br&gt;&lt;/br&gt;&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">YouTubeCollection</span> <span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">YouTubeItem</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nf">YouTubeCollection</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">YouTubeCollection</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">YouTubeItem</span><span class="p">&gt;</span> <span class="n">collection</span><span class="p">)</span>
</span><span class='line'>        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">YouTubeCollection</span> <span class="nf">LoadFrom</span><span class="p">(</span><span class="kt">string</span> <span class="n">uri</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">feed</span> <span class="p">=</span> <span class="n">XElement</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">XNamespace</span> <span class="n">ns</span> <span class="p">=</span> <span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">XNamespace</span> <span class="n">media</span> <span class="p">=</span> <span class="s">&quot;http://search.yahoo.com/mrss/&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">YouTubeCollection</span><span class="p">(</span><span class="k">from</span> <span class="n">item</span> <span class="k">in</span> <span class="n">feed</span><span class="p">.</span><span class="n">Elements</span><span class="p">(</span><span class="n">ns</span> <span class="p">+</span> <span class="s">&quot;entry&quot;</span><span class="p">).</span><span class="n">Elements</span><span class="p">(</span><span class="n">media</span> <span class="p">+</span> <span class="s">&quot;group&quot;</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">select</span> <span class="k">new</span> <span class="n">YouTubeItem</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                        <span class="n">Title</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="n">media</span> <span class="p">+</span> <span class="s">&quot;title&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">MovieUrl</span> <span class="p">=</span> <span class="p">(</span><span class="k">from</span> <span class="n">el</span> <span class="k">in</span> <span class="n">item</span><span class="p">.</span><span class="n">Elements</span><span class="p">(</span><span class="n">media</span> <span class="p">+</span> <span class="s">&quot;content&quot;</span><span class="p">)</span>
</span><span class='line'>                                 <span class="k">where</span> <span class="n">el</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">).</span><span class="n">Value</span> <span class="p">==</span> <span class="s">&quot;application/x-shockwave-flash&quot;</span>
</span><span class='line'>                                 <span class="k">select</span> <span class="n">el</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;url&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">).</span><span class="n">First</span><span class="p">(),</span>
</span><span class='line'>                         <span class="n">ThumbnailUrl</span> <span class="p">=</span> <span class="p">(</span><span class="k">from</span> <span class="n">el</span> <span class="k">in</span> <span class="n">item</span><span class="p">.</span><span class="n">Elements</span><span class="p">(</span><span class="n">media</span> <span class="p">+</span> <span class="s">&quot;thumbnail&quot;</span><span class="p">)</span>
</span><span class='line'>                                         <span class="k">select</span> <span class="n">el</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;url&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">).</span><span class="n">First</span><span class="p">()</span>
</span><span class='line'>                    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">YouTubePlayList</span> <span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">YouTubePlayListItem</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nf">YouTubePlayList</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">YouTubePlayList</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">YouTubePlayListItem</span><span class="p">&gt;</span> <span class="n">collection</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">YouTubePlayList</span> <span class="nf">LoadForUser</span><span class="p">(</span><span class="kt">string</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;http://gdata.youtube.com/feeds/api/users/{0}/playlists&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">feed</span> <span class="p">=</span> <span class="n">XElement</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">XNamespace</span> <span class="n">ns</span> <span class="p">=</span> <span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">XNamespace</span> <span class="n">gd</span> <span class="p">=</span> <span class="s">&quot;http://schemas.google.com/g/2005&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">YouTubePlayList</span><span class="p">(</span><span class="k">from</span> <span class="n">item</span> <span class="k">in</span> <span class="n">feed</span><span class="p">.</span><span class="n">Elements</span><span class="p">(</span><span class="n">ns</span> <span class="p">+</span> <span class="s">&quot;entry&quot;</span><span class="p">)</span>
</span><span class='line'>                                       <span class="k">select</span> <span class="k">new</span> <span class="n">YouTubePlayListItem</span>
</span><span class='line'>                                         <span class="p">{</span>
</span><span class='line'>                                             <span class="n">Name</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="n">ns</span> <span class="p">+</span> <span class="s">&quot;title&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">Id</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="n">gd</span> <span class="p">+</span> <span class="s">&quot;feedLink&quot;</span><span class="p">).</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;href&quot;</span><span class="p">).</span><span class="n">Value</span>
</span><span class='line'>                                         <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[DataContract]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">YouTubePlayListItem</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [DataMember]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="na">    [DataMember]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[DataContract]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">YouTubeItem</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="kt">string</span> <span class="n">_id</span><span class="p">;</span>
</span><span class='line'><span class="na">    [DataMember]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Id</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">get</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">MovieUrl</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;/&#39;</span><span class="p">).</span><span class="n">Last</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">set</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">_id</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [DataMember]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="na">    </span>
</span><span class='line'><span class="na">    [DataMember]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">MovieUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="na">    </span>
</span><span class='line'><span class="na">    [DataMember]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">ThumbnailUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">09</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/09/using-ruby-to-generate-lightspeed-models-part-4-again/" title="">Using Ruby to Generate LightSpeed Models - Part 4</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p><strong><a href="http://flanders.co.nz/2008/04/09/updated-my-lightspeed-model-generator/">UPDATE</a>: I have an update <a href="http://flanders.co.nz/2008/04/09/updated-my-lightspeed-model-generator/">here</a> with a new version and the location on google code where the project is hosted now.</strong></p>

<p>In the previous 3 parts (<a href="http://flanders.co.nz/blog/archive/2008/02/05/using-ruby-to-generate-lightspeed-models---part-1.aspx">part 1</a>, <a href="http://flanders.co.nz/blog/archive/2008/02/05/using-ruby-to-generate-lightspeed-models.aspx">part 2</a>, <a href="http://flanders.co.nz/blog/archive/2008/02/06/using-ruby-to-generate-lightspeed-models---part-3.aspx">part 3</a>) we talked about getting the meta data out of the database and generating the lightspeed entities in memory.</p>

<p>I won&#8217;t put the code listings up in this blog post but instead will give you a <a href="http://flanders.co.nz/wp-content/uploads/2008/04/generate_ls_models.zip">link</a> to the complete code :) You can download the express edition of <a href="http://www.mindscape.co.nz/Products/lightspeed/default.aspx">LightSpeed</a> and try it for yourself if you want.</p>

<p>Instead I&#8217;ll talk about how you can use the ruby script to generate the models from an existing database.</p>

<p>It adds the generated files to the visual studio project file in the same directory or you can specify one.</p>

<p>Currently it only supports Sql Server 2005. You need to create a project first in visual studio so we have a project file to add items to.</p>

<p>To use it you have to tell it which database it has to find by putting a database.yml file in your visual studio project directory.</p>

<p>The content of that database.yml file may look as follows</p>

<h1>on windows you can use the following connection string</h1>

<pre><code>#
# sqlserver:
# database: northwind
# host: localhost
# username: sa
# password: MaybePassword123
#
#
# on OSX and Linux you can connect to sql server through odbc (iODBC or unixODBC in combination with FreeTDS)
#
# sqlserver:
# dsn: NorthwindSql
# username: sa
# password: MaybePassword123
</code></pre>

<p>when you&#8217;ve done that you can execute it like shown in the screenshot below:</p>

<p><a href="http://flanders.co.nz/blog/images/UsingRubytoGenerateLightSpeedModelsPart4_1018B/Terminalscreenshot.jpg"><img src="http://flanders.co.nz/blog/images/UsingRubytoGenerateLightSpeedModelsPart4_1018B/Terminalscreenshot_thumb.jpg" alt="Terminal-screenshot" /></a></p>

<p>I have a database.yml file in the directory and I execute the command ruby &lt;> on linux and OSX you can chmod +x that path and then you don&#8217;t have to type ruby anymore.</p>

<p>That will generate the models for your database provided that your database conforms to the conventions needed for LightSpeed.</p>

<p>The next step would be to open visuals studio and build the project. The files got added in visual studio every entity are 2 files one with the generated code and one empty one that you can use to implement behavior on the model if you would want to.</p>

<p>The first picture shows how the solution explorer looks and the second one shows the results of the build without having touched one file after generation.</p>

<p>In the download there is a folder db which contains a slightly modified script from the Northwind database that comes with the samples for lightspeed. I used that database because it has every type of relationship and the script did conform to the lightspeed conventions :)</p>

<p><a href="http://flanders.co.nz/blog/images/UsingRubytoGenerateLightSpeedModelsPart4_1018B/LightSpeedGenerateTest.jpg"><img src="http://flanders.co.nz/blog/images/UsingRubytoGenerateLightSpeedModelsPart4_1018B/LightSpeedGenerateTest_thumb.jpg" alt="LightSpeedGenerateTest" /></a></p>

<p><a href="http://flanders.co.nz/blog/images/UsingRubytoGenerateLightSpeedModelsPart4_1018B/LightSpeedGenerateTestBuildResult.jpg"><img src="http://flanders.co.nz/blog/images/UsingRubytoGenerateLightSpeedModelsPart4_1018B/LightSpeedGenerateTestBuildResult_thumb.jpg" alt="LightSpeedGenerateTestBuildResult" /></a></p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2008%2f02%2f09%2fusing-ruby-to-generate-lightspeed-models---part-4-again.aspx"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2008%2f02%2f09%2fusing-ruby-to-generate-lightspeed-models---part-4-again.aspx" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">07</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/07/more-on-mac-keybindings/" title="">More on Mac KeyBindings</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>The biggest problem so far I&#8217;ve had when switching from windows to a mac were the shortcut keys, and mostly the inconsistency thereof. It turns out there is a way to manipulate the keybindings for all cocoa apps, which should make them consistent across all good cocoa citizens. Firefox isn&#8217;t one of those citizens neither is firefox 3.0.</p>

<p>I uninstalled quicksilver because I couldn&#8217;t work out what it would do for me and didn&#8217;t want to spend time figuring it out either. This liberated my ctrl-space for visual studio.  I remapped alt-insert to alt-i and that works for me. Then I brought some consistency in the way my keys behave across all cocoa apps.</p>

<p>I solved my problem with the shortcut keys by following the instructions that can be found in the following posts.    <br/>
They talk about editing a file by hand and saving it, but for those that like a GUI there is one for it.</p>

<p>The GUI application: <a href="http://www.cocoabits.com/KeyBindingsEditor/">KeyBindingsEditor</a></p>

<p>The links with some instructions and background information.</p>

<p><a href="http://blog.macromates.com/2005/key-bindings-for-switchers/">http://blog.macromates.com/2005/key-bindings-for-switchers/</a></p>

<p><a href="http://www.hcs.harvard.edu/~jrus/site/cocoa-text.html">http://www.hcs.harvard.edu/~jrus/site/cocoa-text.html</a></p>

<p>The last post lists a couple of predefined keybinding files like one for emacs</p>

<p><a href="http://www.hcs.harvard.edu/~jrus/site/KeyBindings/Emacs%20Esc%20Bindings.dict">http://www.hcs.harvard.edu/~jrus/site/KeyBindings/Emacs%20Esc%20Bindings.dict</a></p>

<p>or windows key bindings</p>

<p><a href="http://www.hcs.harvard.edu/~jrus/site/KeyBindings/Emacs%20Esc%20Bindings.dict">http://www.hcs.harvard.edu/~jrus/site/KeyBindings/Emacs%20Esc%20Bindings.dict</a></p>

<p>Guess which ones I took and it&#8217;s not emacs ;) I actually just took a couple of keybindings. The ones that I use the most</p>

<pre><code>/***** ARROWS *****/ 
</code></pre>

<p>    &#8221;<sup>\UF700&#8221;  </sup> = &#8220;moveToBeginningOfParagraph:&#8221;;    /<em> C-up         Move to beginning of paragraph </em>/   <br/>
    &#8221;<sup>\UF701&#8221;  </sup> = &#8220;moveToEndOfParagraph:&#8221;;          /<em> C-down       Move to end of paragraph </em>/</p>

<p>    &#8221;<sup>$\UF700&#8221; </sup> = &#8220;moveToBeginningOfParagraphAndModifySelection:&#8221;;   <br/>
                                                    /<em> C-Shft-up    Select to beginning of paragraph </em>/    <br/>
    &#8221;<sup>$\UF701&#8221; </sup> = &#8220;moveToEndOfParagraphAndModifySelection:&#8221;;    <br/>
                                                    /<em> C-Shft-down  Select to end of paragraph </em>/</p>

<p>    &#8221;<sup>\UF702&#8221;  </sup> = &#8220;moveWordLeft:&#8221;;                  /<em> C-left       Move word left </em>/   <br/>
    &#8221;<sup>\UF703&#8221;  </sup> = &#8220;moveWordRight:&#8221;;                 /<em> C-right      Move word right </em>/</p>

<p>    &#8220;$<sup>\UF702&#8221; </sup> = &#8220;moveWordLeftAndModifySelection:&#8221;;   <br/>
                                                    /<em> C-Shft-left  Select word left </em>/    <br/>
    &#8220;$<sup>\UF703&#8221; </sup> = &#8220;moveWordRightAndModifySelection:&#8221;;    <br/>
                                                    /<em> C-Shft-right Select word right </em>/</p>

<p>/<strong><strong><em> CTRL + LETTERS </em></strong></strong>/</p>

<p>    &#8221;<sup>a&#8221;       </sup> = &#8220;selectAll:&#8221;;                     /<em> C-a          Select all </em>/</p>

<p>    &#8221;<sup>x&#8221;       </sup> = &#8220;cut:&#8221;;                           /<em> C-x          Cut </em>/   <br/>
    &#8221;<sup>c&#8221;       </sup> = &#8220;copy:&#8221;;                          /<em> C-c          Copy </em>/    <br/>
    &#8221;<sup>v&#8221;       </sup> = &#8220;paste:&#8221;;                         /<em> C-v          Paste </em>/</p>

<p>    &#8221;<sup>z&#8221;       </sup> = &#8220;undo:&#8221;;                          /<em> C-z          Undo </em>/   <br/>
    &#8221;<sup>y&#8221;       </sup> = &#8220;redo:&#8221;;                          /<em> C-y          Redo </em>/</p>

<p>    &#8221;<sup>s&#8221;       </sup> = &#8220;save:&#8221;;                          /<em> C-s          Save </em>/   <br/>
    &#8221;<sup>S&#8221;       </sup> = &#8220;saveAs:&#8221;;                        /<em> C-Shft-s     Save as </em>/    <br/>
 </p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">06</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/06/on-software-development-the-myth-of-no-maintenance-etc/" title="">On Software Development: The Myth of No Maintenance Etc.</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p><a href="http://codebetter.com/blogs/jeremy.miller/">Jeremy Miller</a> put a very intersting post up about the <a href="http://codebetter.com/blogs/jeremy.miller/archive/2008/02/06/173994.aspx">First causes in software development</a>  <br/>
While I don&#8217;t always like the how of delivering his messages, I think Jeremy is generally spot on. In fact he seems to voice my thoughts much more eloquently than I ever could. Anyway his post or series of posts is dealing with some of the choices he made concerning tools and development philosophy and it also tries to explain that while these tools seem to work today, there won&#8217;t be anything stopping him if something better comes along.</p>

<p>Now in that article he links to an article by the pragmatic programmers on the principle of DRY and orthogonality. For me the biggest problem of software development is not the techniques or the patterns but it&#8217;s the actual language people use. Till this day I still don&#8217;t know what orthogonality means although I understand what that word means in a development context. There are countless examples where people overcomplicate things by using difficult words, this is just one more. Anyway I digress :)</p>

<p>The article series he&#8217;s referring to is pretty interesting. If you have some time to kill I suggest you read them. It are 10 articles:   <br/>
<a href="http://www.artima.com/intv/fixit.html">Part I - Don&#8217;t live with broken windows</a></p>

<p><a href="http://www.artima.com/intv/dry.html">Part II - Orthogonality and the DRY Principle</a></p>

<p><a href="http://www.artima.com/intv/goodenough.html">Part III - Good enough software</a></p>

<p><a href="http://www.artima.com/intv/metadata.html">Part IV - Abstraction and Detail</a></p>

<p><a href="http://www.artima.com/intv/adapt.html">Part V - Building adaptable systems</a></p>

<p><a href="http://www.artima.com/intv/domain.html">Part VI - Programming close to the domain</a></p>

<p><a href="http://www.artima.com/intv/garden.html">Part VII - Programming is gardening, not engineering</a></p>

<p><a href="http://www.artima.com/intv/tracer.html">Part VIII - Tracer Bullets and Prototypes</a></p>

<p><a href="http://www.artima.com/intv/defense.html">Part IX - Programming defensively</a></p>

<p><a href="http://www.artima.com/intv/plain.html">Part X - Plain text and xml</a></p>

<p> </p>

<p>The reason that I put these links up is not only because they are a great read but also because one of the things they say in one of the articles is that after you wrote 10 lines of code or so you&#8217;re effectively in maintenance mode the green field is gone. And that couldn&#8217;t be more true after I had some internal discussion about it I definitely agree with that statement and as such one of the primary goals of your development should not be on getting it out the door as quickly as possible but building it in such a way that you or somebody else can get in there and make changes without throwing away half the code base.</p>

<p>I hope you enjoy them as much as I did</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">05</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/05/using-ruby-to-generate-lightspeed-models-part-3/" title="">Using Ruby to Generate LightSpeed Models - Part 3</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>First off I&#8217;m writing with windows live writer again, ecto wasn&#8217;t up to the job. It tried to &#8220;clean&#8221; my html, granted it was messy but it should leave my text untouched. The whole editing experience wasn&#8217;t satisfying enough. And Ecto already seemed like the best blog editor for mac, slim pickings indeed. From my tools I expect foremost that they stay out of my way and it didn&#8217;t. I just talked with <a href="http://codeclimber.net.nz">Simone</a> about looking at making a .NET based client that runs on mono, we&#8217;ll see where that plan goes because I don&#8217;t really have time to do that for the moment.</p>

<p>In the previous posts in this series (<a href="http://flanders.co.nz/blog/archive/2008/02/05/using-ruby-to-generate-lightspeed-models---part-1.aspx">part 1</a>, <a href="http://flanders.co.nz/blog/archive/2008/02/05/using-ruby-to-generate-lightspeed-models.aspx">part 2</a>) we discovered how to connect to the database and how to get the meta data about that database out. Maybe I should also explain why I&#8217;m doing this series with <a href="http://www.mindscape.co.nz/Products/lightspeed/default.aspx">LightSpeed</a> instead of <a href="http://castleproject.org/activerecord/index.html">ActiveRecord</a> from <a href="http://castleproject.org/">Castle</a> or <a href="http://www.subsonicproject.com/">SubSonic</a> or Linq2Sql for that matter. I will definitely touch on all those orms in the coming week, but I started with LightSpeed because it&#8217;s the easiest ORM I&#8217;ve ever used.</p>

<p>This post will deal with actually doing something useful with that meta data. Today we&#8217;re going to generate the represenation of the entities and their properties. Tomorrow we&#8217;ll deal with actually generating the files from the the in-memory presentation we&#8217;re generating today.</p>

<p>We&#8217;re going to need 2 classes in addition to the LightSpeedRepository class. One to represent an entity and one to represent a property. The goal is for tomorrow to render the entities as complete as possible with validation attributes etc.</p>

<p>And without further ado here are the specs we&#8217;re going to build:</p>

<pre><code>LightSpeedRepository Conversion      
- should convert a given table to light speed metadata       
- should convert a given table without relations to a light speed entity definition       
- should convert a given table with a m:1 relation to a light speed entity definition       
- should convert a given table with a 1:m relation to a light speed entity definition       
- should convert a given table with a m:n relation to a light speed entity definition 



LightSpeedProperty      
- should allow for a property to be set       
- should return a predicate for booleans       
- should return a predicate for booleans       
- should return a sql type       
- should be a lightSpeed property 



LightSpeedEntity      
- should have properties, has many, belongs to and through associations       
- should create a valid property name if one doesn't exists already in the through association properties       
- should create a valid property name if one doesn't exists already in the has many properties       
- should create a valid property name if one doesn't exists already in the belongs to properties       
- should create a valid property name if one doesn't exists already in the properties       
- should create a valid property name if one already exists in the through association properties       
- should create a valid property name if one already exists in the has many properties       
- should create a valid property name if one already exists in the belongs to properties       
- should create a valid property name if one already exists in the properties       
- should create a valid property name if two already exist in the through association properties       
- should create a valid property name if two already exist in the has many properties       
- should create a valid property name if two already exist in the belongs to properties       
- should create a valid property name if two already exist in the properties
</code></pre>

<p>Let&#8217;s start with looking at the LightSpeedProperty first. The attributes on this class are implemented using some simple <a href="http://en.wikipedia.org/wiki/Metaprogramming">metaprogramming</a>. This class will represent a field in a LightSpeed entity and will take care of rendering that properly into the c# file. We actually create the data in the LightSpeedRepository class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">LightSpeedProperty</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:attributes</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="vi">@attributes</span> <span class="o">=</span> <span class="n">params</span>
</span><span class='line'>    <span class="no">LightSpeedProperty</span><span class="o">.</span><span class="n">create_methods</span> <span class="n">params</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">[]</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</span><span class='line'>    <span class="n">attributes</span><span class="o">[</span><span class="n">attribute</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_methods</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">params</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
</span><span class='line'>      <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">val</span><span class="o">|</span>
</span><span class='line'>        <span class="vi">@attributes</span><span class="o">[</span><span class="n">k</span><span class="o">]=</span> <span class="n">val</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">predicate</span> <span class="o">=</span> <span class="sx">%w(primary_key foreign_key unique nullable)</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">o</span><span class="o">|</span> <span class="n">o</span> <span class="o">===</span> <span class="n">k</span><span class="o">.</span><span class="n">to_s</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">define_method</span><span class="p">(</span><span class="n">predicate</span> <span class="p">?</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">?&quot;</span> <span class="p">:</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>        <span class="vi">@attributes</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the LightSpeed entity class we describe the actual Entity. I monkey patched Array so that I could ask it the question if it has a particular property. To avoid naming conflicts we check for properties that exist already and otherwise give them a generic new name by appending a number.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Array</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">has_property?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>    <span class="n">exists</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hm</span><span class="o">|</span>
</span><span class='line'>      <span class="n">exists</span> <span class="o">=</span> <span class="n">hm</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">==</span> <span class="nb">name</span>
</span><span class='line'>      <span class="k">break</span> <span class="k">if</span> <span class="n">exists</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">exists</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">LightSpeedEntity</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:properties</span><span class="p">,</span> <span class="ss">:belongs_to</span><span class="p">,</span> <span class="ss">:has_many</span><span class="p">,</span> <span class="ss">:through_associations</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:namespace</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="vi">@properties</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="vi">@belongs_to</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="vi">@has_many</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="vi">@through_associations</span> <span class="o">=[]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create_property_name_from</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tname</span> <span class="o">=</span> <span class="n">build_property_name_from</span> <span class="n">from</span><span class="p">,</span> <span class="n">idx</span>
</span><span class='line'>    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">#when the property exists try with a higher number</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">create_property_name_from</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_property?</span><span class="p">(</span><span class="n">tname</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tname</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">has_property?</span><span class="p">(</span><span class="n">tname</span><span class="p">)</span>
</span><span class='line'>      <span class="n">properties</span><span class="o">.</span><span class="n">has_property?</span> <span class="n">tname</span> <span class="ow">or</span> <span class="n">has_many</span><span class="o">.</span><span class="n">has_property?</span> <span class="n">tname</span> <span class="ow">or</span> <span class="n">belongs_to</span><span class="o">.</span><span class="n">has_property?</span> <span class="n">tname</span> <span class="ow">or</span> <span class="n">through_associations</span><span class="o">.</span><span class="n">has_property?</span> <span class="n">tname</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">build_property_name_from</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">from</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="s2">&quot;</span><span class="si">#{</span><span class="n">from</span><span class="si">}#{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And this brings us to our last class of today the Repository class. We mixin the DB::MetaData module we created yesterday. Define a read_only property entities, make sure we can set a namespace for our generated entities. The first step is to transform the meta data into data that we can use to represent a LightSpeed Entity. The second and last step of today is to generate the entities with the lightspeed meta data. We have to skip the primary key because that is defined by convention in LightSpeed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">LightSpeedRepository</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">include</span> <span class="no">DB</span><span class="o">::</span><span class="no">MetaData</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:entities</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:namespace</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">()</span>
</span><span class='line'>    <span class="vi">@entities</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="k">super</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">to_light_speed_meta_data</span>
</span><span class='line'>    <span class="n">tables</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">table</span><span class="o">|</span>
</span><span class='line'>      <span class="n">col_infos</span> <span class="o">=</span> <span class="n">column_info_for</span> <span class="n">table</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">field_infos</span> <span class="o">=</span> <span class="n">col_infos</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">col_info</span><span class="o">|</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="n">col_info</span><span class="o">[</span><span class="ss">:name</span><span class="o">].</span><span class="n">underscore</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:sql_type</span> <span class="o">=&gt;</span> <span class="n">col_info</span><span class="o">[</span><span class="ss">:sql_type</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:max_length</span> <span class="o">=&gt;</span> <span class="n">col_info</span><span class="o">[</span><span class="ss">:max_length</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:nullable</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">col_info</span><span class="o">[</span><span class="ss">:is_nullable</span><span class="o">].</span><span class="n">to_i</span><span class="o">.</span><span class="n">zero?</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:precision</span> <span class="o">=&gt;</span> <span class="n">col_info</span><span class="o">[</span><span class="ss">:precision</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="n">foreign_key?</span><span class="p">(</span><span class="n">col_info</span><span class="p">),</span>
</span><span class='line'>          <span class="ss">:primary_key</span> <span class="o">=&gt;</span> <span class="n">primary_key?</span><span class="p">(</span><span class="n">col_info</span><span class="p">),</span>
</span><span class='line'>          <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">col_info</span><span class="o">[</span><span class="ss">:is_unique</span><span class="o">].</span><span class="n">to_i</span><span class="o">.</span><span class="n">zero?</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">{</span> <span class="ss">:table_name</span> <span class="o">=&gt;</span> <span class="n">table</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="n">table</span><span class="o">[</span><span class="ss">:name</span><span class="o">].</span><span class="n">singularize</span><span class="o">.</span><span class="n">camelize</span><span class="p">,</span> <span class="ss">:fields</span> <span class="o">=&gt;</span> <span class="n">field_infos</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">generate_entities</span>
</span><span class='line'>    <span class="n">meta_data</span> <span class="o">=</span> <span class="n">to_light_speed_meta_data</span>
</span><span class='line'>    <span class="n">meta_data</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">md</span><span class="o">|</span>
</span><span class='line'>      <span class="vi">@entities</span> <span class="o">&lt;&lt;</span> <span class="n">generate_entity</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="vi">@entities</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">generate_entity</span><span class="p">(</span><span class="n">meta_data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">entity</span> <span class="o">=</span> <span class="no">LightSpeedEntity</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">entity</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">meta_data</span><span class="o">[</span><span class="ss">:class_name</span><span class="o">]</span>
</span><span class='line'>    <span class="n">entity</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">meta_data</span><span class="o">[</span><span class="ss">:fields</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">fi</span><span class="o">|</span>
</span><span class='line'>      <span class="n">prop</span> <span class="o">=</span> <span class="no">LightSpeedProperty</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">create_property_name_from</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">underscore</span><span class="o">.</span><span class="n">camelize</span>
</span><span class='line'>      <span class="n">entity</span><span class="o">.</span><span class="n">properties</span> <span class="o">&lt;&lt;</span> <span class="n">prop</span> <span class="k">unless</span> <span class="n">prop</span><span class="o">.</span><span class="n">primary_key?</span>
</span><span class='line'>      <span class="n">entity</span><span class="o">.</span><span class="n">belongs_to</span> <span class="o">&lt;&lt;</span> <span class="n">generate_belongs_to_relation</span><span class="p">(</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span> <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">foreign_key?</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">entity</span><span class="o">.</span><span class="n">has_many</span> <span class="o">=</span> <span class="n">generate_has_many_relations</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">entity</span>
</span><span class='line'>    <span class="n">generate_through_associations</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">entity</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">entity</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">generate_belongs_to_relation</span><span class="p">(</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">field_info</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="n">entity</span><span class="o">.</span><span class="n">create_property_name_from</span><span class="p">(</span><span class="n">field_info</span><span class="o">[</span><span class="ss">:name</span><span class="o">].</span><span class="n">underscore</span><span class="o">.</span><span class="n">humanize</span><span class="o">.</span><span class="n">titleize</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\s/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span><span class='line'>        <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="n">get_belongs_to_table</span><span class="p">(</span><span class="n">meta_data</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span><span class="p">,</span> <span class="n">field_info</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">underscore</span><span class="o">.</span><span class="n">camelize</span><span class="o">.</span><span class="n">singularize</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">generate_has_many_relations</span><span class="p">(</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>
</span><span class='line'>      <span class="n">hms</span> <span class="o">=</span> <span class="n">collect_has_many_relations</span> <span class="n">meta_data</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span>
</span><span class='line'>      <span class="n">hms</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">hm</span><span class="o">|</span>
</span><span class='line'>         <span class="n">hm</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">create_property_name_from</span> <span class="n">hm</span><span class="o">[</span><span class="ss">:class_name</span><span class="o">].</span><span class="n">pluralize</span>
</span><span class='line'>         <span class="n">hm</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">generate_through_associations</span><span class="p">(</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>
</span><span class='line'>      <span class="n">tas</span> <span class="o">=</span> <span class="n">collect_through_associations</span><span class="p">(</span><span class="n">meta_data</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="n">tas</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">ta</span><span class="o">|</span>
</span><span class='line'>        <span class="n">ta</span><span class="o">[</span><span class="ss">:end_tables</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">et</span><span class="o">|</span>
</span><span class='line'>          <span class="n">entity</span><span class="o">.</span><span class="n">through_associations</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
</span><span class='line'>            <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="n">ta</span><span class="o">[</span><span class="ss">:through_table</span><span class="o">].</span><span class="n">classify</span><span class="o">.</span><span class="n">singularize</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="n">et</span><span class="o">.</span><span class="n">camelize</span><span class="o">.</span><span class="n">singularize</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="n">entity</span><span class="o">.</span><span class="n">create_property_name_from</span><span class="p">(</span><span class="n">et</span><span class="o">.</span><span class="n">camelize</span><span class="p">)</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">05</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/05/using-ruby-to-generate-lightspeed-models/" title="">Using Ruby to Generate LightSpeed Models - Part 2</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>This is the <a href="http://flanders.co.nz/blog/archive/2008/02/05/using-ruby-to-generate-lightspeed-models---part-1.aspx"></a>second post in the series on generating <a href="http://www.mindscape.co.nz/Products/lightspeed/default.aspx">LightSpeed</a> entities with the help from ruby.</p>

<p>In the <a href="http://flanders.co.nz/blog/archive/2008/02/05/using-ruby-to-generate-lightspeed-models---part-1.aspx">previous post</a> we connected successfully to the database and were able to execute some sql.</p>

<p>At the end of the series I&#8217;ll make the code downloadable.</p>

<p>Today I&#8217;d like to talk about the metadata we&#8217;ll be needing from the database. We&#8217;re going to need a list of tables, we&#8217;re going to need to know about the columns of each table. Furthermore we want to exclude the primary keys in the case of LightSpeed. And we also want to know about relationships whether they are has many, belongs to or has many and belongs to many.</p>

<p>I put all this in a separate module because I&#8217;ll probably need that meta data for another thing later :). The above requirements translate in the following spec:</p>

<pre><code>LightSpeedRepository DB::MetaData  

- should have meta data  

- should resolve the table name from a string  

- should resolve the table name from a hash  

- should identify a given column as not being a foreign key  

- should identify a foreign key given a valid column info  

- should not identify a given column as being a primary key  

- should identify a given column as being a primary key  

- should not identify a table as a join table under the correct conditions  

- should identify a table as a join table under the correct conditions  

- should return an empty array of has many relations when there are none  

- should return the has many relations given a table  

- should return the end point tables for a given through association  

- should return the through associations  
</code></pre>

<p>The first thing we&#8217;re going to need are the sql statements. At this point I only need the statements for sql 2005 so and these are the ones I used.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sql_statements</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="ss">:tables</span> <span class="o">=&gt;</span> <span class="s2">&quot;SELECT table_name as name FROM information_schema.Tables Where table_type=&#39;Base Table&#39; ORDER BY table_name&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:column_info</span> <span class="o">=&gt;</span> <span class="s2">&quot;select object_name(c.object_id) as table_name, c.column_id, c.name, type_name(system_type_id) as sql_type, max_length, is_nullable, precision, scale, </span>
</span><span class='line'><span class="s2">          convert(bit,(Select COUNT(*) from sys.indexes as i </span>
</span><span class='line'><span class="s2">            inner join sys.index_columns as ic</span>
</span><span class='line'><span class="s2">              on ic.index_id = i.index_id and ic.object_id = i.object_id </span>
</span><span class='line'><span class="s2">            inner join sys.columns as c2 on ic.column_id = c2.column_id and i.object_id = c2.object_id</span>
</span><span class='line'><span class="s2">          WHERE i.is_primary_key = 0 </span>
</span><span class='line'><span class="s2">            and i.is_unique_constraint = 0 and ic.column_id = c.column_id and i.object_id=c.object_id)) as is_index,</span>
</span><span class='line'><span class="s2">          is_identity, </span>
</span><span class='line'><span class="s2">          is_computed, </span>
</span><span class='line'><span class="s2">          convert(bit,(Select Count(*) from sys.indexes as i inner join sys.index_columns as ic</span>
</span><span class='line'><span class="s2">              on ic.index_id = i.index_id and ic.object_id = i.object_id </span>
</span><span class='line'><span class="s2">            inner join sys.columns as c2 on ic.column_id = c2.column_id and i.object_id = c2.object_id</span>
</span><span class='line'><span class="s2">          WHERE (i.is_unique_constraint = 1) and ic.column_id = c.column_id and i.object_id=c.object_id)) as is_unique</span>
</span><span class='line'><span class="s2">          from sys.columns as c</span>
</span><span class='line'><span class="s2">          WHERE object_name(c.object_id)  in (select table_name  FROM information_schema.Tables WHERE table_type = &#39;Base Table&#39;) </span>
</span><span class='line'><span class="s2">          order by table_name&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:primary_keys</span> <span class="o">=&gt;</span> <span class="s2">&quot;SELECT i.name AS index_name,ic.index_column_id,key_ordinal,c.name AS column_name,TYPE_NAME(c.user_type_id)AS column_type </span>
</span><span class='line'><span class="s2">                ,is_identity,OBJECT_NAME(i.object_id) as table_name FROM sys.indexes AS i INNER JOIN sys.index_columns AS ic ON </span>
</span><span class='line'><span class="s2">                i.object_id = ic.object_id AND i.index_id = ic.index_id INNER JOIN sys.columns AS c ON ic.object_id = c.object_id</span>
</span><span class='line'><span class="s2">                AND c.column_id = ic.column_id WHERE i.is_primary_key = 1 order by table_name&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:foreign_keys</span> <span class="o">=&gt;</span> <span class="s2">&quot;SELECT f.name AS foreign_key_name, object_name(f.parent_object_id) AS table_name , col_name(fc.parent_object_id, fc.parent_column_id) AS child_id</span>
</span><span class='line'><span class="s2">                ,object_name (f.referenced_object_id) AS parent_table ,col_name(fc.referenced_object_id, fc.referenced_column_id) AS parent_id FROM sys.foreign_keys AS f</span>
</span><span class='line'><span class="s2">                INNER JOIN sys.foreign_key_columns AS fc ON f.object_id = fc.constraint_object_id where OBJECT_NAME(f.parent_object_id) not in (&#39;sysdiagrams&#39;)  order by table_name&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Those statements contain all the data we need an probably a little bit more too, if we add a little metaprogramming we can have ruby generate that metadata data for us :)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">populate</span>
</span><span class='line'>  <span class="no">DB</span><span class="o">::</span><span class="no">MetaData</span><span class="o">.</span><span class="n">sql_statements</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">instance_variable_set</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="vi">@db</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>              
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">sql_statements</span><span class="o">.</span><span class="n">each_key</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>   <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">_for&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">table</span><span class="o">|</span>
</span><span class='line'>     <span class="nb">send</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>   <span class="k">end</span> <span class="k">unless</span> <span class="n">key</span> <span class="o">==</span> <span class="ss">:tables</span>
</span><span class='line'> <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>So now we&#8217;ve satisfied our first spec the module now contains all the meta data we need. The rest of the specs require far less code than what we wrote here. Below you&#8217;ll find the code needed to satisfy all of the specs. It are just a couple of methods that check some conditions and a couple of predicates we&#8217;re going to need later on. The get_endpoint_tables method is the only one that doesn&#8217;t explain itself easily. That method returns the table names from tables that are the second level in a has many and belongs to many scenario.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">DB</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">MetaData</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:tables</span><span class="p">,</span> <span class="ss">:primary_keys</span><span class="p">,</span> <span class="ss">:foreign_keys</span><span class="p">,</span> <span class="ss">:column_info</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>      <span class="vi">@db</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="no">DbiSqlServer</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>      <span class="n">populate</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">populate</span>
</span><span class='line'>      <span class="no">DB</span><span class="o">::</span><span class="no">MetaData</span><span class="o">.</span><span class="n">sql_statements</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
</span><span class='line'>        <span class="nb">instance_variable_set</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="vi">@db</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>              
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">collect_has_many_relations</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span> <span class="o">=</span> <span class="n">foreign_keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:parent_table</span><span class="o">]</span> <span class="o">==</span>  <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">fks</span><span class="o">.</span><span class="n">collect</span>  <span class="k">do</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span>
</span><span class='line'>        <span class="k">unless</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">].</span><span class="n">nil?</span>
</span><span class='line'>          <span class="p">{</span> <span class="ss">:table_name</span> <span class="o">=&gt;</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">].</span><span class="n">underscore</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">].</span><span class="n">singularize</span><span class="o">.</span><span class="n">underscore</span><span class="o">.</span><span class="n">camelize</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>       <span class="k">end</span><span class="o">.</span><span class="n">compact</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">collect_through_associations</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span> <span class="o">=</span> <span class="n">foreign_keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:parent_table</span><span class="o">]</span> <span class="o">==</span>  <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">fks</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span>
</span><span class='line'>          <span class="p">{</span> <span class="ss">:through_table</span> <span class="o">=&gt;</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">].</span><span class="n">underscore</span><span class="p">,</span> <span class="ss">:end_tables</span> <span class="o">=&gt;</span> <span class="n">get_endpoint_tables</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span> <span class="k">if</span> <span class="n">join_table?</span><span class="p">(</span><span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span><span class="o">.</span><span class="n">compact</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_endpoint_tables</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">through_table</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span> <span class="o">=</span> <span class="n">foreign_keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">(</span><span class="n">through_table</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:parent_table</span><span class="o">]</span> <span class="o">!=</span> <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>  <span class="p">}</span>
</span><span class='line'>      <span class="n">fks</span><span class="o">.</span><span class="n">collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:parent_table</span><span class="o">].</span><span class="n">underscore</span> <span class="k">unless</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:parent_table</span><span class="o">].</span><span class="n">nil?</span>  <span class="p">}</span><span class="o">.</span><span class="n">compact</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_belongs_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span> <span class="o">=</span> <span class="n">foreign_keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span>  <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:child_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">column_name</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">fks</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="ss">:parent_table</span><span class="o">]</span> <span class="k">if</span> <span class="n">fks</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>      <span class="kp">nil</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">join_table?</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span> <span class="o">=</span> <span class="n">foreign_keys_for</span> <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">primary_key?</span><span class="p">(</span><span class="n">column_info</span><span class="p">)</span>
</span><span class='line'>      <span class="n">pks</span> <span class="o">=</span> <span class="n">primary_keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">pk</span><span class="o">|</span> <span class="n">pk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">column_info</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="ow">and</span> <span class="n">pk</span><span class="o">[</span><span class="ss">:column_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">column_info</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">pks</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">foreign_key?</span><span class="p">(</span><span class="n">column_info</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fks</span> <span class="o">=</span> <span class="n">foreign_keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">fk</span><span class="o">|</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">column_info</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="ow">and</span> <span class="n">fk</span><span class="o">[</span><span class="ss">:child_id</span><span class="o">]</span> <span class="o">==</span> <span class="n">column_info</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>  <span class="p">}</span>
</span><span class='line'>      <span class="n">fks</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span class='line'>      <span class="n">table</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="p">?</span> <span class="n">table</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="p">:</span> <span class="n">table</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sql_statements</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="ss">:tables</span> <span class="o">=&gt;</span> <span class="s2">&quot;SELECT table_name as name FROM information_schema.Tables Where table_type=&#39;Base Table&#39; ORDER BY table_name&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:column_info</span> <span class="o">=&gt;</span> <span class="s2">&quot;select object_name(c.object_id) as table_name, c.column_id, c.name, type_name(system_type_id) as sql_type, max_length, is_nullable, precision, scale, </span>
</span><span class='line'><span class="s2">              convert(bit,(Select COUNT(*) from sys.indexes as i </span>
</span><span class='line'><span class="s2">                inner join sys.index_columns as ic</span>
</span><span class='line'><span class="s2">                  on ic.index_id = i.index_id and ic.object_id = i.object_id </span>
</span><span class='line'><span class="s2">                inner join sys.columns as c2 on ic.column_id = c2.column_id and i.object_id = c2.object_id</span>
</span><span class='line'><span class="s2">              WHERE i.is_primary_key = 0 </span>
</span><span class='line'><span class="s2">                and i.is_unique_constraint = 0 and ic.column_id = c.column_id and i.object_id=c.object_id)) as is_index,</span>
</span><span class='line'><span class="s2">              is_identity, </span>
</span><span class='line'><span class="s2">              is_computed, </span>
</span><span class='line'><span class="s2">              convert(bit,(Select Count(*) from sys.indexes as i inner join sys.index_columns as ic</span>
</span><span class='line'><span class="s2">                  on ic.index_id = i.index_id and ic.object_id = i.object_id </span>
</span><span class='line'><span class="s2">                inner join sys.columns as c2 on ic.column_id = c2.column_id and i.object_id = c2.object_id</span>
</span><span class='line'><span class="s2">              WHERE (i.is_unique_constraint = 1) and ic.column_id = c.column_id and i.object_id=c.object_id)) as is_unique</span>
</span><span class='line'><span class="s2">              from sys.columns as c</span>
</span><span class='line'><span class="s2">              WHERE object_name(c.object_id)  in (select table_name  FROM information_schema.Tables WHERE table_type = &#39;Base Table&#39;) </span>
</span><span class='line'><span class="s2">              order by table_name&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:primary_keys</span> <span class="o">=&gt;</span> <span class="s2">&quot;SELECT i.name AS index_name,ic.index_column_id,key_ordinal,c.name AS column_name,TYPE_NAME(c.user_type_id)AS column_type </span>
</span><span class='line'><span class="s2">                    ,is_identity,OBJECT_NAME(i.object_id) as table_name FROM sys.indexes AS i INNER JOIN sys.index_columns AS ic ON </span>
</span><span class='line'><span class="s2">                    i.object_id = ic.object_id AND i.index_id = ic.index_id INNER JOIN sys.columns AS c ON ic.object_id = c.object_id</span>
</span><span class='line'><span class="s2">                    AND c.column_id = ic.column_id WHERE i.is_primary_key = 1 order by table_name&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:foreign_keys</span> <span class="o">=&gt;</span> <span class="s2">&quot;SELECT f.name AS foreign_key_name, object_name(f.parent_object_id) AS table_name , col_name(fc.parent_object_id, fc.parent_column_id) AS child_id</span>
</span><span class='line'><span class="s2">                    ,object_name (f.referenced_object_id) AS parent_table ,col_name(fc.referenced_object_id, fc.referenced_column_id) AS parent_id FROM sys.foreign_keys AS f</span>
</span><span class='line'><span class="s2">                    INNER JOIN sys.foreign_key_columns AS fc ON f.object_id = fc.constraint_object_id where OBJECT_NAME(f.parent_object_id) not in (&#39;sysdiagrams&#39;)  order by table_name&quot;</span>
</span><span class='line'>       <span class="p">}</span>
</span><span class='line'>     <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">sql_statements</span><span class="o">.</span><span class="n">each_key</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>       <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">_for&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">table</span><span class="o">|</span>
</span><span class='line'>         <span class="nb">send</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span><span class="o">[</span><span class="ss">:table_name</span><span class="o">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>       <span class="k">end</span> <span class="k">unless</span> <span class="n">key</span> <span class="o">==</span> <span class="ss">:tables</span>
</span><span class='line'>     <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">05</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/05/compiling-mono-and-ironruby-on-osx-leopard/" title="">Compiling Mono and IronRuby on OSX Leopard</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I tried to compile IronRuby on OS X (leopard) with the dmg I downloaded from the mono website, and that didn&#8217;t work.</p>

<p>I then uninstalled that mono version by running monoUninstall.sh and proceeded to get mono from subversion. I&#8217;m putting these steps on my blog more for future reference when I decide to reinstall my box for some reason.</p>

<p>Download <a href="ftp://ftp.gnu.org/gnu/gettext/gettext-0.17.tar.gz">gettext</a>, <a href="http://pkgconfig.freedesktop.org/releases/pkg-config-0.23.tar.gz">pkgconfig</a> and <a href="ftp://ftp.gtk.org/pub/glib/2.12/glib-2.12.12.tar.bz2">glib2.0</a></p>

<p>extract the archives and build them in the following order gettext, pkgconfig, glib2.0</p>

<pre><code>./configure --prefix=/opt/local
make
sudo make install
</code></pre>

<p>At this point it would be wise to set the PKG_CONFIG_PATH environment variable. I added the following line to ~/.bash_profile</p>

<pre><code>export PKG_CONFIG_PATH="/usr/local/lib/pkgconfig:/opt/local/lib/pkgconfig"
</code></pre>

<p>next it&#8217;s time to check out the mono sources from their repositories</p>

<pre><code>cd ~/
mkdir tools
mkdir mono
svn co svn://anonsvn.mono-project.com/source/trunk/mono
svn co svn://anonsvn.mono-project.com/source/trunk/mcs
svn co svn://anonsvn.mono-project.com/source/trunk/libgdiplus
svn co svn://anonsvn.mono-project.com/source/trunk/moon
svn co svn://anonsvn.mono-project.com/source/trunk/olive
svn co svn://anonsvn.mono-project.com/source/trunk/gtk-sharp
</code></pre>

<p>checking those out will take a while</p>

<p>now go into the mono directory and build mono</p>

<pre><code>cd mono
./autogen.sh --prefix=/opt/local/mono --with-preview=yes --with-moonlight=yes
</code></pre>

<p>&#8211;with-preview enables the .NET 3.5 features that have been implemented so far
&#8211;with-moonlight enables support for moonlight</p>

<pre><code>make
sudo make install
</code></pre>

<p>This will also take some time and when it completes you can check if mono is installed by typing mono -V</p>

<p>That&#8217;s it for mono, now onto IronRuby</p>

<pre><code>cd ~/tools
svn co http://ironruby.rubyforge.org/svn/trunk ironruby
sudo gem install pathname2
rake compile mono=1
</code></pre>

<p>And that should be all :)</p>

<p>UPDATE: I&#8217;ve got <a href="http://flanders.co.nz/2008/12/30/building-ironruby-with-mono-on-osx/">new instructions</a> for building IronRuby</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">04</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/04/using-ruby-to-generate-lightspeed-models-part-1/" title="">Using Ruby to Generate LightSpeed Models - Part 1</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>This is the first in a multi-part post on a little ruby application I wrote to generate models for <a href="http://www.mindscape.co.nz/Products/lightspeed/default.aspx">LightSpeed</a>.</p>

<p>The ultimate goal is to consume the entities we generate in this series with IronRuby and perform some data access.</p>

<p>Today I&#8217;ll post the code I wrote for creating the database connection. At this moment there is only code there to connect tho sql server. But I may want to add providers later if I decide to keep using this code. That&#8217;s why some bits are in a separate module.</p>

<p>This are the specs I wrote for the connection manager. The connection manager is the class that reads the database config, gets a connection and executes sql statements. I think this code is pretty simple so I won&#8217;t put a line-by-line explanation.</p>

<p>It uses DBI to connect to the database and reads out the results of the executed sql statement. In the next post I&#8217;ll talk about getting the metadata that is required from sql server.</p>

<pre><code>DB::DbiSqlServer  
- should return a connection  
- should say it's an ODBC connection when a dsn is provided  
- should return the correct connection string for an ODBC connection
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">DB</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">module</span> <span class="nn">SqlConnectionManager</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">DEFAULT_CONFIG_PATH</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/../config/database.yml&#39;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kp">attr_reader</span> <span class="ss">:connection_string</span><span class="p">,</span> <span class="ss">:connection</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="no">DEFAULT_CONFIG_PATH</span><span class="p">)</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">is_a?</span> <span class="no">Hash</span>
</span><span class='line'>            <span class="n">initialize_config</span> <span class="n">config</span>
</span><span class='line'>          <span class="k">else</span>
</span><span class='line'>            <span class="n">read_config</span> <span class="n">config</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">read_config</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">config_name</span> <span class="o">=</span> <span class="s1">&#39;sqlserver&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">initialize_config</span><span class="p">(</span><span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config_path</span> <span class="o">||</span> <span class="no">DEFAULT_CONFIG_PATH</span><span class="p">))</span><span class="o">[</span><span class="n">config_name</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">initialize_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span class='line'>          <span class="vi">@config</span> <span class="o">=</span> <span class="n">config</span>
</span><span class='line'>            <span class="vi">@connection</span><span class="o">=</span><span class="kp">nil</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">odbc?</span>
</span><span class='line'>          <span class="k">return</span> <span class="kp">true</span> <span class="k">unless</span> <span class="vi">@config</span><span class="o">.</span><span class="n">nil?</span> <span class="o">||</span> <span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;dsn&#39;</span><span class="o">].</span><span class="n">nil?</span>
</span><span class='line'>          <span class="kp">false</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">DbiSqlServer</span>
</span><span class='line'>        <span class="kp">include</span> <span class="no">SqlConnectionManager</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">connection</span>
</span><span class='line'>            <span class="k">if</span> <span class="vi">@connection</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>              <span class="vi">@connection</span> <span class="o">=</span> <span class="no">DBI</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">,</span> <span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="p">,</span> <span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>            <span class="k">end</span>
</span><span class='line'>            <span class="vi">@connection</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">connection_string</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">odbc?</span>
</span><span class='line'>            <span class="s2">&quot;DBI:ODBC:</span><span class="si">#{</span><span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;dsn&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>          <span class="k">else</span>
</span><span class='line'>            <span class="s2">&quot;DBI:ADO:Provider=SQLOLEDB;Data Source=</span><span class="si">#{</span><span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;host&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">;Initial Catalog=</span><span class="si">#{</span><span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;database&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">;User ID=</span><span class="si">#{</span><span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">;Password=</span><span class="si">#{</span><span class="vi">@config</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">;&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">fetch_all</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">)</span>
</span><span class='line'>            <span class="n">result</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>            <span class="n">connection</span><span class="o">.</span><span class="n">execute</span> <span class="n">sql_statement</span> <span class="k">do</span> <span class="o">|</span><span class="n">statement</span><span class="o">|</span>
</span><span class='line'>                <span class="k">while</span> <span class="n">row</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">fetch</span> <span class="k">do</span>
</span><span class='line'>                    <span class="n">r</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>                    <span class="n">row</span><span class="o">.</span><span class="n">each_with_name</span> <span class="k">do</span> <span class="o">|</span><span class="n">val</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>                        <span class="n">r</span><span class="o">[</span><span class="nb">name</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'>                    <span class="k">end</span>
</span><span class='line'>                    <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">r</span>
</span><span class='line'>                <span class="k">end</span>
</span><span class='line'>            <span class="k">end</span>
</span><span class='line'>            <span class="n">result</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">def</span> <span class="nf">execute_non_query</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">)</span>
</span><span class='line'>          <span class="n">connection</span><span class="o">.</span><span class="n">do</span> <span class="n">sql_statement</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">04</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/04/osx-and-resharper-get-in-eachothers-way/" title="">OSX and Resharper Get in Eachothers Way</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>And today I discovered that using unity severly interferes with my flow in visual studio.</p>

<p>I have ctrl-space mapped to quicksilver on mac osx which would mean I have to rebind either autocompletion or quicksilver, and it sure as hell won&#8217;t be my autocompletion. I think it will be too hard to unset that binding in my brain I&#8217;ve been using ctrl-space for about 10 years now, without even thinking about it. I even try to use it in Word but of course that doesn&#8217;t work ;)</p>

<p>The typing speed is also a little bit too sluggish for me to actually enjoy working in visual studio in unity mode. I decided to get back to a ruby project in textmate :)</p>

<p>I&#8217;ll try later on if it&#8217;s doable through full screen mode in fusion; and if that doesn&#8217;t work, I&#8217;ll have no other option than to boot into vista if I have to do .NET work.</p>

<p>There is another key missing from the mac keyboard, the insert key (and I have to admit about this one I&#8217;m definitely not that happy - what were they thinking??). So far the keyboard is the hardest to get used to. I mean those would probably be my most used shortcuts : ctrl - arrow, home, end, alt-insert and i now have to learn how to use different combinations and different ones in every program.</p>

<p>In other news, today i found myself using alt-C and alt-V on my windows keyboard when I wanted to copy paste. I think all the shortcuts have no right or wrong combination but it won&#8217;t be long before I master the ones on the mac that&#8217;s for sure.</p>

<p>I feel a lot better having that off my chest.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  <div class="pagination">
    
      <a class="prev" href="/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/5/">Newer &rarr;</a>
    
  </div>
</div>
</div>


      </div>
    </div>
    <footer role="contentinfo"><!-- start of footer container -->
  <div class="container">
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="twelve columns">
        <div class="logo">
          <img src="/images/logo.png" alt="" />
          <h2>Rants &amp; ramblings</h2>
        </div>
      </div>

      <div class="four columns">        
        <h6>Social networks</h6>
        <ul class="social_network">
          <li class="rollover"><a href="http://facebook.com/ivanportocarrero" class="yellowtip" title="Facebook"><span class="fb-rollover"></span><img src="/images/social/fb.png" alt="" /></a></li>
          <li class="rollover"><a href="http://twitter.com/casualjim" class="yellowtip" title="Follow me"><span class="twitter-rollover"></span><img src="/images/social/twitter.png" alt="" /></a></li>
          <li class="rollover"><a href="https://plus.google.com/u/1/106536131996809745163/posts" class="yellowtip" title="Google plus"><span class="google-rollover"></span><img src="/images/social/google-plus.png" alt="" /></a></li>
        </ul>       
      </div>
    </div>
    <!-- end of row -->
  
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="eight columns">
        <h6>About me</h6>
        <p>
        Welcome to my blog. This is a collection of random thoughts and rants.
        </p>
        <p>
        Allow me to introduce myself. My name is Ivan Porto Carrero and I'm an enthusiastic developer on  Scala, .NET and Ruby.<br />Through this blog I hope I can share some of that passion and maybe help somebody out when they are looking on how to do something.
        </p>
      </div>
      <div class="four columns">
        <h6>Latest posts</h6>
        <ul class="square">
        
          <li>
            <a href="/2011/08/01/backchat-developers/">work for backchat</a>
          </li>
        
          <li>
            <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
          </li>
        
          <li>
            <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
          </li>
        
          <li>
            <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
          </li>
        
          <li>
            <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
          </li>
        
        </ul> 
      </div>
      <div class="four columns">
        <h6>Browse pages</h6>
        <ul class="square">
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archives</a></li>
          <li><a href="/projects">My projects</a></li>
        </ul> 
      </div>
    </div>
    <!-- end of row -->
    

    <!-- start of footer divider -->
    <div class="sixteen columns">
      <div class="footer-divider row"></div>
    </div>  
    <!-- end of footer divider -->
    
    <!-- start of bottoms -->
    <div class="clearfix footnote">
      <div class="eight columns">
        <p class="copyright">Copyright &copy; 2012 - Ivan Porto Carrero - All Right Reserved</p>
      </div>
      <div class="eight columns">
        <p class="align-right"><span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, designed by <a href="http://iweb-studio.com" target="_blank">iwebstudio</a></p>
      </div>
    </div>
    <!-- end of bottoms -->

  </div>
  <!-- end of footer container -->

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'casualjim';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<p id="back-top">
  <a href="#top"><span></span>To top</a>
</p>

</body>
</html>
