
<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <meta charset="utf-8">
  <title>Ivan Porto Carrero</title>
  <meta name="author" content="Ivan Porto Carrero">

  
  <meta name="description" content="Yesterday evening I installed Ubuntu linux because i want something where i can run mono on that is not running on a windows OS. Lately I&#8217;ve &hellip;">
  

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- http://t.co/dKP3o1e -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="canonical" href="http://flanders.co.nz/page/17">
  <link href="/favicon.png" rel="icon">
  <link href="/css/base.css" rel="stylesheet" type="text/css">
  <link href="/css/skeleton.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">
  <link href="/css/style.css" rel="stylesheet" type="text/css">
  <link href="/css/skins/blue.css" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

  <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>  
  <script src="/js/modernizr.js" type="text/javascript"></script>
  <script src="/js/jquery.easing.1.3.js" type="text/javascript"></script>
  <script type="text/javascript" src="/js/jquery.illuminate.0.7.min.js"></script>
  <!-- tweet -->
  <script type="text/javascript" src="/js/tweet/twitter.js"></script>
  <script type="text/javascript" src="/js/tweet/setting.js"></script>
  
  <script type="text/javascript" src="/js/custom.js"></script>
  <link href="/atom.xml" rel="alternate" title="Ivan Porto Carrero" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-240612-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <div id="wrapper">
    <header role="banner"> <div class="container">
    <div class="row clearfix">
      <hdgroup>
        <div class="four columns">
          <div class="logo">
            <img src="/images/logo.png" alt="" />
            <h2>Rants &amp; ramblings</h2>
          </div>  
        </div>
      </hdgroup>
      <nav role="navigation"><!-- <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:flanders.co.nz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
   -->
<ul>
  <li>
    <a href="/">Home
      <span>Homepage</span>
    </a>    
  </li>
  <li>
    <a href="/archives">Archives
      <span>Articles</span>
    </a>    
  </li>
  <li>
    <a href="/projects">Projects
      <span>Open-Source</span>
    </a>    
  </li>
  <li>
    <a href="/about">About me
      <span>Introduction</span>
    </a>    
  </li>
</ul>
</nav>

    </div>
  </div>  
<!-- <hgroup>
  <h1><a href="/">Ivan Porto Carrero</a></h1>
  
    <h2>IO(thoughts) foreach (_.propagandize)</h2>
  
</hgroup>
 -->
</header>
    <div class="container bodycontent">
      <div class="row clearfix">
        <div class="sixteen columns headline">
          <h2>Ivan Porto Carrero</h2>
          <p class="italic">IO(thoughts) foreach (_.propagandize)</p>
        </div>
      </div>  

      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <!-- start of row -->
      <div class="row clearfix">
        <div class="sixteen columns">
          <!-- twitter feed -->
          <div class="twitter_feed">
            <ul class="tweet_list"></ul>
          </div>
        </div>
      </div>  
      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <div id="maincontent" class="clearfix">
        <div class="five columns">  
  <aside class="left-sidebar">
    
        
<div class="widget row">
  <h5>Search form</h5>  
  <div id="search-form">
    <form action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:flanders.co.nz" />
        <input id="search-box" type="text" name="q" results="0" placeholder="Search"/>
        <input type="submit" value="Search" id="search-button" />
        <div class="clear"></div>
      </fieldset>
    </form>
  </div>
</div>
   <section>
  <div class="widget row">
    <h5>Recent Posts</h5>  
    <ul id="recent_posts">
      
        <li class="post">
          <a href="/2011/08/01/backchat-developers/">work for backchat</a>
        </li>
      
        <li class="post">
          <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
        </li>
      
        <li class="post">
          <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
        </li>
      
        <li class="post">
          <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
        </li>
      
        <li class="post">
          <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
        </li>
      
    </ul>
  </div>
</section>

<section>
  <div class="widget row">
    <h5>GitHub Repos</h5>
    <ul id="gh_repos">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    
    <a href="https://github.com/casualjim">@casualjim</a> on GitHub
    
  </div>
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({ user: "casualjim", target: $("#gh_repos"), forks: false, count: 5});
    });
  </script>
</section>


<section>
  <div class="widget row">
    <h5>Latest Tweets</h5>
    <ul id="tweets">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    <script type="text/javascript">
      $(document).ready(function(){
        // getTwitterFeed("casualjim", 4, false);
      });
    </script>
    
      <a href="http://twitter.com/casualjim" class="twitter-follow-button" data-show-count="false">Follow @casualjim</a>
    
  </div>
</section>


<section>
  <div class="widget row">
    <h5>On Delicious</h5>
    <div id="delicious"></div>
    <script type="text/javascript" src="http://feeds.delicious.com/v2/json/casualjim?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
    <p><a href="http://delicious.com/casualjim">My Delicious Bookmarks &raquo;</a></p>
  </div>
</section>


<section class="googleplus">
  <div class="widget row">
    <h5>
      <a href="https://plus.google.com/106536131996809745163?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h5>
  </div>
</section>



    
  </aside>
</div>
<div class="eleven columns">
<div class="blog-index">
  
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">19</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/19/ubuntu-linux-delivers-great-value/" title="">Ubuntu Linux Delivers Great Value</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Yesterday evening I installed <a href="http://www.ubuntu.com/">Ubuntu</a> linux because i want something where i can run mono on that is not running on a windows OS. Lately I&#8217;ve got this thing that I want my apps to work cross-platform etc. So I&#8217;ve been looking into linux type of OS&#8217;es.</p>

<p>The two I like are <a href="http://www.novell.com/linux/">suse</a> and <a href="http://www.ubuntu.com/">ubuntu</a> now. Don&#8217;t really care much about redhat never have.</p>

<p>In my life as an IT professional I&#8217;ve worked with several linux distributions. I don&#8217;t know if <a href="http://www.mandriva.com/">mandrake</a> is still around but those guys were my first linux installation for firewall implementations, until they got the idea to make their software not free anymore.</p>

<p>Anyway back to ubuntu. It isn&#8217;t mac os but it is the easiest linux I&#8217;ve used so far. It took me about 30 minutes to install it on my virtual server. And it took anoter 10 to get mono installed on it.</p>

<p>The experience is a whole lot better than having to fiddle all over the place with settings and conf files.</p>

<p>Also I didn&#8217;t get the questions about root etc.. Yes this distibution is streamlined and works properly.</p>

<p>And now I finally have a real operating system to put on the iMac that runs on our network. Because MacOS 9 isn&#8217;t really networking and Ajax friendly.  The only browser that runs on that iMac is iCab and if you have some experience with iCab then you&#8217;ll know that that is not really worth calling a browser.</p>

<p>You can run download an alternate distro of ubuntu that runs on the iMac architecture.</p>

<p>Yes another thing there were only a couple downloads to chose from not the usual list where you almost need to know your motherboard type to get the right version down.</p>

<p>Below is a screenshot. Look at the folder list on the left. It&#8217;s not your usual confusing bit but this time it has got real indications of what you want to do. :)</p>

<p><a href="http://www.flanders.co.nz/Blog/content/binary/WindowsLiveWriter/Ubuntulinuxdeliversgreatvalue_7979/UbuntuScreen%5B7%5D.png"><img src="http://www.flanders.co.nz/Blog/content/binary/WindowsLiveWriter/Ubuntulinuxdeliversgreatvalue_7979/UbuntuScreen_thumb%5B5%5D.png" alt="" /></a></p>

<p>This doesn&#8217;t mean I will uninstall Vista and start working on linux from now on but I&#8217;m happy about the fact that I don&#8217;t have to deal with Mac OS 9 anymore on the intranet for the browser application.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">19</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/19/globatcom-tactics-scandalous/" title="">Globat.com Tactics Scandalous</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>First off I am not going to link to them in this post because that would be like free advertising.</p>

<p>A couple of months ago I took 2 domainname accounts with them and ever since they have been sending me emails every couple of days telling me i need to upgrade my account to some super hosting plan they provide.</p>

<p>I don&#8217;t need the friggin hostiing because I have my own server running. <br/>
Their constant emailing has made me classify them into a folder that doesn&#8217;t show up in my unread mails.</p>

<p>So the latest tactic, which can be called dodgy at the very least, is to send an email about an automatic upgrade and if you fail to opt-out you get a hosting account @ 40USD/month</p>

<p>The letters they sent (I won&#8217;t be posting all the other mails of course) :</p>

<p>1st e-mail :</p>

<blockquote><p><em>Dear Ivan,</em></p>

<p><em>We would like to extend an incredible money-saving offer for medlr.com to thank you for your continued business. In 10 days from this date, we will be providing you with an upgrade to our new TeraByte Pro(tm) Hosting package at the low cost of just $39.95!</em></p>

<p><em>This amazing promotion is part of our new special upgrade program of hosting services for our loyal customers. The feedback we received about the upgrade program has been overwhelming. We heard from many of our customers who learned about these upgrade promotions too late or through a friend. Many customers then suggested that we utilize an automatic upgrade process along with some form of an additional incentive to initiate these upgrades. Well, we have listened to your feedback and we are ready to act!</em></p>

<p><em>= = = Take Your Domain to the Next Level = = =</em></p>

<p><em>As our dedicated domain customer, you will be receiving an automatic upgrade to Globat.com&#8217;s award-winning hosting services at a highly-discounted price of only $39.95, instead of $95.40! That breaks down to only $3.33 per month, truly a price that won&#8217;t break the bank!</em></p></blockquote>

<p>2nd e-mail: (medlr.com has nothing on it, don&#8217;t follow)</p>

<blockquote><p><em>Dear Ivan,</em></p>

<p><em>Congratulation! As per our previous notices, today we have upgraded your hosting account for </em><a href="http://www.medlr.com"><em>www.medlr.com</em></a><em> to our all new Terabyte Pro™ level and processed your invoice 3629260 in the amount of $39.95 through your credit card account on file.</em></p>

<p><em>You are now utilizing Globat.com&#8217;s industry-leading TeraByte Plus Hosting(TM) solution! With this upgrade you have also locked in your web hosting pricing for as long as your account remains in this program. You have also qualified to receive one free month of web hosting. To claim your free month please go to:</em></p>

<p><em>https://order.globat.com/newOrder/nop_givemonth.pl</em></p>

<p><em>and enter the following coupon code</em></p>

<p><em>FREEMONTH</em></p>

<p><em>into the field provided. Then hit the &#8220;Add My Free Month&#8221; button. Upon completion of this step your free month will automatically be added to your current account renewal date and you can view your next renewal date at:</em></p>

<p><em>https://login.globat.com/cp2/account.php</em></p>

<p><em>or view your receipt for this transaction at:</em></p>

<p><em>https://login.globat.com/cp2/account.php?page=invoices</em></p></blockquote>

<p> </p>

<p>My response in as much words as i want to give them.</p>

<blockquote><p>Excuse me I DON&#8217;T want anything I DID NOT EXPLICITLY ORDER. <br/>
Please cancel your super promotion. I&#8217;ll move my domain names because <br/>
I think these tactics are scandalous.</p>

<p>I&#8217;ll start blogging about it too.. What type of gangsters are you guys. <br/>
Where is it legal that I buy stuff because I did not tell you i didn&#8217;t  want it.</p></blockquote>

<p> </p>

<p>By the time I had finished this email. They already came back to me telling me my money has been refunded.<br/>
I&#8217;m going to post it anyway because I do think that if that is the direction we are heading then I think nobody will every be safe. Becauwe whenever you buy something somewhere it gives the seller the right to sell you more stuff without even approving the buy.</p>

<p>Well, it feels good to get that of my chest. I&#8217;m wondering where these globat people won their award, must be in the gangster syndicate or something, maybe they got it from the Soprano family or something.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">18</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/18/base4-and-castle-the-controller/" title="">Base4 and Castle&#8230; The Controller</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>The next bit for pages in general is that often they represent a list. Often this list is a really long list that you&#8217;d like to page through.</p>

<p>I put this functionality into a generic base controller class. The whole idea of my set up is to provide a technique called progressive enhancement of forms.  In short you create an application that works completely without javascript using hyperlinks for gets and submit buttons etc.  Then you attach some css selector classes to the different bits of functionality and you attach these behaviors to the html elements on your page.</p>

<p>I thought that that is a really nice way of enriching the experience of people that allow it to be enriched ;)  And that is the explanation of the ajaxCall bool variable on some of the methods</p>

<p>The first thing is the interface for the class :</p>

<p>using System;</p>

<p>namespace NBlogr.Presenter</p>

<p>{</p>

<p>    public interface INBlogrController</p>

<p>    {</p>

<p>        bool IsCompositeView{get;}</p>

<p>        void Delete(T item, int pageNumber, int pageSize);</p>

<p>        void Delete(T item, int pageNumber, int pageSize, bool ajaxCall);</p>

<p>        void Edit(Guid Id);</p>

<p>        void Edit(Guid Id, bool ajaxCall);</p>

<p>        void JumpToPage(int pageNumber, int pageSize);</p>

<p>        void JumpToPage(int pageNumber, int pageSize, bool ajaxCall);</p>

<p>        void List();</p>

<p>        void List(bool ajaxCall);</p>

<p>        void NavigateBack(int pageNumber, int pageSize);</p>

<p>        void NavigateFirst(int pageSize);</p>

<p>        void NavigateNext(int pageNumber, int pageSize);</p>

<p>        void NavigateBack(int pageNumber, int pageSize, bool ajaxCall);</p>

<p>        void NavigateFirst(int pageSize, bool ajaxCall);</p>

<p>        void NavigateNext(int pageNumber, int pageSize, bool ajaxCall);</p>

<p>        void Show();</p>

<p>        void Show(bool ajaxCall);</p>

<p>        void Save(T item, int pageNumber, int pageSize);</p>

<p>        void Save(T item, int pageNumber, int pageSize, bool ajaxCall);</p>

<p>        void CreateNew();</p>

<p>        void CreateNew(bool ajaxCall);</p>

<p>    }</p>

<p>}</p>

<p>And the next thing is the base class again :</p>

<p>using System;</p>

<p>using System.Collections.Generic;</p>

<p>using System.Text;</p>

<p>using Base4.Storage;</p>

<p> </p>

<p>namespace NBlogr.Presenter.Abstract</p>

<p>{</p>

<p>    public abstract class AbstractAdminController : AbstractController, INBlogrController where T: class, IItem, new()</p>

<p>    {</p>

<p>        bool compositeView;</p>

<p>        int _pageSize;</p>

<p> </p>

<p>        public AbstractAdminController()</p>

<p>            : base()</p>

<p>        {</p>

<p>            this.compositeView = false;</p>

<p>            _pageSize = 10;</p>

<p>        }</p>

<p> </p>

<p>        public AbstractAdminController(bool compositeView) : base()</p>

<p>        {</p>

<p>            this.compositeView = compositeView;</p>

<p>            _pageSize = 10;</p>

<p>        }</p>

<p> </p>

<p>        internal abstract void getList(int pageNumber, int pageSize, bool skipLayout);</p>

<p> </p>

<p> </p>

<p>        internal void getList(int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            getList(pageNumber, pageSize, false);</p>

<p> </p>

<p>        }</p>

<p>        #region INBlogrController Members</p>

<p> </p>

<p>        public bool IsCompositeView</p>

<p>        {</p>

<p>            get</p>

<p>            {</p>

<p>                return compositeView;</p>

<p>            }</p>

<p>        }</p>

<p>        public int PageSize</p>

<p>        {</p>

<p>            get</p>

<p>            {</p>

<p>                return _pageSize;</p>

<p>            }</p>

<p>            set</p>

<p>            {</p>

<p>                _pageSize = value;</p>

<p>            }</p>

<p>        }</p>

<p> </p>

<p>        public void Delete(T item, int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            Delete(item,pageNumber,pageSize,false);</p>

<p>        }</p>

<p> </p>

<p>        public abstract void Delete(T item, int pageNumber, int pageSize, bool ajaxCall);</p>

<p> </p>

<p>        public void CreateNew()</p>

<p>        {</p>

<p>            CreateNew(false);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void CreateNew(bool ajaxCall)</p>

<p>        {</p>

<p>            Edit(Guid.NewGuid(), ajaxCall);</p>

<p>        }</p>

<p> </p>

<p>        public void Edit(Guid Id)</p>

<p>        {</p>

<p>            Edit(Id, false);</p>

<p>        }</p>

<p> </p>

<p>        public abstract void Edit(Guid Id, bool ajaxCall);</p>

<p> </p>

<p>        public void JumpToPage(int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            getList(pageNumber, pageSize);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void JumpToPage(int pageNumber, int pageSize, bool ajaxCall)</p>

<p>        {</p>

<p>            getList(pageNumber, pageSize, ajaxCall);</p>

<p>        }</p>

<p> </p>

<p>        public void List()</p>

<p>        {</p>

<p>            getList(1, _pageSize);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void List(bool ajaxCall)</p>

<p>        {</p>

<p>            getList(1, _pageSize, ajaxCall);</p>

<p>        }</p>

<p> </p>

<p>        public void NavigateBack(int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            getList(&#8211;pageNumber, pageSize);</p>

<p>        }</p>

<p> </p>

<p>        public void NavigateFirst(int pageSize)</p>

<p>        {</p>

<p>            getList(1, pageSize);</p>

<p>        }</p>

<p> </p>

<p>        public void NavigateNext(int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            getList(++pageNumber, pageSize);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void NavigateBack(int pageNumber, int pageSize, bool ajaxCall)</p>

<p>        {</p>

<p>            getList(&#8211;pageNumber, pageSize, ajaxCall);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void NavigateFirst(int pageSize, bool ajaxCall)</p>

<p>        {</p>

<p>            getList(1, pageSize, ajaxCall);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void NavigateNext(int pageNumber, int pageSize, bool ajaxCall)</p>

<p>        {</p>

<p>            getList(++pageNumber, pageSize, ajaxCall);</p>

<p>        }</p>

<p> </p>

<p>        public void Show()</p>

<p>        {</p>

<p>            getList(1, _pageSize);</p>

<p>        }</p>

<p> </p>

<p>        public virtual void Show(bool ajaxCall)</p>

<p>        {</p>

<p>            getList(1, _pageSize, ajaxCall);</p>

<p>        }</p>

<p> </p>

<p> </p>

<p>        public void Save(T item, int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            Save(item, pageNumber, pageSize, false);</p>

<p>        }</p>

<p> </p>

<p>        public abstract void Save(T item, int pageNumber, int pageSize, bool ajaxCall);</p>

<p> </p>

<p> </p>

<p>        #endregion</p>

<p>    }</p>

<p>}</p>

<p>Now onto the concrete implementation of my controller class</p>

<p> </p>

<p>using System;</p>

<p>using System.Collections.Generic;</p>

<p>using System.Text;</p>

<p>using NBlogr.Core;</p>

<p>using NBlogr.Service;</p>

<p>using Base4.Storage;</p>

<p>using Castle.MonoRail.Framework;</p>

<p>using NBlogr.Common.Base4Integration;</p>

<p>using Castle.Services.Transaction;</p>

<p> </p>

<p>namespace NBlogr.Presenter</p>

<p>{</p>

<p> </p>

<p>    public class BlogController : Abstract.AbstractAdminController<Blog></p>

<p>    {</p>

<p>        BlogService blogService;</p>

<p>        </p>

<p>        public BlogController(IService<Blog> blogService)</p>

<p>            : base(true)</p>

<p>        {</p>

<p>            this.blogService = blogService as BlogService;</p>

<p>             </p>

<p>             </p>

<p>        }</p>

<p> </p>

<p>        private void internalGetList(int pageNumber, int pageSize)</p>

<p>        {</p>

<p>            int pageCount;</p>

<p> </p>

<p>            IItemList<Blog> blog = blogService.GetAll(&#8220;Name&#8221;, pageNumber, pageSize, out pageCount);</p>

<p> </p>

<p>            internalMapProperties(blog , pageNumber,pageSize, pageCount);</p>

<p>        }</p>

<p> </p>

<p>        private void internalMapProperties(IItemList<Blog> blogs, int pageNumber, int pageSize, int pageCount)</p>

<p>        {</p>

<p>            int totalCount = blogs.Count;</p>

<p> </p>

<p>            if (PropertyBag[&#8220;blog&#8221;] == null)</p>

<p>                PropertyBag.Add(&#8220;blog&#8221;, new Blog());</p>

<p>            </p>

<p>            PropertyBag.Add(&#8220;blogs&#8221;, pageNumber);</p>

<p>            PropertyBag.Add(&#8220;index&#8221;, pageNumber);</p>

<p>            PropertyBag.Add(&#8220;count&#8221;, totalCount);</p>

<p>            PropertyBag.Add(&#8220;pageCount&#8221;, pageCount);</p>

<p>            PropertyBag.Add(&#8220;pageSize&#8221;, pageSize);</p>

<p>        }</p>

<p> </p>

<p>        internal override void getList(int pageNumber, int pageSize, bool skipLayout)</p>

<p>        {</p>

<p> </p>

<p>            internalGetList(pageNumber, pageSize);</p>

<p> </p>

<p>            if (!skipLayout)</p>

<p>                RenderView(&#8220;Show&#8221;, false);</p>

<p>            else</p>

<p>                RenderView(&#8220;List&#8221;, true);</p>

<p>        }</p>

<p> </p>

<p> </p>

<p> </p>

<p> </p>

<p>        public override void Edit(Guid Id, bool ajaxCall)</p>

<p>        {</p>

<p>            Blog blog = blogService.GetById(Id);</p>

<p> </p>

<p>            PropertyBag.Add(&#8220;blog&#8221;, blog);</p>

<p>             </p>

<p>            if (!ajaxCall)</p>

<p>            {</p>

<p>                getList(1, 0);</p>

<p>            }</p>

<p>            else</p>

<p>                RenderView(&#8220;Save&#8221;, ajaxCall);</p>

<p> </p>

<p>        }</p>

<p> </p>

<p>        public override void Delete([DataBind(&#8220;blog&#8221;)] Blog item, int pageNumber, int pageSize, bool ajaxCall)</p>

<p>        {</p>

<p>            blogService.Delete(item);</p>

<p> </p>

<p>            if (!ajaxCall)</p>

<p>            {</p>

<p>                getList(1, 0);</p>

<p>            }</p>

<p>            else</p>

<p>                RenderText(getJsonResponse(&#8220;Contract deleted successfully&#8221;));</p>

<p> </p>

<p>        }</p>

<p> </p>

<p>        public override void Save([DataBind(&#8220;blog&#8221;)] Blog item, int pageNumber, int pageSize, bool ajaxCall)</p>

<p>        {</p>

<p>            PropertyBag.Add(&#8220;blog&#8221;, blogService.Save(item));</p>

<p> </p>

<p>            if (!ajaxCall)</p>

<p>            {</p>

<p>                getList(1, 0);</p>

<p>            }</p>

<p>            else</p>

<p>                RenderText(getJsonResponse(&#8220;Contract saved successfully&#8221;));</p>

<p>        }</p>

<p> </p>

<p>        private string getJsonResponse(string message)</p>

<p>        {</p>

<p>            return &#8220;{result: true, content: &#8216;&#8221; + message + &#8220;&#8217;}&#8221;;</p>

<p>        }</p>

<p> </p>

<p>    }</p>

<p>}</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">17</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/17/base4-and-castle-the-service/" title="">Base4 and Castle &#8230; The Service</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p><em>UPDATE: THE SERVICE CLASS HAS CHANGED AGAIN</em><strong>.<br/>
</strong><em>Scratch the update.. it assumes that the object is already in the database which isn&#8217;t always the case. For this type of synchronisation to work I need some more time. So I reverted this back to the old version</em></p>

<p>This post continues my previous posts on using base4 and castle together.</p>

<p>I&#8217;m sorry but there is no Active record in the base4 way of doing things.</p>

<p>The previous posts you would be intrested in can be found here :</p>

<p><a href="http://www.flanders.co.nz/Blog/2006/10/12/HostingBase4InsideYourWebApplication.aspx">Hosting base4 inside your web application<br/>
</a><a href="http://www.flanders.co.nz/Blog/2006/10/16/Base4OnCastleContinuedTheFacility.aspx">Base4 and Castle continued&#8230; The facility</a></p>

<p>Today I want to show you the abstract service class that I use so the controller only talks to the service and never to the dataobject directly. </p>

<p>It is not a very big class but i found it pretty useful.  As it turns out almost all my service classes in a previous project started to look very much alike so I grouped that functionality in an abstract class. There is one thing you have to look out for and that is if you have something like audit fields (Created, LastModified,&#8230;..) you need to first get the object from the datastore and then set just the changed properties on the retrieved object.</p>

<p>The first thing you need is the contract/interface for the service. I expect this interface to grow over time so keep checking NBlogr for updates but this where I am at now :)</p>

<p>using System;</p>

<p>namespace NBlogr.Service</p>

<p>{</p>

<p>    public interface IService</p>

<p>    where T : class, Base4.Storage.IItem, new()</p>

<p>    {</p>

<p>        void Delete(T item);</p>

<p>        Base4.Storage.IItemList GetAll(string sortExpression, int pageNumber, int pageSize, out int pageCount);</p>

<p>        T GetById(Guid Id);</p>

<p>        T Save(T item);</p>

<p>    }</p>

<p>}</p>

<p>And here&#8217;s the abstract class :</p>

<p>using Base4.Storage;</p>

<p>using Castle.Core.Logging;</p>

<p>using NBlogr.Common.Base4Integration;</p>

<p> </p>

<p>using User = NBlogr.Core.User;</p>

<p>using Castle.Services.Transaction;</p>

<p>using Base4.Storage.Utils;</p>

<p> </p>

<p>namespace NBlogr.Service.Abstract</p>

<p>{</p>

<p> </p>

<p>    [Transactional]</p>

<p>    public abstract class AbstractService : IService where T : class,IItem,new()</p>

<p>    {</p>

<p>        internal readonly ILogger logger;</p>

<p>        internal IDataObject dao;</p>

<p> </p>

<p> </p>

<p>        public AbstractService(ILogger logger, IDataObject dao)</p>

<p>        {</p>

<p>            this.logger = logger;</p>

<p>            this.dao = dao;</p>

<p>        }</p>

<p> </p>

<p>        [Transaction(TransactionMode.Requires)]</p>

<p>        public virtual T Save(T item)</p>

<p>        {</p>

<p>            return dao.Save(internalPrepareSave(item));</p>

<p>        }</p>

<p> </p>

<p>        internal abstract T internalPrepareSave(T item);</p>

<p> </p>

<p>        [Transaction(TransactionMode.Requires)]</p>

<p>        public virtual void Delete(T item)</p>

<p>        {</p>

<p>            dao.Delete(item);</p>

<p>        }</p>

<p> </p>

<p>        public virtual IItemList GetAll(string sortExpression, int pageNumber, int pageSize, out int pageCount)</p>

<p>        {</p>

<p>            return dao.FindAll(sortExpression, pageNumber, pageSize, out pageCount);</p>

<p>        }</p>

<p> </p>

<p>        public virtual T GetById(Guid Id)</p>

<p>        {</p>

<p>            return dao.GetById(Id);</p>

<p>        }</p>

<p> </p>

<p> </p>

<p>    }</p>

<p>}</p>

<p>And the last bit could be an implementation of this service.  I don&#8217;t have companies in NBlogr. I took this class from another project :</p>

<p>using System;</p>

<p>using Castle.Services.Transaction;</p>

<p>using Castle.Core.Logging;</p>

<p>using NBlogr.Common.Base4Integration;</p>

<p>using NBlogr.Core;</p>

<p> </p>

<p>namespace NBlogr.Service</p>

<p>{</p>

<p>    [Transactional]</p>

<p>    public class BlogService : Abstract.AbstractService<Blog></p>

<p>    {</p>

<p> </p>

<p>        public BlogService(ILogger logger, IDataObject<Blog> dao)</p>

<p>            : base(logger, dao)</p>

<p>        {</p>

<p> </p>

<p>        }</p>

<p> </p>

<p>        internal override Blog internalPrepareSave(Blog item)</p>

<p>        {</p>

<p>            Blog itemToSave = GetById(item.Id);</p>

<p> </p>

<p>            if (!itemToSave.Internals.InDatabase)</p>

<p>            {</p>

<p>                itemToSave.Created = DateTime.Now;</p>

<p>                itemToSave.Creator = CurrentUser;</p>

<p>            }</p>

<p> </p>

<p>            itemToSave.AkismetKey = item.AkismetKey;</p>

<p>            //TODO: finish mapping properties</p>

<p> </p>

<p>            return itemToSave;</p>

<p>        }</p>

<p>    }</p>

<p>}</p>

<p>This concludes the service for use with base4.  I hope you find it as useful as I do.<br/>
If somebody knows improvements etc. Please let me know I am always keen to learn.</p>

<p>I also realise that I can just call save on an IItem object but i like every tier to have it&#8217;s specific task so the dataobject doesn&#8217;t do much else than call IItem.Save() for now</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">16</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/16/no-post-yesterday-i-was-moving-from-team-foundation-to/" title="">No Post Yesterday I Was Moving From Team Foundation to Subversion</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I was using Team foundation workgroup edition  for the past year to manage collaborating with a couple of people. And the other stuff you use team foundation for.</p>

<p>I like Team foundation a lot but unfortunately am not rich enough to buy licenses for everybody that needs to log bugs etc.  To avoid all those licensing issues we have switched over to a combination of open source packets.The total cost of the operation is about 450NZD for unlimited licenses.</p>

<p>So what is the setup :</p>

<ul>
<li><a href="http://subversion.tigris.org/">Subversion</a> as source control server</li>
<li><a href="http://httpd.apache.org/">Apache2</a> with openSSL for people to connect to the subversion repository.
<a href="http://raibledesigns.com/wiki/Wiki.jsp?page=ApacheSSL">Install Guide</a></li>
<li><a href="http://tortoisesvn.tigris.org/">TortoiseSVN</a> and/or <a href="http://ankhsvn.tigris.org/">AnkhSVN</a> (VS2k5 integration) as source control client</li>
<li><a href="http://www.countersoft.com/">Gemini</a> as project management tool</li>
<li><a href="http://projectmanagementsuite.com/portal">Gemini Time tracker</a> to manage the time spent on issues/work items</li>
<li><a href="http://gemini.countersoft.com/issue/ViewIssue.aspx?ID=302">The plugin</a> originally written by <a href="http://www.syringe.net.nz/CategoryView,category,.NET.aspx">Chris Auld</a> and improved by <a href="http://weblogs.asp.net/fbouma/">Frans Bouma</a> for hooking into subversion</li>
</ul>


<p>The whole experience took about 6 hours to configure ant that is because I didn&#8217;t know apache at all and getting it to work with SSL did take me some time until I found the install guide that had a link to compiled binaries. I&#8217;m not that good in compiling ansi-C on a windows 2k3 64-bit machine without the windows sdk installed. Not to mention all these little tools you have to download all over the place. Most of them i had never heard of before, so yes I was happy to find that guide.</p>

<p>We are now completely switched over, except for the work items that are currently in team foundation server. It was a good moment to do this because the most of the previous projects have come to an end and the new wave is rolling in. I got really tired of retyping the emails etc I got into the issue tracker, simply becasue I couldn&#8217;t afford it.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">14</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/14/redirecting-based-on-a-role-in-the-loggedin-event-of/" title="">Redirecting Based on a Role in the Loggedin Event of the Login Control</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Today I had to fix a website that is built by the guys over in Russia. Completely asp.net no castle involved whatsoever. There is not even an O/R mapper in the application.</p>

<p>Real basic stuff. Sql datasource gridview/formview type of things.</p>

<p>The client asked me to do redirect their site to certain pages depending on which role the user is in.</p>

<p>Cool. Let&#8217;s handle the LoggedIn event of the Login control. This is what I started of with. Makes perfect sense to me that that should work.</p>

<p>    protected void Login1_LoggedIn(object sender, EventArgs e)</p>

<p>    {</p>

<p>        if (Roles.IsUserInRole(&#8220;School&#8221;))</p>

<p>            Response.Redirect(string.Format(&#8220;~/Career/School.aspx?ID={0}&#8221;, CareerUser.GetUserTypeId(Membership.GetUser().ProviderUserKey)));</p>

<p>        if (Roles.IsUserInRole(&#8220;Student&#8221;))</p>

<p>            Response.Redirect(string.Format(&#8220;~/Career/Student.aspx?ID={0}&#8221;, CareerUser.GetUserTypeId(Membership.GetUser().ProviderUserKey)));</p>

<p>        else</p>

<p>            Response.Redirect(&#8220;~/Login.aspx&#8221;);</p>

<p>    }</p>

<p>Now as expected that didn&#8217;t do the trick. But this does</p>

<p>    protected void Login1_LoggedIn(object sender, EventArgs e)</p>

<p>    {</p>

<p>        /*I have to do it this way because there is no cookie set yet so Membership.GetUser() returns an empty object.</p>

<p>        * The same goes for the roles. No cookie means no data for the standard function.</p>

<p>        */</p>

<p>        Login login = sender as Login;</p>

<p>        Guid userObjectKey = (Guid)Membership.GetUser(login.UserName).ProviderUserKey;</p>

<p>        Guid userId = CareerUser.GetUserTypeId(login.UserName, userObjectKey);</p>

<p>        if (Roles.IsUserInRole(login.UserName, &#8220;School&#8221;))</p>

<p>            Response.Redirect(string.Format(&#8220;~/Career/School.aspx?ID={0}&#8221;, userId));</p>

<p>        if (Roles.IsUserInRole(login.UserName, &#8220;Student&#8221;))</p>

<p>            Response.Redirect(string.Format(&#8220;~/Career/Student.aspx?ID={0}&#8221;, userId));</p>

<p>        else</p>

<p>            Response.Redirect(&#8220;~/Login.aspx&#8221;);</p>

<p>    }</p>

<p>Just thought I&#8217;d share this for other people that have this problem.</p>

<p>Anyway this is wtf numero 10 today. And I haven&#8217;t had these moments in the last couple of weeks, using castle and all, so I was feeling a little nostalgic about the whole thing.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">14</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/14/some-news-on-nblogr/" title="">Some News on Nblogr</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p><a href="http://www.codeplex.com/Wiki/View.aspx?ProjectName=Nblogr">NBlogr</a> isn&#8217;t dead.. It just underwent a transformation for the better.</p>

<p>I also changed the title of the application from <strong>NBlogr - An atlas blogging engine</strong> to <strong>NBlogr - a blogging engine built on simplicity<br/>
</strong>The reason for this change is the fact that it is currently built using jquery as javascript library.  I will look at atlas again when it releases.</p>

<p>I moved <a href="http://www.nblogr.com">NBlogr</a> to run on <a href="http://www.castleproject.org/">castle</a>.  During the course of the next week I&#8217;ll complete my posts on how to do Castle development with <a href="http://www.base4.net/">base4</a></p>

<p>If you&#8217;re interested in how it looks or you want a preview the <a href="http://www.codeplex.com/SourceControl/ListDownloadableCommits.aspx?ProjectName=Nblogr">last source in the repository builds</a> and you should be able to run it in the development server of visual studio</p>

<p>I had a chat with <a href="http://blog.bluecog.co.nz/">JD</a> a while ago and he asked me about plugins. At that time I knew already I wanted to provide something for users to be able to add plugin&#8217;s to the database.  But I hadn&#8217;t really given it much thought on how I would do that.</p>

<p>My reasoning on this subject is : <br/>
I want users to be able to add a plug in at runtime. Plugin&#8217;s for a blog are lately both server related client side. So I will create a plugin factory with a couple of providers like a google video provider, grouper video, flickr, bookmark services.  And you can write a plugin using javascript and ironpython code. The engine will evaluate that code at runtime and there has been no application restarting etc. If somebody has a better plan for doing a plugin infrastructure please let me know I haven&#8217;t done any of the ground work for this yet but create a schema in base4 so now would be the best time to stop me from making big mistakes.</p>

<p>Another improvement is the fact that when nblogr reaches release it will come with a couple of templates for you to chose from. I&#8217;ll try to include one that is built on the css scheme of csszengarden that way you&#8217;ll have an infinite repository of css to make your blog look differently instantaneously.</p>

<p>The next improvement is that a user is now able to mimic wildcard requests and nblogr will handle those. So there is no need for appending aspx to pages for rewriting (routing it is called in monorail)  You get the choice in the config file to have your webserver handle the wild card mapping or nblogr. When you choose for nblogr nblogr will need write access to 2 folders in your website and create a shadow folder structure to represent the rewrite tree structure. There is weaker point here and that is that the <strong>first</strong> default document in IIS must be set to Default.aspx If you can map an extension to aspnet_isapi.dll at your webserver then you can also have the urls rewritten using a branded extension.</p>

<p>I think that this are the 3 major changes for the moment to the engine.  This did set me back for the next release with a couple of weeks but in the end the final release can be done much more quickly than it would have been possible using the code I had before.</p>

<p>I also promise that this time things mostly stay as they are. There will be no more experimenting but just getting Nblogr to a proper release state and shipped.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">12</p>  
    <div class="month-year"><p><span>Oct</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/10/12/hosting-base4-inside-your-web-application/" title="">Hosting Base4 Inside Your Web Application</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Following up on the post of yesterday.  To use base4 with asp.net often you do not have the possibility to host <a href="http://wwww.base4.net">base4</a> as a windows service. But to host base4 in the same appdomain as you website isn&#8217;t all that hard.</p>

<p>I&#8217;ll just share my code and how to use it. The way to go is to create a class that extends the HttpApplicatin and handle the application start and end events.</p>

<p>I&#8217;ll also post the code i have to integrate this with castle.</p>

<p>This is my base HttpApplication, every web app inherits of this one.</p>

<p>using System;</p>

<p>using System.Collections.Generic;</p>

<p>using System.Text;</p>

<p>using System.Web;</p>

<p>using Base4.Storage.Server;</p>

<p>using System.Text.RegularExpressions;</p>

<p>using System.Reflection;</p>

<p>using System.Data.SqlClient;</p>

<p>using System.Configuration;</p>

<p>using Base4.Storage;</p>

<p>using System.Xml;</p>

<p>using System.IO;</p>

<p> </p>

<p>namespace Flanders.Library.Base4Integration</p>

<p>{</p>

<p>    public class Base4HttpApplication : HttpApplication</p>

<p>    {</p>

<p>        ServerConfiguration config;</p>

<p>        IServerProxy proxy;</p>

<p> </p>

<p> </p>

<p>        public Base4HttpApplication()</p>

<p>        {</p>

<p> </p>

<p>        }</p>

<p> </p>

<p>        public virtual void Application_Start(object sender, EventArgs e)</p>

<p>        {</p>

<p>            //Build the base4 server configuration from the connection strings settings in the web.config</p>

<p>            config = new ServerConfiguration();</p>

<p>            config.Store.Root = Server.MapPath(&#8220;~/&#8221;);</p>

<p>            config.Store.Root = config.Store.Root.EndsWith(&#8220;&#34;) ? config.Store.Root</p>

<p>                + &#8220;App_Data\Base4&#8221; : config.Store.Root + &#8220;\App_Data\Base4&#8221;;</p>

<p> </p>

<p>            //Set the application name of the store. In my case I define a title for my application in a</p>

<p>            //solution info file and use that as my app name</p>

<p>            //For this to work you will need to name your database the same as your applicationname</p>

<p>            if (Application[&#8220;AppName&#8221;] == null)</p>

<p>            {</p>

<p>                Assembly assembly = Assembly.GetCallingAssembly();</p>

<p>                Application[&#8220;AppName&#8221;] =</p>

<p>                    (AssemblyTitleAttribute.GetCustomAttribute(assembly, typeof(AssemblyTitleAttribute)) as AssemblyTitleAttribute).Title;</p>

<p>            }</p>

<p> </p>

<p>            config.Store.Name = Application[&#8220;AppName&#8221;].ToString();</p>

<p>            config.Store.Provider = &#8220;SQL2005&#8221;;</p>

<p> </p>

<p>            //Set the port for base4 to listen on.  This is defined in the web.config app settings</p>

<p>            if (Application[&#8220;AppPort&#8221;] == null)</p>

<p>                Application[&#8220;AppPort&#8221;] = string.IsNullOrEmpty(ConfigurationManager.AppSettings[&#8220;Base4.Port&#8221;]) ? 8809 :</p>

<p>                    int.Parse(ConfigurationManager.AppSettings[&#8220;Base4.Port&#8221;]);</p>

<p> </p>

<p>            config.Store.Port = (int)Application[&#8220;AppPort&#8221;];</p>

<p>            //We are hosting base4 in the same process as the website. so localhost will do :)</p>

<p>            config.Store.MachineName = &#8220;localhost&#8221;;</p>

<p> </p>

<p>            //Set the connection string for the base4 store</p>

<p>            string connectionStringName = ConfigurationManager.AppSettings[&#8220;DefaultConnection&#8221;];</p>

<p>            if (string.IsNullOrEmpty(connectionStringName) &amp;&amp; ConfigurationManager.ConnectionStrings != null</p>

<p>                &amp;&amp; ConfigurationManager.ConnectionStrings.Count > 0)</p>

<p>                connectionStringName = ConfigurationManager.ConnectionStrings[0].Name;           </p>

<p> </p>

<p>            config.Store.ConnectionString = string.IsNullOrEmpty(connectionStringName) ?</p>

<p>                ConfigurationManager.AppSettings[&#8220;Store.ConnectionString&#8221;] :</p>

<p>                ConfigurationManager.ConnectionStrings[connectionStringName].ConnectionString;</p>

<p> </p>

<p>            //Set the master connection string</p>

<p>            SqlConnectionStringBuilder connStrBuilder = new SqlConnectionStringBuilder(config.Store.ConnectionString);</p>

<p> </p>

<p>            connStrBuilder.InitialCatalog = &#8220;master&#8221;;</p>

<p>            config.MasterConnectionString = connStrBuilder.ToString();</p>

<p> </p>

<p>            //Check if we have a directory to store the files generated by base4</p>

<p>            if(!Directory.Exists(config.Store.Root))</p>

<p>                Directory.CreateDirectory(config.Store.Root);</p>

<p> </p>

<p>            //Actually start the server</p>

<p>            proxy = ServerFactory.StartServer(config, false);</p>

<p> </p>

<p>            //Set the context for base4</p>

<p>            string base4Context = string.Format(&#8220;tcp://Server:@localhost:{0}/{1}&#8221;, Application[&#8220;AppPort&#8221;], Application[&#8220;AppName&#8221;]);</p>

<p> </p>

<p>            Application[&#8220;Base4Context&#8221;] = base4Context;</p>

<p> </p>

<p>            //Set the default storage context for base4</p>

<p>            StorageContext.SetDefault(base4Context);</p>

<p> </p>

<p>        }</p>

<p> </p>

<p>        public virtual void Application_End(object sender, EventArgs e)</p>

<p>        {</p>

<p>            proxy.Stop();</p>

<p>        }</p>

<p> </p>

<p>    }</p>

<p>}</p>

<p>Now to integrate this with monorail then this is you application class in your website :</p>

<p> </p>

<p>using System.Web;</p>

<p>using Castle.Windsor;</p>

<p>using Base4.Storage;</p>

<p>using System.Configuration;</p>

<p>using Flanders.Library.Base4Integration;</p>

<p> </p>

<p>namespace NBlogr.Presentation</p>

<p>{</p>

<p>    public class ASPGlobal : Base4HttpApplication, IContainerAccessor</p>

<p>    {</p>

<p>        private static MonoRailContainer container;</p>

<p> </p>

<p>        public override void Application_Start(object sender, System.EventArgs e)</p>

<p>        {</p>

<p>            base.Application_Start(sender, e);</p>

<p>            container = new MonoRailContainer();</p>

<p>        }</p>

<p> </p>

<p>        public override void Application_End(object sender, System.EventArgs e)</p>

<p>        {</p>

<p>            container.Dispose();</p>

<p>            base.Application_End(sender, e);</p>

<p>        }</p>

<p> </p>

<p> </p>

<p>        #region IContainerAccessor Members</p>

<p> </p>

<p>        public IWindsorContainer Container</p>

<p>        {</p>

<p>            get { return container; }</p>

<p>        }</p>

<p> </p>

<p>        #endregion</p>

<p>    }</p>

<p>}</p>

<p>The global.asax should only contain one line :</p>

<pre><code>&lt;span class="asp"&gt;&lt;%@ Application Inherits="NBlogr.Presentation.ASPGlobal" Language="C#" %&gt;&lt;/span&gt;
</code></pre>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">28</p>  
    <div class="month-year"><p><span>Sep</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/09/28/more-on-logging/" title="">More on Logging</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Earlier this week, about the same time that I was playing with health monitoring. I found out after a while that log4net isn&#8217;t working on Vista RC1.</p>

<p>Now I don&#8217;t know about you but log4net seemed like the obvious choice for logging for me.  Now I was forced to have a look around what else is there. And castle supports also <a href="http://www.nlog-project.org/">nlog</a>. I took a closer look at nlog and I like it a lot. It has much better integration with visual studio 2005 than log4net has.</p>

<p>The configuration was much easier. I wrote a &#8220;log provider&#8221; (log target in the nlog dictionary) for base4 in about 15 minutes.  Ah yes extensibility is great for this product.</p>

<p>It&#8217;s open source but it is a really tight project.  Maybe you too should investigate :)</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">27</p>  
    <div class="month-year"><p><span>Sep</span><br />2006</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2006/09/27/custom-health-monitoring-for-aspnet-using-base4/" title="">Custom Health Monitoring for Asp.NET Using Base4</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>It&#8217;s been pretty quiet on my blog the last couple of days. But I had something cooking :)</p>

<p>I think logging is a pretty important part of an application. I like to know what&#8217;s going on when for errors etc.</p>

<p>Asp.NET has a health monitoring service that does just that. With a couple of lines in the web.config you&#8217;re good to go.</p>

<p>I use <a href="http://www.base4.net/">base4</a> for my dataaccess and i want do do all my data access through base4. From the asp.net services I use Membership, roleManager, profiles and health monitoring.</p>

<p>This week I ported healthmonitoring, membership and rolemanager to Base4. I&#8217;ll post the health monitoring provider and when I have also completed the profile provider I&#8217;ll post a dll that contains all the providers and the Base4 schema&#8217;s if somebody is interested.</p>

<p> </p>

<p>using System;</p>

<p>using System.Collections.Generic;</p>

<p>using System.Text;</p>

<p>using System.Collections.Specialized;</p>

<p>using Flanders.Library.Provider;</p>

<p>using System.Web.Management;</p>

<p>using System.Globalization;</p>

<p>using Seshat.Data;</p>

<p>using System.Collections;</p>

<p>using System.Threading;</p>

<p>using System.Configuration;</p>

<p> </p>

<p>namespace Flanders.Library.Base4Integration</p>

<p>{</p>

<p>    public class Base4WebEventProvider : BufferedWebEventProvider</p>

<p>    {</p>

<p>        const int SQL_MAX_NTEXT_SIZE = 1073741823;</p>

<p>        const int NO_LIMIT = -1;</p>

<p> </p>

<p>        int _maxEventDetailsLength = NO_LIMIT;</p>

<p> </p>

<p>        DateTime <em>retryDate = DateTime.MinValue; // Won&#8217;t try sending unless DateTime.UtcNow is > </em>retryDate</p>

<p> </p>

<p>        public Base4WebEventProvider() { }</p>

<p> </p>

<p>        public override void Initialize(string name, NameValueCollection config)</p>

<p>        {</p>

<p> </p>

<p>            string temp = null;</p>

<p> </p>

<p>            SecUtility.GetAndRemoveStringAttribute(config, &#8220;connectionStringName&#8221;, name, ref temp);</p>

<p> </p>

<p> </p>

<p>            SecUtility.GetAndRemovePositiveOrInfiniteAttribute(config, &#8220;maxEventDetailsLength&#8221;, name, ref _maxEventDetailsLength);</p>

<p>            if (_maxEventDetailsLength == SecUtility.Infinite)</p>

<p>            {</p>

<p>                _maxEventDetailsLength = NO_LIMIT;</p>

<p>            }</p>

<p>            else if (_maxEventDetailsLength > SQL_MAX_NTEXT_SIZE)</p>

<p>            {</p>

<p>                throw new ConfigurationErrorsException(SR.GetString(SR.Invalid_max_event_details_length, name, _maxEventDetailsLength.ToString(CultureInfo.CurrentCulture)));</p>

<p>            }</p>

<p> </p>

<p>            //SecUtility.GetAndRemovePositiveAttribute(config, &#8220;commandTimeout&#8221;, name, ref _commandTimeout);</p>

<p> </p>

<p>            base.Initialize(name, config);</p>

<p>        }</p>

<p> </p>

<p>        void FillParams(ApplicationEvent appEvent, WebBaseEvent eventRaised)</p>

<p>        {</p>

<p>            Exception exception = null;</p>

<p>            WebRequestInformation reqInfo = null;</p>

<p>            string details = null;</p>

<p>            WebApplicationInformation appInfo = WebBaseEvent.ApplicationInformation;</p>

<p> </p>

<p>            appEvent.Id = eventRaised.EventID;</p>

<p>            appEvent.EventId = eventRaised.EventID.ToString(&#8220;N&#8221;, CultureInfo.InstalledUICulture) ;</p>

<p>            appEvent.EventTimeUtc = eventRaised.EventTimeUtc;</p>

<p>            appEvent.EventTime = eventRaised.EventTime;</p>

<p>            appEvent.EventType = eventRaised.GetType().ToString();</p>

<p>            appEvent.EventSequence = eventRaised.EventSequence;</p>

<p>            appEvent.EventOccurence = eventRaised.EventOccurrence;</p>

<p>            appEvent.EventCode = eventRaised.EventCode;</p>

<p>            appEvent.EventDetailCode = eventRaised.EventDetailCode;</p>

<p>            appEvent.Message = eventRaised.Message;</p>

<p>            appEvent.ApplicationPath = appInfo.ApplicationPath;</p>

<p>            appEvent.ApplicationVirtualPath = appInfo.ApplicationVirtualPath;</p>

<p>            appEvent.MachineName = appInfo.MachineName;</p>

<p> </p>

<p>            // @RequestUrl</p>

<p>            if (eventRaised is WebRequestEvent)</p>

<p>            {</p>

<p>                reqInfo = ((WebRequestEvent)eventRaised).RequestInformation;</p>

<p>            }</p>

<p>            else if (eventRaised is WebRequestErrorEvent)</p>

<p>            {</p>

<p>                reqInfo = ((WebRequestErrorEvent)eventRaised).RequestInformation;</p>

<p>            }</p>

<p>            else if (eventRaised is WebErrorEvent)</p>

<p>            {</p>

<p>                reqInfo = ((WebErrorEvent)eventRaised).RequestInformation;</p>

<p>            }</p>

<p>            else if (eventRaised is WebAuditEvent)</p>

<p>            {</p>

<p>                reqInfo = ((WebAuditEvent)eventRaised).RequestInformation;</p>

<p>            }</p>

<p>            appEvent.RequestUrl = Convert.ToString((reqInfo != null) ? reqInfo.RequestUrl : Convert.DBNull);</p>

<p> </p>

<p>            // @ExceptionType</p>

<p>            if (eventRaised is WebBaseErrorEvent)</p>

<p>            {</p>

<p>                exception = ((WebBaseErrorEvent)eventRaised).ErrorException;</p>

<p>            }</p>

<p>            appEvent.ExceptionType = Convert.ToString((exception != null) ? exception.GetType().ToString() : Convert.DBNull);</p>

<p> </p>

<p>            // @Details</p>

<p>            details = eventRaised.ToString();</p>

<p>            if (_maxEventDetailsLength != NO_LIMIT &amp;&amp;</p>

<p>                details.Length > _maxEventDetailsLength)</p>

<p>            {</p>

<p>                details = details.Substring(0, _maxEventDetailsLength);</p>

<p>            }</p>

<p>            appEvent.Details= details;</p>

<p>        }</p>

<p> </p>

<p>        void WriteToBase4(ICollection events, int eventsDiscardedByBuffer, DateTime lastNotificationUtc)</p>

<p>        {</p>

<p>            // We don&#8217;t want to send any more events until we&#8217;ve waited until the _retryDate (which defaults to minValue)</p>

<p>            if (_retryDate > DateTime.UtcNow)</p>

<p>            {</p>

<p>                return;</p>

<p>            }</p>

<p> </p>

<p>            try</p>

<p>            {</p>

<p>                ApplicationEvent appEvent = new ApplicationEvent();</p>

<p> </p>

<p>                try</p>

<p>                {</p>

<p> </p>

<p>                    if (eventsDiscardedByBuffer != 0)</p>

<p>                    {</p>

<p>                        WebBaseEvent infoEvent = new Base4BaseEvent(</p>

<p>                            SR.GetString(SR.Sql_webevent_provider_events_dropped,</p>

<p>                                eventsDiscardedByBuffer.ToString(CultureInfo.InstalledUICulture),</p>

<p>                                lastNotificationUtc.ToString(&#8220;r&#8221;, CultureInfo.InstalledUICulture)),</p>

<p>                                null,</p>

<p>                                WebEventCodes.WebEventProviderInformation,</p>

<p>                                WebEventCodes.SqlProviderEventsDropped);</p>

<p> </p>

<p>                        FillParams(appEvent, infoEvent);</p>

<p>                        appEvent.Save();</p>

<p>                    }</p>

<p> </p>

<p>                    foreach (WebBaseEvent eventRaised in events)</p>

<p>                    {</p>

<p>                        FillParams(appEvent, eventRaised);</p>

<p>                        appEvent.Save();</p>

<p>                    }</p>

<p>                    EventProcessingComplete(events);</p>

<p>                }</p>

<p>                catch</p>

<p>                {</p>

<p>                    // Ignore all errors.</p>

<p>                }</p>

<p>            }</p>

<p>            catch</p>

<p>            {</p>

<p>                // For any failure, we will wait at least 30 seconds or _commandTimeout before trying again</p>

<p>                double timeout = 30;</p>

<p>                _retryDate = DateTime.UtcNow.AddSeconds(timeout);</p>

<p>                throw;</p>

<p>            }</p>

<p>        }</p>

<p> </p>

<p>        public override void ProcessEventFlush(WebEventBufferFlushInfo flushInfo)</p>

<p>        {</p>

<p>            // Remove Debug.Trace from sample Debug.Trace(&#8220;SqlWebEventProvider&#8221;, &#8220;EventBufferFlush called: &#8221; +</p>

<p>            WriteToBase4(flushInfo.Events, flushInfo.EventsDiscardedSinceLastNotification,</p>

<p>                flushInfo.LastNotificationUtc);</p>

<p>        }</p>

<p>        public override void ProcessEvent(WebBaseEvent eventRaised)</p>

<p>        {</p>

<p>            if (UseBuffering)</p>

<p>            {</p>

<p>                base.ProcessEvent(eventRaised);</p>

<p>            }</p>

<p>            else</p>

<p>            {</p>

<p>                 WriteToBase4(new Base4BaseEventCollection(eventRaised), 0, new DateTime(0));</p>

<p>            }</p>

<p>        }</p>

<p> </p>

<p>        protected virtual void EventProcessingComplete(ICollection raisedEvents)</p>

<p>        {</p>

<p>        }</p>

<p> </p>

<p>        public override void Shutdown()</p>

<p>        {</p>

<p>            try</p>

<p>            {</p>

<p>                Flush();</p>

<p>            }</p>

<p>            finally</p>

<p>            {</p>

<p>                base.Shutdown();</p>

<p>            }</p>

<p>        }</p>

<p>    }</p>

<p>    public class Base4BaseEvent : WebBaseEvent</p>

<p>    {</p>

<p> </p>

<p>        public Base4BaseEvent(string message, object eventSource, int eventCode) : base(message, eventSource, eventCode) { }</p>

<p>        public Base4BaseEvent(string message, Object eventSource, int eventCode, int eventDetailCode)</p>

<p>            : base(message, eventSource, eventCode, eventDetailCode)</p>

<p>        { }</p>

<p>    }</p>

<p>    public sealed class Base4BaseEventCollection : ReadOnlyCollectionBase</p>

<p>    {</p>

<p>        public Base4BaseEventCollection(ICollection events)</p>

<p>        {</p>

<p>            if (events == null)</p>

<p>            {</p>

<p>                throw new ArgumentNullException(&#8220;events&#8221;);</p>

<p>            }</p>

<p> </p>

<p>            foreach (WebBaseEvent eventRaised in events)</p>

<p>            {</p>

<p>                InnerList.Add(eventRaised);</p>

<p>            }</p>

<p>        }</p>

<p> </p>

<p>        internal Base4BaseEventCollection(WebBaseEvent eventRaised)</p>

<p>        {</p>

<p>            if (eventRaised == null)</p>

<p>            {</p>

<p>                throw new ArgumentNullException(&#8220;eventRaised&#8221;);</p>

<p>            }</p>

<p> </p>

<p>            InnerList.Add(eventRaised);</p>

<p>        }</p>

<p> </p>

<p>        // overloaded collection access methods</p>

<p>        public WebBaseEvent this[int index]</p>

<p>        {</p>

<p>            get</p>

<p>            {</p>

<p>                return (WebBaseEvent)InnerList[index];</p>

<p>            }</p>

<p>        }</p>

<p> </p>

<p>        public int IndexOf(WebBaseEvent value)</p>

<p>        {</p>

<p>            return InnerList.IndexOf(value);</p>

<p>        }</p>

<p> </p>

<p>        public bool Contains(WebBaseEvent value)</p>

<p>        {</p>

<p>            return InnerList.Contains(value);</p>

<p>        }</p>

<p>    }</p>

<p>}</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  <div class="pagination">
    
      <a class="prev" href="/page/18/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/16/">Newer &rarr;</a>
    
  </div>
</div>
</div>


      </div>
    </div>
    <footer role="contentinfo"><!-- start of footer container -->
  <div class="container">
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="twelve columns">
        <div class="logo">
          <img src="/images/logo.png" alt="" />
          <h2>Rants &amp; ramblings</h2>
        </div>
      </div>

      <div class="four columns">        
        <h6>Social networks</h6>
        <ul class="social_network">
          <li class="rollover"><a href="http://facebook.com/ivanportocarrero" class="yellowtip" title="Facebook"><span class="fb-rollover"></span><img src="/images/social/fb.png" alt="" /></a></li>
          <li class="rollover"><a href="http://twitter.com/casualjim" class="yellowtip" title="Follow me"><span class="twitter-rollover"></span><img src="/images/social/twitter.png" alt="" /></a></li>
          <li class="rollover"><a href="https://plus.google.com/u/1/106536131996809745163/posts" class="yellowtip" title="Google plus"><span class="google-rollover"></span><img src="/images/social/google-plus.png" alt="" /></a></li>
        </ul>       
      </div>
    </div>
    <!-- end of row -->
  
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="eight columns">
        <h6>About me</h6>
        <p>
        Welcome to my blog. This is a collection of random thoughts and rants.
        </p>
        <p>
        Allow me to introduce myself. My name is Ivan Porto Carrero and I'm an enthusiastic developer on  Scala, .NET and Ruby.<br />Through this blog I hope I can share some of that passion and maybe help somebody out when they are looking on how to do something.
        </p>
      </div>
      <div class="four columns">
        <h6>Latest posts</h6>
        <ul class="square">
        
          <li>
            <a href="/2011/08/01/backchat-developers/">work for backchat</a>
          </li>
        
          <li>
            <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
          </li>
        
          <li>
            <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
          </li>
        
          <li>
            <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
          </li>
        
          <li>
            <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
          </li>
        
        </ul> 
      </div>
      <div class="four columns">
        <h6>Browse pages</h6>
        <ul class="square">
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archives</a></li>
          <li><a href="/projects">My projects</a></li>
        </ul> 
      </div>
    </div>
    <!-- end of row -->
    

    <!-- start of footer divider -->
    <div class="sixteen columns">
      <div class="footer-divider row"></div>
    </div>  
    <!-- end of footer divider -->
    
    <!-- start of bottoms -->
    <div class="clearfix footnote">
      <div class="eight columns">
        <p class="copyright">Copyright &copy; 2012 - Ivan Porto Carrero - All Right Reserved</p>
      </div>
      <div class="eight columns">
        <p class="align-right"><span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, designed by <a href="http://iweb-studio.com" target="_blank">iwebstudio</a></p>
      </div>
    </div>
    <!-- end of bottoms -->

  </div>
  <!-- end of footer container -->

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'casualjim';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<p id="back-top">
  <a href="#top"><span></span>To top</a>
</p>

</body>
</html>
