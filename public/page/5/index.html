
<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <meta charset="utf-8">
  <title>Ivan Porto Carrero</title>
  <meta name="author" content="Ivan Porto Carrero">

  
  <meta name="description" content="Yesterday we had a little introduction to Ninject. Today I&#8217;d like to examine what&#8217;s involved in getting some AOP style logging going for &hellip;">
  

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- http://t.co/dKP3o1e -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="canonical" href="http://flanders.co.nz/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/css/base.css" rel="stylesheet" type="text/css">
  <link href="/css/skeleton.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">
  <link href="/css/style.css" rel="stylesheet" type="text/css">
  <link href="/css/skins/blue.css" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

  <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>  
  <script src="/js/modernizr.js" type="text/javascript"></script>
  <script src="/js/jquery.easing.1.3.js" type="text/javascript"></script>
  <script type="text/javascript" src="/js/jquery.illuminate.0.7.min.js"></script>
  <!-- tweet -->
  <script type="text/javascript" src="/js/tweet/twitter.js"></script>
  <script type="text/javascript" src="/js/tweet/setting.js"></script>
  
  <script type="text/javascript" src="/js/custom.js"></script>
  <link href="/atom.xml" rel="alternate" title="Ivan Porto Carrero" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-240612-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <div id="wrapper">
    <header role="banner"> <div class="container">
    <div class="row clearfix">
      <hdgroup>
        <div class="four columns">
          <div class="logo">
            <img src="/images/logo.png" alt="" />
            <h2>Rants &amp; ramblings</h2>
          </div>  
        </div>
      </hdgroup>
      <nav role="navigation"><!-- <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:flanders.co.nz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
   -->
<ul>
  <li>
    <a href="/">Home
      <span>Homepage</span>
    </a>    
  </li>
  <li>
    <a href="/archives">Archives
      <span>Articles</span>
    </a>    
  </li>
  <li>
    <a href="/projects">Projects
      <span>Open-Source</span>
    </a>    
  </li>
  <li>
    <a href="/about">About me
      <span>Introduction</span>
    </a>    
  </li>
</ul>
</nav>

    </div>
  </div>  
<!-- <hgroup>
  <h1><a href="/">Ivan Porto Carrero</a></h1>
  
    <h2>IO(thoughts) foreach (_.propagandize)</h2>
  
</hgroup>
 -->
</header>
    <div class="container bodycontent">
      <div class="row clearfix">
        <div class="sixteen columns headline">
          <h2>Ivan Porto Carrero</h2>
          <p class="italic">IO(thoughts) foreach (_.propagandize)</p>
        </div>
      </div>  

      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <!-- start of row -->
      <div class="row clearfix">
        <div class="sixteen columns">
          <!-- twitter feed -->
          <div class="twitter_feed">
            <ul class="tweet_list"></ul>
          </div>
        </div>
      </div>  
      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <div id="maincontent" class="clearfix">
        <div class="five columns">  
  <aside class="left-sidebar">
    
        
<div class="widget row">
  <h5>Search form</h5>  
  <div id="search-form">
    <form action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:flanders.co.nz" />
        <input id="search-box" type="text" name="q" results="0" placeholder="Search"/>
        <input type="submit" value="Search" id="search-button" />
        <div class="clear"></div>
      </fieldset>
    </form>
  </div>
</div>
   <section>
  <div class="widget row">
    <h5>Recent Posts</h5>  
    <ul id="recent_posts">
      
        <li class="post">
          <a href="/2011/08/01/backchat-developers/">work for backchat</a>
        </li>
      
        <li class="post">
          <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
        </li>
      
        <li class="post">
          <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
        </li>
      
        <li class="post">
          <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
        </li>
      
        <li class="post">
          <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
        </li>
      
    </ul>
  </div>
</section>

<section>
  <div class="widget row">
    <h5>GitHub Repos</h5>
    <ul id="gh_repos">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    
    <a href="https://github.com/casualjim">@casualjim</a> on GitHub
    
  </div>
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({ user: "casualjim", target: $("#gh_repos"), forks: false, count: 5});
    });
  </script>
</section>


<section>
  <div class="widget row">
    <h5>Latest Tweets</h5>
    <ul id="tweets">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    <script type="text/javascript">
      $(document).ready(function(){
        // getTwitterFeed("casualjim", 4, false);
      });
    </script>
    
      <a href="http://twitter.com/casualjim" class="twitter-follow-button" data-show-count="false">Follow @casualjim</a>
    
  </div>
</section>


<section>
  <div class="widget row">
    <h5>On Delicious</h5>
    <div id="delicious"></div>
    <script type="text/javascript" src="http://feeds.delicious.com/v2/json/casualjim?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
    <p><a href="http://delicious.com/casualjim">My Delicious Bookmarks &raquo;</a></p>
  </div>
</section>


<section class="googleplus">
  <div class="widget row">
    <h5>
      <a href="https://plus.google.com/106536131996809745163?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h5>
  </div>
</section>



    
  </aside>
</div>
<div class="eleven columns">
<div class="blog-index">
  
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">18</p>  
    <div class="month-year"><p><span>Apr</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/04/18/ninject-part-2-customizing-your-infrastructure-for-logging/" title="">Ninject (Part 2): Customizing Your Infrastructure for Logging</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Yesterday we had a little introduction to <a href="http://ninject.org">Ninject</a>. Today I&#8217;d like to examine what&#8217;s involved in getting some <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> style logging going for your application. I find that there are only very few places where I&#8217;m logging something that steps out of the bounds of being called at the end of the method when things succeed. I&#8217;m generally more interested in what happens when things go wrong and that&#8217;s when I log the exception. In some cases I&#8217;ll be interested in the actual parameters.</p>

<p>The code I&#8217;m going to show you will take care of basic logging needs but if you want more information about what happens inside your method you&#8217;re either going to need to extend my implementation or log the call from within your method body. We&#8217;re going to implement logging that when run with the debug level turned on will tell us that a method is going to execute, whether it finished successfully or with an error and if there was an error it will also log the exception.</p>

<p>To get this thing on the road, on the <a href="http://mindscape.co.nz">LightSpeed</a> road that is. We&#8217;re going to use <a href="http://nlog-project.com">NLog</a> to get flexible routing of log messages. We&#8217;re first going to create a LightSpeedTarget that is a customized NLog target (route destination) for your log messages.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">LoggingDemo.UI.Integration</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>    <span class="c1">/// This class represents a NLog target that we can reference in the NLog.config file</span>
</span><span class='line'>    <span class="c1">/// You can use this to use Lightspeed to log to the database just like a file target etc.</span>
</span><span class='line'>    <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'><span class="na">    [Target(&quot;LightSpeedTarget&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">LightSpeedTarget</span> <span class="p">:</span> <span class="n">TargetWithLayout</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">LightSpeedTarget</span><span class="p">(){</span>
</span><span class='line'>            <span class="n">Layout</span> <span class="p">=</span> <span class="s">&quot;${message}&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">LogEventInfo</span> <span class="n">logEvent</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">logMessage</span> <span class="p">=</span> <span class="n">CompiledLayout</span><span class="p">.</span><span class="n">GetFormattedMessage</span><span class="p">(</span><span class="n">logEvent</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="kt">var</span> <span class="n">appEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ApplicationEvent</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Sequence</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">SequenceID</span><span class="p">,</span>
</span><span class='line'>                <span class="n">EventTime</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">TimeStamp</span><span class="p">,</span>
</span><span class='line'>                <span class="n">Level</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">Level</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LoggerName</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">LoggerName</span><span class="p">,</span>
</span><span class='line'>                <span class="n">Message</span> <span class="p">=</span> <span class="n">logMessage</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">logEvent</span><span class="p">.</span><span class="n">Exception</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">appEvent</span><span class="p">.</span><span class="n">Exception</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">logEvent</span><span class="p">.</span><span class="n">StackTrace</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">appEvent</span><span class="p">.</span><span class="n">StackTrace</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">StackTrace</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">logEvent</span><span class="p">.</span><span class="n">UserStackFrame</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">appEvent</span><span class="p">.</span><span class="n">UserStackFrame</span> <span class="p">=</span> <span class="n">logEvent</span><span class="p">.</span><span class="n">UserStackFrame</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">Repository</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">appEvent</span><span class="p">);</span>
</span><span class='line'>            <span class="n">Repository</span><span class="p">.</span><span class="n">CompleteUnitOfWork</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The class above overrides the TargetWithLayout class from the NLog project. The attribute tells NLog how to find this target. In the constructor I override the default message layout because it was a bit too verbose to my liking.</p>

<p>We then override the Write method where we map the properties to our ApplicationEvent. And lastly we add the event to the repository and commit it.
Now if we want our application to use this we&#8217;re going to have to tell it how. Nlog does this by looking for an nlog.config file in your application directory. So let&#8217;s go ahead and add an nlog.config file to our project. I&#8217;ll show you the nlog.config file for the application. In my unit test project I&#8217;m using the console logger so I can see what&#8217;s going on :)</p>

<p>The NLog.config file for the application:</p>

<p><img src="http://flanders.co.nz/wp-content/uploads/2008/04/image.png" alt="image" /></p>

<p>My NLog.config file for my test project:</p>

<p><img src="http://flanders.co.nz/wp-content/uploads/2008/04/image1.png" alt="image" /></p>

<p>This enables our application to use the target we just created. Moving on now to the Interceptor which is Ninject specific (You can do the same with other DI frameworks). In Ninject you can tell the kernel to intercept a method on a class and execute some logic before and after invocation of the method. We can tell Ninject to intercept all methods on a class, specific methods or when we say all methods we can still exclude some of them. For our logging example I chose to use all methods on a class. You can do this by decorating the class with an [Intercept] attribute. If you would want a method not to be intercepted you can by decorating that method with an [DoNotIntercept] attribute.</p>

<p>I took the liberty of inheriting of that attribute first.. that makes the rest of my code look a little bit prettier.</p>

<p>The LogMyCallsAttribute:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">LoggingDemo.UI.Interceptors</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">LogMyCallsAttribute</span> <span class="p">:</span> <span class="n">InterceptAttribute</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="nf">LogMyCallsAttribute</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">LoggingInterceptor</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The LoggingInterceptor:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core.Interception</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core.Logging</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">LoggingDemo.UI.Interceptors</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">LoggingInterceptor</span> <span class="p">:</span> <span class="n">SimpleFailureInterceptor</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span> <span class="n">_logger</span><span class="p">;</span>
</span><span class='line'>        <span class="k">private</span> <span class="kt">bool</span> <span class="n">_hasError</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">LoggingInterceptor</span><span class="p">(</span><span class="n">ILogger</span> <span class="n">logger</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
</span><span class='line'>            <span class="n">_hasError</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">BeforeInvoke</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">_logger</span><span class="p">.</span><span class="n">Debug</span><span class="p">(</span><span class="s">&quot;About to invoke {0}&quot;</span><span class="p">,</span> <span class="n">MethodNameFor</span><span class="p">(</span><span class="n">invocation</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">Exception</span> <span class="n">exception</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">_logger</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="s">&quot;There was an error invoking {0}.\r\n&quot;</span><span class="p">,</span> <span class="n">MethodNameFor</span><span class="p">(</span><span class="n">invocation</span><span class="p">));</span>
</span><span class='line'>            <span class="n">_hasError</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>            <span class="k">base</span><span class="p">.</span><span class="n">OnError</span><span class="p">(</span><span class="n">invocation</span><span class="p">,</span> <span class="n">exception</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">AfterInvoke</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">_logger</span><span class="p">.</span><span class="n">Debug</span><span class="p">(</span><span class="s">&quot;invocation of {0} finished {1}.&quot;</span><span class="p">,</span> <span class="n">MethodNameFor</span><span class="p">(</span><span class="n">invocation</span><span class="p">),</span> <span class="p">(</span><span class="n">_hasError</span> <span class="p">?</span> <span class="s">&quot;with an error state&quot;</span> <span class="p">:</span> <span class="s">&quot;successfully&quot;</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">MethodNameFor</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">invocation</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Method</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This class only overrides a couple of callbacks from its base class the <code>SimpleFailureInterceptor</code>. This is where the actual interception takes place.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core.Interception</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">LoggingDemo.UI.Interceptors</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">SimpleFailureInterceptor</span> <span class="p">:</span> <span class="n">IInterceptor</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="cp">#region IInterceptor Members</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">Intercept</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">BeforeInvoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
</span><span class='line'>                <span class="n">invocation</span><span class="p">.</span><span class="n">Proceed</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">OnError</span><span class="p">(</span><span class="n">invocation</span><span class="p">,</span> <span class="n">ex</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">finally</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">AfterInvoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cp">#endregion</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">BeforeInvoke</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">AfterInvoke</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">Exception</span> <span class="n">exception</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="n">exception</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is al the work that is involved in the actual implementation of our logger. Now I&#8217;d like to get some confirmation that things actually do work. Unit testing to the rescue I&#8217;d say ;)</p>

<p>The first thing we&#8217;re going to need is way to verify that stuff actually got intercepted. I did that by subclassing the LoggingInterceptor with a LoggingCounterInterceptor in my unit test project.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">LoggingCounterInterceptor</span> <span class="p">:</span> <span class="n">LoggingInterceptor</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">Count</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">ErrorCount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Reset</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Count</span> <span class="p">=</span> <span class="n">ErrorCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">LoggingCounterInterceptor</span><span class="p">(</span><span class="n">ILogger</span> <span class="n">logger</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">BeforeInvoke</span><span class="p">(</span><span class="n">Ninject</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Interception</span><span class="p">.</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Count</span><span class="p">++;</span>
</span><span class='line'>        <span class="k">base</span><span class="p">.</span><span class="n">BeforeInvoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnError</span><span class="p">(</span><span class="n">Ninject</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Interception</span><span class="p">.</span><span class="n">IInvocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Exception</span> <span class="n">exception</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ErrorCount</span><span class="p">++;</span>
</span><span class='line'>        <span class="k">base</span><span class="p">.</span><span class="n">OnError</span><span class="p">(</span><span class="n">invocation</span><span class="p">,</span> <span class="n">exception</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//The attribute for testing</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">LogMyCallsCounterAttribute</span> <span class="p">:</span> <span class="n">InterceptAttribute</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nf">LogMyCallsCounterAttribute</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">LoggingCounterInterceptor</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the code above we&#8217;re just adding 2 counter properties to the interceptor and adding their counts at the appropriate time. Next we&#8217;re going to need some kind of service class or something on which we can use our interceptor, enter the InterceptedServiceMock.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IInterceptedServiceMock</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">void</span> <span class="nf">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>    <span class="k">void</span> <span class="nf">MethodThatThrowsAnException</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[LogMyCallsCounter]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">InterceptedServiceMock</span> <span class="p">:</span> <span class="n">IInterceptedServiceMock</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">MethodWithoutBody</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Nothing to do here</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">MethodThatThrowsAnException</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">&quot;Because I can.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code above has one method that should execute and one method that throws an exception so we can verify things get picked up accordingly. Now all that&#8217;s left to do is write the appropriate specs for them and see if they pass :)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Context(Description = &quot;Specifies the behavior for the LogMyCallsInterceptor&quot;)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">LogMyCallsInterceptorSpec</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">IKernel</span> <span class="n">_kernel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [BeforeEach]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Before</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">inlineModule</span> <span class="p">=</span> <span class="k">new</span> <span class="n">InlineModule</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Bind</span><span class="p">&lt;</span><span class="n">IInterceptedServiceMock</span><span class="p">&gt;().</span><span class="n">To</span><span class="p">&lt;</span><span class="n">InterceptedServiceMock</span><span class="p">&gt;());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">_kernel</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardKernel</span><span class="p">(</span><span class="k">new</span> <span class="n">LinFuModule</span><span class="p">(),</span> <span class="k">new</span> <span class="n">NLogModule</span><span class="p">(),</span> <span class="n">inlineModule</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [AfterEach]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">After</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_kernel</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [Specification(&quot;All this should do is show the calls in the test runner. It should log to the console&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">ShouldShowCallsInConsole</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">IInterceptedServiceMock</span><span class="p">&gt;();</span>
</span><span class='line'>        <span class="n">IContext</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardContext</span><span class="p">(</span><span class="n">_kernel</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IInterceptedServiceMock</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">IRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardRequest</span><span class="p">(</span>
</span><span class='line'>            <span class="n">context</span><span class="p">,</span>
</span><span class='line'>            <span class="n">service</span><span class="p">,</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">InterceptedServiceMock</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&quot;MethodWithoutBody&quot;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">interceptors</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">IInterceptorRegistry</span><span class="p">&gt;().</span><span class="n">GetInterceptors</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">enumerator</span> <span class="p">=</span> <span class="n">interceptors</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span>
</span><span class='line'>        <span class="n">enumerator</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptors</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 interceptor registered&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">LoggingCounterInterceptor</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">interceptor</span> <span class="p">=</span> <span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span> <span class="k">as</span> <span class="n">LoggingCounterInterceptor</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Not</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">Null</span><span class="p">();</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 invocation counted.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [Specification(&quot;Should show valid counts for a number of invocations&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Should_Show_Correct_Counts_For_Number_Of_Invocations</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">IInterceptedServiceMock</span><span class="p">&gt;();</span>
</span><span class='line'>        <span class="n">IContext</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardContext</span><span class="p">(</span><span class="n">_kernel</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IInterceptedServiceMock</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">IRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardRequest</span><span class="p">(</span>
</span><span class='line'>            <span class="n">context</span><span class="p">,</span>
</span><span class='line'>            <span class="n">service</span><span class="p">,</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">InterceptedServiceMock</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&quot;MethodWithoutBody&quot;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">interceptors</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">IInterceptorRegistry</span><span class="p">&gt;().</span><span class="n">GetInterceptors</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">enumerator</span> <span class="p">=</span> <span class="n">interceptors</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span>
</span><span class='line'>        <span class="n">enumerator</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptors</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 interceptor registered&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">LoggingCounterInterceptor</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">interceptor</span> <span class="p">=</span> <span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span> <span class="k">as</span> <span class="n">LoggingCounterInterceptor</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Not</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">Null</span><span class="p">();</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">&quot;There should be 3 invocations counted.&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">.</span><span class="n">ErrorCount</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&quot;There should be no errors counted.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [Specification(&quot;Should have the correct count of invocations and the correct error count.&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Should_Have_Correct_Invocation_And_Error_Count</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">IInterceptedServiceMock</span><span class="p">&gt;();</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardContext</span><span class="p">(</span><span class="n">_kernel</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IInterceptedServiceMock</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardRequest</span><span class="p">(</span>
</span><span class='line'>            <span class="n">context</span><span class="p">,</span>
</span><span class='line'>            <span class="n">service</span><span class="p">,</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">InterceptedServiceMock</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&quot;MethodWithoutBody&quot;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">errorRequest</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StandardRequest</span><span class="p">(</span>
</span><span class='line'>            <span class="n">context</span><span class="p">,</span>
</span><span class='line'>            <span class="n">service</span><span class="p">,</span>
</span><span class='line'>            <span class="k">typeof</span> <span class="p">(</span><span class="n">InterceptedServiceMock</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&quot;MethodThatThrowsAnException&quot;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">interceptors</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">IInterceptorRegistry</span><span class="p">&gt;().</span><span class="n">GetInterceptors</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">errorInterceptors</span> <span class="p">=</span> <span class="n">_kernel</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">IInterceptorRegistry</span><span class="p">&gt;().</span><span class="n">GetInterceptors</span><span class="p">(</span><span class="n">errorRequest</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">enumerator</span> <span class="p">=</span> <span class="n">interceptors</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span>
</span><span class='line'>        <span class="n">enumerator</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">();</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">errorEnumerator</span> <span class="p">=</span> <span class="n">errorInterceptors</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span>
</span><span class='line'>        <span class="n">errorEnumerator</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptors</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 interceptor registered&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">LoggingCounterInterceptor</span><span class="p">));</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">errorInterceptors</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 error interceptor registered&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">errorEnumerator</span><span class="p">.</span><span class="n">Current</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">LoggingCounterInterceptor</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">interceptor</span> <span class="p">=</span> <span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span> <span class="k">as</span> <span class="n">LoggingCounterInterceptor</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">errorInterceptor</span> <span class="p">=</span> <span class="n">errorEnumerator</span><span class="p">.</span><span class="n">Current</span> <span class="k">as</span> <span class="n">LoggingCounterInterceptor</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">MethodWithoutBody</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">try</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">service</span><span class="p">.</span><span class="n">MethodThatThrowsAnException</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">catch</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Not</span><span class="p">.</span><span class="n">Be</span><span class="p">.</span><span class="n">Null</span><span class="p">();</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">interceptor</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">&quot;There should be 3 invocations counted.&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">errorInterceptor</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 invocation counted.&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Specify</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">errorInterceptor</span><span class="p">.</span><span class="n">ErrorCount</span><span class="p">).</span><span class="n">Must</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;There should be 1 error counted.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Testing this got a little messy I have to admit that. Now for a concrete example of how that looks in my application:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Service(typeof(IBlogService))]</span>
</span><span class='line'><span class="na">[LogMyCalls]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">BlogService</span> <span class="p">:</span> <span class="n">DataServiceBase</span><span class="p">&lt;</span><span class="n">Blog</span><span class="p">&gt;,</span> <span class="n">IBlogService</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&#8217;s how I implemented logging for my application :) Needless to say it was the testing that took me the longest to write. And from now on I don&#8217;t have to worry anymore about forgetting that logger call. I always have minimal logging going. AOP is usefull in a lot more cases but this seemed like a good and easy example.</p>

<p>Our next post will deal with initializing the modules in your application and their respective behaviors.</p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f18%2fninject-part-2-customizing-your-infrastructure-for-logging%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f18%2fninject-part-2-customizing-your-infrastructure-for-logging%2f" alt="kick it on DotNetKicks.com" /></a></p>

<p>del.icio.us Tags: <a href="http://del.icio.us/popular/LightSpeed">LightSpeed</a>,<a href="http://del.icio.us/popular/Ninject">Ninject</a>,<a href="http://del.icio.us/popular/NLog">NLog</a>,<a href="http://del.icio.us/popular/Dependency%20Injection">Dependency Injection</a>,<a href="http://del.icio.us/popular/IoC">IoC</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">17</p>  
    <div class="month-year"><p><span>Apr</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/04/17/ninject-getting-all-the-stuff-youll-need/" title="">Ninject: Getting All the Stuff You&#8217;ll Need</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I have a new project I started and I could reevaluate my toolset :) I decided to take a closer look at <a href="http://ninject.org">Ninject</a>, <a href="http://code.google.com/p/moq/">Moq</a> and <a href="http://https//nspecify.svn.sourceforge.net/svnroot/nspecify">NSpecify</a>. <a href="http://code.google.com/p/moq/">Moq</a> has been talked about enough I think, a really nice way of mocking and I will definitely be using more of it. My original plan was to write one big blog post.. but it is going to be far too long, so I&#8217;m breaking it up in smaller bite size pieces.</p>

<p>What I did was download the code, have it rest on my pc for about a week, updated again when I really got round to using it. I read the <a href="http://dojo.ninject.org/wiki/display/NINJECT/Ninject+Manual">wiki</a> which gives a short introduction on what&#8217;s what in Ninject and everybodies jobs. Decided that the wiki was cool for some more theoretical knowledge but I really needed to see more code.</p>

<p>I opened the project and something rare happened: I was actually very happy with the code I found, not always the case I can tell you ;). Anyway the gold is in the unit tests, it&#8217;s got great test coverage and it shows lots of the possibilities of Ninject. It&#8217;s like a great big manual for you to get really advanced with it really quickly. I was slightly disappointed to see that there was no <a href="http://nlog-project.com">NLog</a> support for Ninject, that disappointment quickly turned in to joy when I figured out it only took me 20 minutes to plug NLog in. And it was added to the trunk the same day.</p>

<p>Now I don&#8217;t want to make this post about which DI framework is better Windsor, Spring, Structuremap or Ninject. I just know that Ninject and I will become good friends over the next couple of months I like it. Ninject outsources its proxy generation to either Castle&#8217;s DynamicProxy2 or to LinFu DynamicProxy. LinFu seemed like an interesting choice after reading <a href="http://www.codeproject.com/KB/cs/LinFuPart1.aspx">this codeproject article</a>. It&#8217;s supposedly faster than castle&#8217;s dynamic proxy. Luckily Ayende is there to put this in <a href="http://www.ayende.com/Blog/archive/2007/10/16/Trusting-the-benchmark.aspx">perspective</a>. And I can confirm that the error messages etc castle&#8217;s dynamic proxy generates are a lot more useful than LinFu.</p>

<p><img src="http://www.codeproject.com/KB/cs/LinFuPart1/LinFuGraph.png" alt="Screenshot - LinFuGraph.png" /></p>

<p>Anyway I&#8217;m using LinFu at the moment as the proxy generator for Ninject. I will walk you through a sample application I built that will deal with the following subjects of Ninject, Lightspeed and NLog. For Ninject we will use the dependency injection and it&#8217;s interceptor possibilities to implement AOP style logging. For Lightspeed we will create our own logger to plug into the context so that we can log what Lightspeed does too. And we want NLog to log through Lightspeed to our database so we&#8217;ll be creating a custom target for NLog as well.</p>

<p>But let&#8217;s start at the beginning doing DI with Ninject :).</p>

<p>The most important thing to remember: <strong>MAKE YOUR METHODS VIRTUAL</strong>. Once again <strong>make your methods virtual </strong>otherwise Ninject has a hard time generating proxies for your classes.</p>

<p>Ninject is different from most other DI Containers in that it doesn&#8217;t have XML-configuration, its configuration is done through code (wouldn&#8217;t be hard to add an XML configuration for it tho but what&#8217;s the point). No XML ?? Suits me fine, everybody that ever worked with me will agree : Ivan no like XML editing. Ninject takes a modular approach by using modules that you pass to a kernel. This is pretty nice that means that an assembly can have a couple of different sets of Modules and all the caller of that assembly needs to do is add the module with the appropriate configuration to their kernel.</p>

<p>Ninject supports DI on constructors, properties, methods and fields: <a href="http://dojo.ninject.org/wiki/display/NINJECT/Injection+Patterns">http://dojo.ninject.org/wiki/display/NINJECT/Injection+Patterns</a>.    <br/>
It basically boils down to decorating the item you want to inject with the attribute <em>[Inject]</em></p>

<p>Ninject allows you to do a lot of configuration through the use of attributes. But I think I&#8217;ll leave it at that for today and continue this tomorrow.   <br/>
Let&#8217;s look at a concrete class from what we&#8217;ve seen so far. The class below is the Logger implementation to plug into the LightSpeedContext. We will finish this later on but for now this will be enough to summarize today&#8217;s post.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Ninject.Core.Logging</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="nn">ILightSpeedLogger</span> <span class="p">=</span> <span class="n">Mindscape</span><span class="p">.</span><span class="n">LightSpeed</span><span class="p">.</span><span class="n">Logging</span><span class="p">.</span><span class="n">ILogger</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">INinjectLogger</span> <span class="p">=</span> <span class="n">Ninject</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Logging</span><span class="p">.</span><span class="n">ILogger</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">LoggingDemo.UI.Integration</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">///</span>
</span><span class='line'>    <span class="c1">/// This class intercepts logging messages from the LightSpeed context and</span>
</span><span class='line'>    <span class="c1">/// sends them to our NLog logger.</span>
</span><span class='line'>    <span class="c1">///</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">LightSpeedLogger</span> <span class="p">:</span> <span class="n">ILightSpeedLogger</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">INinjectLogger</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">NullLogger</span><span class="p">.</span><span class="n">Instance</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">LightSpeedLogger</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'><span class="na">        </span>
</span><span class='line'><span class="na">        [Inject]</span>
</span><span class='line'>        <span class="k">public</span> <span class="nf">LightSpeedLogger</span><span class="p">(</span><span class="n">INinjectLogger</span> <span class="n">logger</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cp">#region ILogger Members</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">LogSql</span><span class="p">(</span><span class="kt">object</span> <span class="n">sql</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">logger</span><span class="p">.</span><span class="n">Info</span><span class="p">(</span><span class="n">sql</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">LogDebug</span><span class="p">(</span><span class="kt">object</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">logger</span><span class="p">.</span><span class="n">Debug</span><span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cp">#endregion</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let me know what you think :)</p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f17%2fninject-getting-all-the-stuff-youll-need%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f17%2fninject-getting-all-the-stuff-youll-need%2f" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">15</p>  
    <div class="month-year"><p><span>Apr</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/04/15/minimal-ironrubysilverlight-examples-online/" title="">Minimal IronRuby/silverlight Examples Online</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I just posted the first post in my series on getting started with Silverlight and IronRuby on the <a href="http://rubydoes.net/">rubydoes.net</a> website</p>

<p>You can read more about it here: <a href="http://rubydoes.net/2008/04/14/silverlight-minimal-examples/">http://rubydoes.net/2008/04/14/silverlight-minimal-examples/</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">13</p>  
    <div class="month-year"><p><span>Apr</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/04/13/started-blogging-on-rubydoesnet/" title="">Started Blogging on rubydoes.net</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I just put my first post on <a href="http://rubydoes.net">http://rubydoes.net</a> <br/>
I&#8217;m starting a series there on using Silverlight and IronRuby to develop applications. <a href="http://rubydoes.net/2008/04/12/getting-started-with-silverlight-and-ironruby/">This post</a> is an introduction and announcement of my series on the topic.</p>

<p>I&#8217;m porting the <a href="http://www.voidspace.org.uk/ironpython/silverlight/index.shtml">IronPython examples</a> from Michael Foord to IronRuby and will do a new example every day of this week.</p>

<p>See you there :)</p>

<p>UPDATE: I didn&#8217;t make it clear but this blog will still be active. Just most of my IronRuby stuff will go on rubydoes.net</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">09</p>  
    <div class="month-year"><p><span>Apr</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/04/09/updated-my-lightspeed-model-generator/" title="">Updated My Lightspeed Model Generator</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>This week I could start a project that has a database that goes somewhat beyond a blog. This seemed to me like the best way to improve my model generator that <a href="http://flanders.co.nz/2008/02/09/using-ruby-to-generate-lightspeed-models-part-4-again/">I built earlier</a></p>

<p>And as expected I needed to tweak it a little so that it would work properly, and I added a feature.</p>

<p>Seen as there are 2 files generated for an entity if you add a private field that exists in the database there then the generator will skip it so that you can add more attributes than the ones this script generates for you. If you override a field you also have to put the property in the user file.</p>

<p>I also added support for generating a datacontext. If you want to use the Linq support that Lightspeed is getting then that is a starting point. The same goes for this class with user files and generated file as above, the user file takes precedence.</p>

<p>I hosted this project on <a href="http://code.google.com/p/model-generator-ruby/">google code</a> so you can check it out from there. Or you can download <a href="http://model-generator-ruby.googlecode.com/files/generate_ls_models.zip">todays version</a></p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f09%2fupdated-my-lightspeed-model-generator%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f09%2fupdated-my-lightspeed-model-generator%2f" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">06</p>  
    <div class="month-year"><p><span>Apr</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/04/06/an-ironruby-digg-client/" title="">An IronRuby Digg Client</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Scott Guthrie has a <a href="http://weblogs.asp.net/scottgu/archive/2008/02/22/first-look-at-silverlight-2.aspx">series of tutorials</a> on how to consume the Digg API with Silverlight and C#. I wanted to know if I could convert that tutorial to IronRuby.</p>

<p>What I came up has the same end result but due to the fact that IronRuby and its Silverlight implementation isn&#8217;t complete yet I can&#8217;t mimic the structure of that tutorial yet. I couldn&#8217;t yet figure out how to load external xaml files so I put all the xaml in one file.</p>

<p>I have one C# file that resides in the lib folder, this file is called DigStory.cs and contains a DiggStory class which represents a story on digg. It uses XLinq to parse the xml document and return a list of stories.</p>

<p><strong><a href="http://flanders.co.nz/wp-content/uploads/2008/04/digg.zip">Download the complete code</a></strong></p>

<p>The code contained in that file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">DiggStory</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Description</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">NumDiggs</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">Uri</span> <span class="n">HrefLink</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">ThumbNail</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">UserName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">diggstory</span><span class="p">&gt;</span> <span class="n">ParseFeed</span><span class="p">(</span><span class="kt">string</span> <span class="n">feedContent</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">diggFeed</span> <span class="p">=</span> <span class="n">XDocument</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">feedContent</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">from</span> <span class="n">story</span> <span class="k">in</span> <span class="n">diggFeed</span><span class="p">.</span><span class="n">Descendants</span><span class="p">(</span><span class="s">&quot;story&quot;</span><span class="p">)</span>
</span><span class='line'>                     <span class="k">where</span> <span class="n">story</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;thumbnail&quot;</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">story</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;thumbnail&quot;</span><span class="p">).</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;src&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">EndsWith</span><span class="p">(</span><span class="s">&quot;.gif&quot;</span><span class="p">)</span>
</span><span class='line'>                     <span class="k">select</span> <span class="k">new</span> <span class="n">DiggStory</span>
</span><span class='line'>                     <span class="p">{</span>
</span><span class='line'>                         <span class="n">Id</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span>
</span><span class='line'>                         <span class="n">Title</span> <span class="p">=</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)).</span><span class="n">Trim</span><span class="p">(),</span>
</span><span class='line'>                         <span class="n">Description</span> <span class="p">=</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)).</span><span class="n">Trim</span><span class="p">(),</span>
</span><span class='line'>                         <span class="n">ThumbNail</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;thumbnail&quot;</span><span class="p">).</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;src&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">,</span>
</span><span class='line'>                         <span class="n">HrefLink</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Uri</span><span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;link&quot;</span><span class="p">)),</span>
</span><span class='line'>                         <span class="n">NumDiggs</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;diggs&quot;</span><span class="p">),</span>
</span><span class='line'>                         <span class="n">UserName</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">story</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">).</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">,</span>
</span><span class='line'>                     <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I won&#8217;t post the xaml file because it&#8217;s a bit too long. I will however post the app.rb file and offer a little bit more explanation on that file.</p>

<figure class='code'><figcaption><span>app.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;System&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;Silverlight&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;System.ServiceModel.Web&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;Contract&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kp">include</span> <span class="no">System</span>
</span><span class='line'><span class="kp">include</span> <span class="no">System</span><span class="o">::</span><span class="no">Net</span>
</span><span class='line'><span class="kp">include</span> <span class="no">System</span><span class="o">::</span><span class="no">Windows</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">SilverlightApplication</span>
</span><span class='line'>  <span class="n">use_xaml</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">get_topic_url</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
</span><span class='line'>    <span class="s2">&quot;http://services.digg.com/stories/topic/</span><span class="si">#{</span><span class="n">topic</span><span class="si">}</span><span class="s2">?count=20&amp;appkey=http%3A%2F%2Fflanders.co.nz%2Fblog&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>  
</span><span class='line'>    <span class="n">search_button</span><span class="o">.</span><span class="n">click</span> <span class="k">do</span> <span class="o">|</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="o">|</span>
</span><span class='line'>      <span class="n">topic</span> <span class="o">=</span> <span class="n">search_textbox</span><span class="o">.</span><span class="n">text</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">client</span> <span class="o">=</span> <span class="no">WebClient</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>      <span class="n">client</span><span class="o">.</span><span class="n">download_string_completed</span> <span class="k">do</span> <span class="o">|</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">unless</span> <span class="n">args</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">stories</span> <span class="o">=</span> <span class="no">DiggStory</span><span class="o">.</span><span class="n">parse_feed</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">result</span><span class="p">);</span>
</span><span class='line'>          <span class="n">stories_list</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>          <span class="n">stories_list</span><span class="o">.</span><span class="n">items_source</span> <span class="o">=</span> <span class="n">stories</span><span class="p">;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">client</span><span class="o">.</span><span class="n">download_string_async</span> <span class="no">Uri</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">get_topic_url</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>
</span><span class='line'>      
</span><span class='line'>      
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  
</span><span class='line'>    <span class="n">stories_list</span><span class="o">.</span><span class="n">selection_changed</span> <span class="k">do</span> <span class="o">|</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
</span><span class='line'>        <span class="n">story</span> <span class="o">=</span> <span class="n">stories_list</span><span class="o">.</span><span class="n">selected_item</span>
</span><span class='line'>      
</span><span class='line'>        <span class="n">story_detail</span><span class="o">.</span><span class="n">data_context</span> <span class="o">=</span> <span class="n">story</span><span class="p">;</span>
</span><span class='line'>        <span class="n">story_detail</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="no">Visibility</span><span class="o">.</span><span class="n">Visible</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  
</span><span class='line'>    <span class="n">close_button</span><span class="o">.</span><span class="n">click</span> <span class="k">do</span> <span class="o">|</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
</span><span class='line'>      <span class="n">story_detail</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="no">Visibility</span><span class="o">.</span><span class="n">Collapsed</span>
</span><span class='line'>  
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>  
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">App</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above code contains all the code necessary for our application.</p>

<p>We first tell the application to use the app.xaml file. Next we define a method that builds us the request url for the digg api. I chose to use the xml format to stay as close as possible to the sample of Scott.</p>

<p>Like in the C# sample we&#8217;re also downloading the file asynchronous. In the callback for when the request completes we parse the returned string into a list of stories and set that as the item source of our Listbox in the app.xaml file.</p>

<p>We handle the selection_changed event of the ListBox to display a detail view on a story with a link to the digg page.</p>

<p>More explanation on the xaml can be found on <a href="http://weblogs.asp.net/scottgu/archive/2008/02/22/first-look-at-silverlight-2.aspx">Scotts blog</a>.</p>

<p>Make sure you get the bits you need from the <a href="http://dynamicsilverlight.net">dynamic silverlight website</a> needed for running dynamic silverlight applications.</p>

<p>Put the path to chiron.exe in your PATH variable and extract the contents of the downloaded sample. open a command prompt and go to the location where you extracted the files to. type chiron /b and click on index.html</p>

<p><strong><a href="http://flanders.co.nz/wp-content/uploads/2008/04/digg.zip">Download the complete code</a></strong></p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f06%2fan-ironruby-digg-client%2f"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2f2008%2f04%2f06%2fan-ironruby-digg-client%2f" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">19</p>  
    <div class="month-year"><p><span>Mar</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/03/19/made-some-changes-the-macbook-5-weeks-in/" title="">Made Some Changes: The Macbook 5 Weeks In</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I&#8217;ve been using my macbook as my personal and work pc. So I&#8217;ve had windows vista installed on it for all this time. While in the beginning everything seemed to work just fine. This week my vista box didn&#8217;t want to move if its live depended on it. So I upgraded my vista install to an XP install. So far the XP machine is heaps faster than the vista box. It has the same software installed as my vista box and yet it works suprisingly better.</p>

<p>The only thing that kept me on vista was IIS7 because I like to use my projects as roots not as virtualdirs. I do most of my development as webdevelopment, but then again it&#8217;s rare that I&#8217;m working on a project that needs more than one root website, so I let that go.</p>

<p>I care most about speed or lack thereof and in my previous setup it was definitely lack thereof.</p>

<p>So I thought I&#8217;d share some of my thoughts around switching.</p>

<p>OSX and windows is the combination that can do it all. I use visual studio with resharper through parallels and with XP it seems to be able to keep up with my typing.</p>

<p>Explorer on Vista is the best file browser I&#8217;ve ever used. Finder on OSX is utter crap, the UI is crappy and the UX is just egregious (thanks to sbellware for teaching me this word).</p>

<p>I use paid for and use Pathfinder on my OSX and that is more usable although a bit heavyweight for something that should just enumerate the filesystem.</p>

<p>Somebody didn&#8217;t think that menubar through properly because people nowadays use 2 monitors or more, having consistent shortcuts would make this less of an issue.</p>

<p>Consistency on keyboard shortcuts is something I miss but got over it and have a post where I explain what I did to make it work slightly better <a href="http://flanders.co.nz/2008/02/07/more-on-mac-keybindings/">http://flanders.co.nz/2008/02/07/more-on-mac-keybindings/</a></p>

<p>And that was about all the bad news I have apart from the fact that my macbook pro can get incredibly hot. This can be remedied to some extent by installing <a href="http://homepage.mac.com/holtmann/eidac/software/smcfancontrol2/index.html">smcfancontrol</a></p>

<p>Now onto the good news.</p>

<p>Configuration on the filesystem is so much better than having a registry hive that gets corrupted now and again.</p>

<p>The speed of my OSX is great, startup time is much shorter.</p>

<p>The whole experience of organising my personal stuff like photos, music and how it integrates in the OS and other programs is fantastic. I don&#8217;t want to go back to a broken model for this.</p>

<p>Sleep just works and i&#8217;m not hoping and praying that when i use it my box will recover from it. It&#8217;s incredibly light and the battery life of 4 hours without windows running or 2.5 hours with windows running is still very ok for me.</p>

<p>In terms of UI slickness I have to give the advantage to a linux distro with Compiz enabled they give you the freedom to choose how your computer behaves on certain actions instead of no options on windows and 2 choices on OSX.</p>

<p>I don&#8217;t think Apple has innovated much on an OS level apart from the Dock. IMHO OSX isn&#8217;t perfect but it is really great at its job and stays out of my way.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">19</p>  
    <div class="month-year"><p><span>Mar</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/03/19/made-some-changes-moved-blogs/" title="">Made Some Changes: Moved Blogs</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>First off. Maybe you haven&#8217;t noticed but I switched my blogging engine from Subtext to wordpress. I did this not because I think Subtext is bad. I actually liked it, but because of my host. I was hosting my blog with webhost4life. I get a very very modest amount of people over my blog daily but even that wouldn&#8217;t work. It doesn&#8217;t have anything to do with the blogging engine and everything with them. I tried using that server as a stagingserver for an app I built for a client and in the end we staged it from my pc over and adsl line (NZ to Belgium) and that was faster.</p>

<p>I wasn&#8217;t looking forward to moving blogging engines because I don&#8217;t want my permalinks to change etc. The whole move was less painful than expected because somebody had already done the work and made a nice write-up. <a href="http://www.aaronlerch.com/blog/2007/08/23/breaking-up-moving-blog-engines/">http://www.aaronlerch.com/blog/2007/08/23/breaking-up-moving-blog-engines/</a></p>

<p>For the moment I&#8217;m running wordpress. Everything seems to work ok and I don&#8217;t have to restart it 2 or 3 times a day by &#8220;changing&#8221; my web.config. So in short long live more reliable hosting.</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">18</p>  
    <div class="month-year"><p><span>Mar</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/03/18/a-status-report-on-the-ironruby-inaction-book/" title="">A Status Report on the IronRuby in Action Book</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>The last couple of months I&#8217;ve been fairly busy writing my book. I had a first draft ready and that was submitted for review.</p>

<p>At this moment I&#8217;m working through all the remarks that the reviewers gave me. Some of them were quite good and made me realise that not everybody expects what I&#8217;m expecting from an IronRuby book. So I&#8217;ve been expanding some explanations and rewriting big chunks. I expect that we will have another review round soon. I have to process those remarks again and at that stage we&#8217;ll probably be ready to publish it in and EAP style.</p>

<p>Now that my first 3rd is done I&#8217;m starting at actually developing applications with IronRuby. I&#8217;m pretty curious to a couple of things from the community.</p>

<p>At this stage I have the following things planned for DataAccess.</p>

<p>I&#8217;ll include a brief tutorial on how to use IronRuby with:</p>

<ul>
<li>SubSonic</li>
<li>Castle ActiveRecord</li>
<li>Linq2Sql</li>
<li>Rails ActiveRecord</li>
<li>LightSpeed</li>
</ul>


<p>I would like to know which one I should emphasize most and focus on most.</p>

<p>After that I&#8217;m starting on WPF and/or Winforms. At this stage I&#8217;ve only planned to talk about WPF and not about Winforms. But I&#8217;d like to confirm if that is the general idea from the people that are going to take this IronRuby ride with me.</p>

<p>When I start talking about ASP.NET which topics are of most interest ?</p>

<p>That are all the questions I have for now. When I have more questions I&#8217;ll surely post them. And I would like to thank everybody that puts his 2c in.</p>

<p>I&#8217;ll post more when I have more news around the book.</p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2008%2f03%2f18%2fa-status-report-on-the-ironruby-inaction-book.aspx"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2008%2f03%2f18%2fa-status-report-on-the-ironruby-inaction-book.aspx" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">08</p>  
    <div class="month-year"><p><span>Mar</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/03/08/color-scheme-for-visual-studio-with-resharper-and-ruby-in/" title="">Color Scheme for Visual Studio With Resharper and Ruby in Steel Support</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>This is certainly an exciting time for me. A release of dynamic silverlight that supports IronRuby, Asp.NET MVC that can be used to in conjunction with that.</p>

<p>I think that web applications and the way the web looks will severely change in the near future.</p>

<p>Anyway not only the people at Microsoft have been busy also the guys from <a href="http://www.sapphiresteel.com">sapphiresteel</a> have been busy lately. They releases a really cool update to their Ruby In Steel product. A visual rails work bench and support for developing IronRuby apps with visual studio !</p>

<p>I finally got round to doing some installs/upgrades on my machine and played around with the color scheme until it suited me. I&#8217;ll post that here.</p>

<p>I use Resharper 4 as well as IronRuby and in Resharper I have code analysis turned on with color identifiers. So my scheme needs to support those.</p>

<p>I don&#8217;t like bright colors nor a totally black background, they have the same effect as a white background on me. I get migraines and can&#8217;t concentrate as long as I need to. (the latter may also be due to undiagnosed ADD).</p>

<p>So in C# with resharper the code looks like this:</p>

<p><a href="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/CsharpColors.png"><img src="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/CsharpColors_thumb.png" alt="CsharpColors" /></a></p>

<p>I do lot&#8217;s of webdevelopment but I haven&#8217;t tuned the colors for xaml yet. Will probably get round to doing that next weekend. This is how the html colors look (this is from rails html but html looks the same).</p>

<p><a href="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/html.png"><img src="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/html_thumb.png" alt="html" /></a></p>

<p>Then there still is ruby to show and a config file.</p>

<p>Here&#8217;s ruby:</p>

<p><a href="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/rubyscheme.png"><img src="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/rubyscheme_thumb.png" alt="rubyscheme" /></a></p>

<p>And lastly the config files:</p>

<p><a href="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/webconfigscheme.png"><img src="http://flanders.co.nz/blog/images/Colorschemeforvisualstudiowithresharpera_1257D/webconfigscheme_thumb.png" alt="webconfigscheme" /></a></p>

<p>Get <a href="http://koolkraft.net/DimmedInkResharperRubyInSteel.zip">DimmedInkResharperRubyInSteel (Visual Studio 2008)</a><br/>
Get <a href="http://koolkraft.net/DimmedInkResharperRubyInSteel_vs2k5.zip">DimmedInkResharperRubyInSteel (Visual Studio 2005)</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  <div class="pagination">
    
      <a class="prev" href="/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/4/">Newer &rarr;</a>
    
  </div>
</div>
</div>


      </div>
    </div>
    <footer role="contentinfo"><!-- start of footer container -->
  <div class="container">
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="twelve columns">
        <div class="logo">
          <img src="/images/logo.png" alt="" />
          <h2>Rants &amp; ramblings</h2>
        </div>
      </div>

      <div class="four columns">        
        <h6>Social networks</h6>
        <ul class="social_network">
          <li class="rollover"><a href="http://facebook.com/ivanportocarrero" class="yellowtip" title="Facebook"><span class="fb-rollover"></span><img src="/images/social/fb.png" alt="" /></a></li>
          <li class="rollover"><a href="http://twitter.com/casualjim" class="yellowtip" title="Follow me"><span class="twitter-rollover"></span><img src="/images/social/twitter.png" alt="" /></a></li>
          <li class="rollover"><a href="https://plus.google.com/u/1/106536131996809745163/posts" class="yellowtip" title="Google plus"><span class="google-rollover"></span><img src="/images/social/google-plus.png" alt="" /></a></li>
        </ul>       
      </div>
    </div>
    <!-- end of row -->
  
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="eight columns">
        <h6>About me</h6>
        <p>
        Welcome to my blog. This is a collection of random thoughts and rants.
        </p>
        <p>
        Allow me to introduce myself. My name is Ivan Porto Carrero and I'm an enthusiastic developer on  Scala, .NET and Ruby.<br />Through this blog I hope I can share some of that passion and maybe help somebody out when they are looking on how to do something.
        </p>
      </div>
      <div class="four columns">
        <h6>Latest posts</h6>
        <ul class="square">
        
          <li>
            <a href="/2011/08/01/backchat-developers/">work for backchat</a>
          </li>
        
          <li>
            <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
          </li>
        
          <li>
            <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
          </li>
        
          <li>
            <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
          </li>
        
          <li>
            <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
          </li>
        
        </ul> 
      </div>
      <div class="four columns">
        <h6>Browse pages</h6>
        <ul class="square">
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archives</a></li>
          <li><a href="/projects">My projects</a></li>
        </ul> 
      </div>
    </div>
    <!-- end of row -->
    

    <!-- start of footer divider -->
    <div class="sixteen columns">
      <div class="footer-divider row"></div>
    </div>  
    <!-- end of footer divider -->
    
    <!-- start of bottoms -->
    <div class="clearfix footnote">
      <div class="eight columns">
        <p class="copyright">Copyright &copy; 2012 - Ivan Porto Carrero - All Right Reserved</p>
      </div>
      <div class="eight columns">
        <p class="align-right"><span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, designed by <a href="http://iweb-studio.com" target="_blank">iwebstudio</a></p>
      </div>
    </div>
    <!-- end of bottoms -->

  </div>
  <!-- end of footer container -->

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'casualjim';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<p id="back-top">
  <a href="#top"><span></span>To top</a>
</p>

</body>
</html>
