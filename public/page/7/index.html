
<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <meta charset="utf-8">
  <title>Ivan Porto Carrero</title>
  <meta name="author" content="Ivan Porto Carrero">

  
  <meta name="description" content="Last week I ordered a macbook pro (2.6Ghz - 4GB RAM - 200GB/7200RPM HD) through the shop. It took about 10 days to arrive. I found that the process &hellip;">
  

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- http://t.co/dKP3o1e -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="canonical" href="http://flanders.co.nz/page/7">
  <link href="/favicon.png" rel="icon">
  <link href="/css/base.css" rel="stylesheet" type="text/css">
  <link href="/css/skeleton.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">
  <link href="/css/style.css" rel="stylesheet" type="text/css">
  <link href="/css/skins/blue.css" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

  <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>  
  <script src="/js/modernizr.js" type="text/javascript"></script>
  <script src="/js/jquery.easing.1.3.js" type="text/javascript"></script>
  <script type="text/javascript" src="/js/jquery.illuminate.0.7.min.js"></script>
  <!-- tweet
  <script type="text/javascript" src="/js/tweet/twitter.js"></script>
  <script type="text/javascript" src="/js/tweet/setting.js"></script> -->
  
  <script type="text/javascript" src="/js/custom.js"></script>
  <link href="/atom.xml" rel="alternate" title="Ivan Porto Carrero" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-240612-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <div id="wrapper">
    <header role="banner"> <div class="container">
    <div class="row clearfix">
      <hdgroup>
        <div class="four columns">
          <div class="logo">
            <img src="/images/logo.png" alt="" />
            <h2>Rants &amp; ramblings</h2>
          </div>  
        </div>
      </hdgroup>
      <nav role="navigation"><!-- <ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:flanders.co.nz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
   -->
<ul>
  <li>
    <a href="/">Home
      <span>Homepage</span>
    </a>    
  </li>
  <li>
    <a href="/archives">Archives
      <span>Articles</span>
    </a>    
  </li>
  <li>
    <a href="/projects">Projects
      <span>Open-Source</span>
    </a>    
  </li>
  <li>
    <a href="/about">About me
      <span>Introduction</span>
    </a>    
  </li>
</ul>
</nav>

    </div>
  </div>  
<!-- <hgroup>
  <h1><a href="/">Ivan Porto Carrero</a></h1>
  
    <h2>IO(thoughts) foreach (_.propagandize)</h2>
  
</hgroup>
 -->
</header>
    <div class="container bodycontent">
      <div class="row clearfix">
        <div class="sixteen columns headline">
          <h2>Ivan Porto Carrero</h2>
          <p class="italic">IO(thoughts) foreach (_.propagandize)</p>
        </div>
      </div>  

      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <!-- start of row -->
      <div class="row clearfix">
        <div class="sixteen columns">
          <!-- twitter feed -->
          <div class="twitter_feed">
            <ul class="tweet_list"></ul>
          </div>
        </div>
      </div>  
      <div class="sixteen columns">
        <div class="divider row"></div>
      </div>  
      
      <div id="maincontent" class="clearfix">
        <div class="five columns">  
  <aside class="left-sidebar">
    
        
<div class="widget row">
  <h5>Search form</h5>  
  <div id="search-form">
    <form action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:flanders.co.nz" />
        <input id="search-box" type="text" name="q" results="0" placeholder="Search"/>
        <input type="submit" value="Search" id="search-button" />
        <div class="clear"></div>
      </fieldset>
    </form>
  </div>
</div>
   <section>
  <div class="widget row">
    <h5>Recent Posts</h5>  
    <ul id="recent_posts">
      
        <li class="post">
          <a href="/2011/08/01/backchat-developers/">work for backchat</a>
        </li>
      
        <li class="post">
          <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
        </li>
      
        <li class="post">
          <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
        </li>
      
        <li class="post">
          <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
        </li>
      
        <li class="post">
          <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
        </li>
      
    </ul>
  </div>
</section>

<section>
  <div class="widget row">
    <h5>GitHub Repos</h5>
    <ul id="gh_repos">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    
    <a href="https://github.com/casualjim">@casualjim</a> on GitHub
    
  </div>
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = 'javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'casualjim',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"></script>
</section>


<section>
  <div class="widget row">
    <h5>Latest Tweets</h5>
    <ul id="tweets">
      <li class="loading">Status updating&#8230;</li>
    </ul>
    <script type="text/javascript">
      $(document).ready(function(){
        // getTwitterFeed("casualjim", 4, false);
      });
    </script>
    
      <a href="http://twitter.com/casualjim" class="twitter-follow-button" data-show-count="false">Follow @casualjim</a>
    
  </div>
</section>


<section>
  <div class="widget row">
    <h5>On Delicious</h5>
    <div id="delicious"></div>
    <script type="text/javascript" src="http://feeds.delicious.com/v2/json/casualjim?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
    <p><a href="http://delicious.com/casualjim">My Delicious Bookmarks &raquo;</a></p>
  </div>
</section>


<section class="googleplus">
  <div class="widget row">
    <h5>
      <a href="https://plus.google.com/106536131996809745163?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h5>
  </div>
</section>



    
  </aside>
</div>
<div class="eleven columns">
<div class="blog-index">
  
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">03</p>  
    <div class="month-year"><p><span>Feb</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/02/03/got-a-mac-book-pro-earlier-this-week/" title="">Got a Macbook Pro Earlier This Week</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Last week I ordered a macbook pro (2.6Ghz - 4GB RAM - 200GB/7200RPM HD) through the shop.</p>

<p>It took about 10 days to arrive. I found that the process was ok but there is a little bit less communication than when I ordered from Dell.
It will come as no suprise that the packaging was very well done :)</p>

<p>I &#8216;ve been using it for the last couple of days. It took me some time to get used to the different keyboard shortcuts that&#8217;s for sure.</p>

<p>I&#8217;m happy with my purchase but I do wonder what the harm is in providing a separate home and end key. If somebody knows how I can get a consistent word selection going ( I mean like ctrl - arrow or shift - ctrl - arrow) that would be of great help because that&#8217;s what annoys me most.
I set up a full copy of vista on my bootcamp partitition, it had to be the 32-bit so I can&#8217;t take full advantage of my 4GB of ram, but that&#8217;s the way it has to be because otherwise fusion won&#8217;t load my boot camp partitition.</p>

<p>I first tried with a copy of vista I generated with the <a href="http://www.vlite.net/">vlite</a> tool I <a href="http://flanders.co.nz/blog/archive/2007/09/21/vlite-stripping-down-your-vista-install.aspx">blogged</a> about earlier but it appears that the full version actually runs faster than the lite version I generated. This will probably be mostly because of my own stupidity than the tool. With the full version I could install all the software from the bootcamp cd which may be why it works faster.</p>

<p>The next couple of days were spent bonding with my new macbook. Being pleasantly surprised that visual studio 2008 with resharper runs at a really acceptable speed for day to day development through fusion with unity turned on. I&#8217;ll probably boot into windows when I have to do purely .NET development.</p>

<p>And now I did want to know of textmate is as good as they say it is or if it&#8217;s just hype for nothing. I&#8217;ve been using textmate the last couple of days for doing some ruby development and i have to admit that while it&#8217;s no visual studio for c# it&#8217;s definitely an enjoyable experience. I still have to memorise a lot of shortcuts but I&#8217;m well on my way :)</p>

<p><a href="http://codeclimber.net.nz/archive/2008/01/21/18-almost-free-applications-on-my-Mac.aspx">Simone&#8217;s post on 18 almost free applications for Mac OSX</a> got me everything I needed. I downloaded 2 or 3 extra programs. Like simone I&#8217;m trying to go as much native mac apps as possible. So far I have everything I need and need my windows box only for windows related development tools like LightSpeed, LLBLGen, SQL Server and Visual Studio etc.</p>

<p>7zX or something along those lines for zipping and unzipping 7z archives.<br/>
MacFUSE and NTFS-3G for mac OSX so that I can mount read/writeable NTFS volumes.</p>

<p>Another thing I wonder is if there maybe is a tree for navigating in finder. I&#8217;m having a hard time compiling IronRuby on OSX but I also haven&#8217;t really that hard yet.</p>

<p>Thanks to Simone I wrote this blog post with Ecto. I couldn&#8217;t believe how easy it was to connect to a windows vpn and remote desktop in there to fix up some servers.</p>

<p>My first week as a mac user was a success :D</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">16</p>  
    <div class="month-year"><p><span>Jan</span><br />2008</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2008/01/16/back-to-contracting/" title="">Back to Contracting</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Yesterday I gave notice at <a href="http://www.xero.com">Xero</a>, my last day will be mid February (15/02).</p>

<p>It&#8217;s been fun working with the team of people at Xero, but I just want my own time back. I won&#8217;t go into more detail around the reasons for my leaving Xero but we part ways on friendly terms.</p>

<p>I&#8217;ve been getting more and more into Ruby again and I really like that language. So I&#8217;m mostly interested in jobs that will allow me to use those dynamic languages. I can now take some time off to finish the book I&#8217;m writing and to do some coding on a couple of things I have in mind.</p>

<p>Ideal places for me to work would be a place that practices Agile development et al. I&#8217;ll be going back to contracting probably unless somebody makes me a really great offer :)</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">26</p>  
    <div class="month-year"><p><span>Dec</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/12/26/new-view-engines-in-the-mvccontrib-project-for-aspnet-mvc/" title="">New View Engines in the MvcContrib Project for asp.net Mvc</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>When I got back from visiting my parents over the christmas holiday I checked the <a href="http://www.codeplex.com/MVCContrib">MvcContrib</a> project to find out that both Andrew Peter&#8217;s <a href="http://andrewpeters.net/2007/12/19/introducing-nhaml-an-aspnet-mvc-view-engine/">NHAML view engine</a> and my <a href="http://flanders.co.nz/blog/archive/2007/12/15/xsltviewengine-patch-submitted.aspx">XSLT view engine</a> have been accepted in the trunk of those projects.</p>

<p>What&#8217;s left to do for me is provide a sample site that shows usage of the view engine.  This has been a very rewarding experience so far :). I found out about IViewSourceLoader to get the path to the current view file for example.</p>

<p>I also learnt a new trick to increase my test coverage and be able to test the content of the rendered view.</p>

<p>To get the mvc contrib project you can either download it from the <a href="http://www.codeplex.com/MVCContrib/Release/ProjectReleases.aspx">releases section</a> on the codeplex site.</p>

<p>Or you can check out the source code and build it yourself from the <a href="http://mvccontrib.googlecode.com/svn/trunk">subversion repository</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">19</p>  
    <div class="month-year"><p><span>Dec</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/12/19/and-another-view-engine-for-aspnet-mvc-has-been-born/" title="">And Another View Engine for ASP.NET MVC Has Been Born</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Andrew Peters wrote a <a href="http://andrewpeters.net/2007/12/19/introducing-nhaml-an-aspnet-mvc-view-engine/">view engine for HAML</a></p>

<p>NHaml (pronounced enamel) is a pure .NET implementation of the popular <a href="http://rubyonrails.com/">Rails</a><a href="http://haml.hamptoncatlin.com/">Haml</a> view engine. From the Haml website:</p>

<p><em>“Haml is a markup language that‘s used to cleanly and simply describe the XHTML of any web document, without the use of inline code. Haml functions as a replacement for inline page templating systems such as PHP, ERB, and ASP. However, Haml avoids the need for explicitly coding XHTML into the template, because it is actually an abstract description of the XHTML, with some code to generate dynamic content.”</em></p>

<p>Andrew and I share the same dislike for the xml family. XML is not fun to type, and I think his haml engine eases a lot of that pain. It results in far more readable views too.</p>

<p>2 view engines in one week and both from Wellington. Nice :)</p>

<p>del.icio.us Tags: <a href="http://del.icio.us/popular/aspnetmvc">aspnetmvc</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">16</p>  
    <div class="month-year"><p><span>Dec</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/12/16/implementing-filters-in-aspnet-mvc/" title="">Implementing Filters in asp.net Mvc</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>One of the things I wanted for the framework I&#8217;m building for Xero was to implement filters.</p>

<p>I have a first pass of those ready.. didn&#8217;t take me to long to implement either.  I only tested the before filters I haven&#8217;t gotten round to testing the After filter. I have to do a demo today that demonstrates databinding (like the castle project solved it.)  What I&#8217;m putting on my blog here is very much a proof of concept implementation and you should not use this in a production environment.</p>

<p>Here&#8217;s how I went about it. In this post I&#8217;ll show how I implemented a filter that directs anonymous users to the login page.</p>

<ol>
<li>Define a couple enumerations</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">enum</span> <span class="n">Execute</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Before</span><span class="p">,</span>
</span><span class='line'>    <span class="n">After</span><span class="p">,</span>
</span><span class='line'>    <span class="n">BeforeAndAfter</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">enum</span> <span class="n">SecureFor</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">None</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Anonymous</span><span class="p">,</span>
</span><span class='line'>    <span class="n">PerUser</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Create an IFilter interface</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Xero.Mvc.Extensions.Filters</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">interface</span> <span class="n">IFilter</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Execute</span> <span class="n">WhenToExecute</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="n">IHttpContext</span> <span class="n">HttpContext</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">void</span> <span class="n">Execute</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<ol>
<li>Create an AbstractFilter base class</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Xero.Mvc.Extensions.Filters</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [AttributeUsage(AttributeTargets.Class, Inherited = true, AllowMultiple = true)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractFilter</span> <span class="p">:</span> <span class="n">Attribute</span><span class="p">,</span> <span class="n">IFilter</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">whenToExecute</span><span class="p">;</span>
</span><span class='line'>        <span class="k">private</span> <span class="n">IHttpContext</span> <span class="n">httpContext</span><span class="p">;</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">AbstractFilter</span><span class="p">(</span><span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">whenToExecute</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">whenToExecute</span> <span class="p">=</span> <span class="n">whenToExecute</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">IHttpContext</span> <span class="n">HttpContext</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">httpContext</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>            <span class="k">set</span> <span class="p">{</span> <span class="n">httpContext</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">WhenToExecute</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">whenToExecute</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="n">Execute</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Create a SecureFilter base class</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Xero.Mvc.Extensions.Filters</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [AttributeUsage(AttributeTargets.Class, Inherited = true, AllowMultiple = true)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractSecureFilter</span> <span class="p">:</span> <span class="n">AbstractFilter</span><span class="p">,</span> <span class="n">IFilter</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">SecureFor</span> <span class="n">secureFor</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">AbstractSecureFilter</span><span class="p">(</span><span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">whenToExecute</span><span class="p">,</span> <span class="n">SecureFor</span> <span class="n">secureFor</span><span class="p">)</span>
</span><span class='line'>            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">whenToExecute</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">secureFor</span> <span class="p">=</span> <span class="n">secureFor</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">SecureFor</span> <span class="n">SecureFor</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">secureFor</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">void</span> <span class="n">RedirectToLogin</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">HttpContext</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">Redirect</span><span class="p">(</span><span class="s">&quot;~/&quot;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Implement the concrete AnonymousUsersFilter</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">Xero.Mvc.Extensions.Filters</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xero.Mvc.Tasklist.Model.EntityClasses</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xero.Mvc.LLBLGenIntegration.Services</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xero.Mvc.Extensions</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Xero.Mvc.Tasklist.Filters</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [AttributeUsage(AttributeTargets.Class, Inherited = true, AllowMultiple = true)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">AnonymousUsersFilter</span> <span class="p">:</span> <span class="n">AbstractSecureFilter</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="n">User</span><span class="p">[]</span> <span class="n">users</span><span class="p">;</span>
</span><span class='line'>        <span class="k">private</span> <span class="n">DataService</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">userService</span><span class="p">;</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">AnonymousUsersFilter</span><span class="p">(</span><span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">whenToExecute</span><span class="p">,</span> <span class="n">SecureFor</span> <span class="n">secureFor</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">whenToExecute</span><span class="p">,</span> <span class="n">secureFor</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="n">AnonymousUsersFilter</span><span class="p">(</span><span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">whenToExecute</span><span class="p">,</span> <span class="n">SecureFor</span> <span class="n">secureFor</span><span class="p">,</span> <span class="n">User</span><span class="p">[]</span> <span class="n">users</span><span class="p">)</span>
</span><span class='line'>            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">whenToExecute</span><span class="p">,</span> <span class="n">secureFor</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">users</span> <span class="p">=</span> <span class="n">users</span><span class="p">;</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">userService</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DataService</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">AnonymousUsersFilter</span><span class="p">(</span><span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span> <span class="n">whenToExecute</span><span class="p">,</span> <span class="n">User</span><span class="p">[]</span> <span class="n">users</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">whenToExecute</span><span class="p">,</span> <span class="n">SecureFor</span><span class="p">.</span><span class="n">PerUser</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span><span class="p">[]</span> <span class="n">Users</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">users</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="n">Execute</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">SecureFor</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">SecureFor</span><span class="p">.</span><span class="n">Anonymous</span> <span class="p">&amp;&amp;</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Session</span><span class="p">[</span><span class="s">&quot;userId&quot;</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">RedirectToLogin</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">SecureFor</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">SecureFor</span><span class="p">.</span><span class="n">PerUser</span> <span class="p">&amp;&amp;</span> <span class="n">Users</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                <span class="n">RedirectToLogin</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">SecureFor</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">SecureFor</span><span class="p">.</span><span class="n">PerUser</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">User</span> <span class="n">currentUser</span> <span class="p">=</span> <span class="n">userService</span><span class="p">.</span><span class="n">FindOneById</span><span class="p">((</span><span class="n">Guid</span><span class="p">)</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">Session</span><span class="p">[</span><span class="s">&quot;userId&quot;</span><span class="p">]);</span>
</span><span class='line'>                <span class="n">List</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">allowedUsers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;(</span><span class="n">Users</span><span class="p">);</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">allowedUsers</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">usr</span> <span class="p">=&gt;</span> <span class="n">usr</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">ToUpperInvariant</span><span class="p">()</span> <span class="p">==</span> <span class="n">currentUser</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">ToUpperInvariant</span><span class="p">())</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                <span class="n">RedirectToLogin</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Implement the filter on a controller</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[AnonymousUsersFilter(Xero.Mvc.Extensions.Execute.Before, SecureFor.Anonymous)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">SecureControllerBase</span> <span class="p">:</span> <span class="n">SmartXeroController</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>There are a couple of places where you can implement the execution of the filter logic. I chose to do it before the actual controller class is being loaded. To do that I had to create a handler and a routehandler</li>
</ol>


<p>7.a The MvcHandler</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web.Mvc</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xero.Mvc.Core.Exceptions</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xero.Mvc.Extensions.Filters</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Xero.Mvc.Extensions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">XeroMvcHandler</span> <span class="p">:</span> <span class="n">MvcHandler</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="n">ProcessRequest</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">IHttpContext</span> <span class="n">httpContext</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">RequestContext</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">throw</span> <span class="k">new</span> <span class="n">NoRequestContextException</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kt">string</span> <span class="n">controllerName</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RequestContext</span><span class="p">.</span><span class="n">RouteData</span><span class="p">.</span><span class="n">Values</span><span class="p">[</span><span class="s">&quot;controller&quot;</span><span class="p">].</span><span class="n">ToString</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">Type</span> <span class="n">controllerType</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">GetControllerType</span><span class="p">(</span><span class="n">controllerName</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">controllerType</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">throw</span> <span class="k">new</span> <span class="n">NoControllerFoundException</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">RequestContext</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Path</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">IFilter</span><span class="p">[]</span> <span class="n">filters</span> <span class="p">=</span> <span class="n">controllerType</span><span class="p">.</span><span class="n">GetCustomAttributes</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IFilter</span><span class="p">),</span> <span class="k">true</span><span class="p">)</span> <span class="k">as</span> <span class="n">IFilter</span><span class="p">[];</span>
</span><span class='line'>            <span class="n">filters</span>
</span><span class='line'>                <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">attr</span> <span class="p">=&gt;</span> <span class="n">attr</span><span class="p">.</span><span class="n">WhenToExecute</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span><span class="p">.</span><span class="n">Before</span> <span class="p">||</span> <span class="n">attr</span><span class="p">.</span><span class="n">WhenToExecute</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span><span class="p">.</span><span class="n">BeforeAndAfter</span><span class="p">)</span>
</span><span class='line'>                <span class="p">.</span><span class="n">ToList</span><span class="p">()</span>
</span><span class='line'>                <span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">attr</span> <span class="p">=&gt;</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="n">attr</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                        <span class="n">attr</span><span class="p">.</span><span class="n">HttpContext</span> <span class="p">=</span> <span class="n">httpContext</span><span class="p">;</span>
</span><span class='line'>                        <span class="n">attr</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">IController</span> <span class="n">controllerInstance</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">GetControllerInstance</span><span class="p">(</span><span class="n">controllerType</span><span class="p">);</span>
</span><span class='line'>            <span class="n">ControllerContext</span> <span class="n">controllerContext</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ControllerContext</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">RequestContext</span><span class="p">,</span> <span class="n">controllerInstance</span><span class="p">);</span>
</span><span class='line'>            <span class="n">controllerInstance</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">controllerContext</span><span class="p">);</span>
</span><span class='line'>            <span class="n">filters</span>
</span><span class='line'>                <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">attr</span> <span class="p">=&gt;</span> <span class="n">attr</span><span class="p">.</span><span class="n">WhenToExecute</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span><span class="p">.</span><span class="n">After</span> <span class="p">||</span> <span class="n">attr</span><span class="p">.</span><span class="n">WhenToExecute</span> <span class="p">==</span> <span class="n">Xero</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Execute</span><span class="p">.</span><span class="n">BeforeAndAfter</span><span class="p">)</span>
</span><span class='line'>                <span class="p">.</span><span class="n">ToList</span><span class="p">()</span>
</span><span class='line'>                <span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">attr</span> <span class="p">=&gt;</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="n">attr</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                        <span class="n">attr</span><span class="p">.</span><span class="n">HttpContext</span> <span class="p">=</span> <span class="n">httpContext</span><span class="p">;</span>
</span><span class='line'>                        <span class="n">attr</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>7b. The Route Handler</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web.Mvc</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Xero.Mvc.Extensions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">XeroMvcRouteHandler</span> <span class="p">:</span> <span class="n">IRouteHandler</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="cp">#region IRouteHandler Members</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">IHttpHandler</span> <span class="n">GetHttpHandler</span><span class="p">(</span><span class="n">RequestContext</span> <span class="n">requestContext</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="n">XeroMvcHandler</span> <span class="p">{</span> <span class="n">RequestContext</span> <span class="p">=</span> <span class="n">requestContext</span> <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cp">#endregion</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>And the last step is to tell your application that it needs to use the new route handler. You can do that in the <code>global.asax.cs</code></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">SetupRoutes</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">// Note: Change Url= to Url=&quot;[controller].mvc/[action]/[id]&quot; to enable </span>
</span><span class='line'>  <span class="c1">//       automatic support on IIS6 </span>
</span><span class='line'>
</span><span class='line'>  <span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Route</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;Login/Default.aspx&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">Defaults</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span> <span class="n">controller</span> <span class="p">=</span> <span class="s">&quot;Login&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="p">=</span> <span class="s">&quot;Index&quot;</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="k">null</span> <span class="p">},</span>
</span><span class='line'>      <span class="n">RouteHandler</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">XeroMvcRouteHandler</span><span class="p">)</span> <span class="c1">// Our custom route handler</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Route</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;[controller]/[action]/[id]&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">Defaults</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span> <span class="n">action</span> <span class="p">=</span> <span class="s">&quot;Index&quot;</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="k">null</span> <span class="p">},</span>
</span><span class='line'>      <span class="n">RouteHandler</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">XeroMvcRouteHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Route</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Url</span> <span class="p">=</span> <span class="s">&quot;Default.aspx&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">Defaults</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span> <span class="n">controller</span> <span class="p">=</span> <span class="s">&quot;Login&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="p">=</span> <span class="s">&quot;Index&quot;</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="k">null</span> <span class="p">},</span>
</span><span class='line'>      <span class="n">RouteHandler</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">XeroMvcRouteHandler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2007%2f12%2f17%2fimplementing-filters-in-asp.net-mvc.aspx"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2007%2f12%2f17%2fimplementing-filters-in-asp.net-mvc.aspx" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">14</p>  
    <div class="month-year"><p><span>Dec</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/12/14/xsltviewengine-patch-submitted/" title="">ASP.NET MVC XsltViewEngine, Patch Submitted to the Contrib Project</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>I just submitted a patch to the <a href="http://mvccontrib.org">mvc contrib project</a> that contains the xslt view engine I wrote for <a href="http://xero.com">Xero</a> without any of the dependencies from our own libraries or commercial components.</p>

<p>The bulk of the work is done in a class called XmlResponseBuilder which builds the xml document that is going to be transformed by the xsl stylesheet. Almost all the rest of the code is there just to build up this document.</p>

<p>The implementation of IView and IViewFactory were the easy bits :)</p>

<p>To use the View engine you need to take the following steps:</p>

<ol>
<li>Get the MVC Contrib project from google code</li>
</ol>


<p>repository url: <a href="http://mvccontrib.googlecode.com/svn/trunk/">http://mvccontrib.googlecode.com/svn/trunk/</a></p>

<ol>
<li>If the patch hasn&#8217;t been applied yet you can download it from: <a href="http://www.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=MVCContrib&amp;DownloadId=23748">http://www.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=MVCContrib&DownloadId;=23748</a></li>
</ol>


<p>After downloading the patch you can apply it to the downloaded mvc contrib project.</p>

<ol>
<li>I use a base controller to ensure that the correct data is passed to the view factory. This is the base controller class:</li>
</ol>


<p>public abstract class XeroControllerBase : Controller</p>

<p>    {</p>

<p>        private readonly XsltViewData vData = new XsltViewData();</p>

<p> </p>

<p>        protected IHttpSessionState Session</p>

<p>        {</p>

<p>            get { return ControllerContext.HttpContext.Session; }</p>

<p>        }</p>

<p> </p>

<p>        public XeroControllerBase()</p>

<p>        {</p>

<p>            ViewFactory = new XsltViewFactory();  </p>

<p>        }</p>

<p> </p>

<p>        #region Add datasource methods</p>

<p> </p>

<p>        protected void AddDataSource(IXmlConvertible dataSource)</p>

<p>        {</p>

<p>            vData.DataSources.Add(new XslDataSource(dataSource));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddDataSource(IXmlConvertible dataSource, string rootName)</p>

<p>        {</p>

<p>            vData.DataSources.Add(new XslDataSource(rootName, dataSource));</p>

<p>        }</p>

<p> </p>

<p>        #endregion</p>

<p> </p>

<p>        #region Add variable methods</p>

<p> </p>

<p>        protected void AddPageVar(string key, string value)</p>

<p>        {</p>

<p>            vData.PageVars.Add(key, value);</p>

<p>        }</p>

<p> </p>

<p>        #endregion</p>

<p> </p>

<p>        #region Add message methods</p>

<p> </p>

<p> </p>

<p>        protected void AddErrorMessage(string message)</p>

<p>        {</p>

<p>            vData.Messages.Add(new ErrorMessage(message));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddErrormessage(string message, string controlID)</p>

<p>        {</p>

<p>            vData.Messages.Add(new ErrorMessage(message, controlID));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddInfoMessage(string message)</p>

<p>        {</p>

<p>            vData.Messages.Add(new InfoMessage(message));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddInfoMessage(string message, string controlID)</p>

<p>        {</p>

<p>            vData.Messages.Add(new InfoMessage(message, controlID));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddAlertMessage(string message)</p>

<p>        {</p>

<p>            vData.Messages.Add(new AlertMessage(message));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddAlertMessage(string message, string controlID)</p>

<p>        {</p>

<p>            vData.Messages.Add(new AlertMessage(message, controlID));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddInfoHtmlMessage(string message)</p>

<p>        {</p>

<p>            vData.Messages.Add(new InfoHtmlMessage(message));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddInfoHtmlMessage(string message, string controlID)</p>

<p>        {</p>

<p>            vData.Messages.Add(new InfoHtmlMessage(message, controlID));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddErrorHtmlMessage(string message)</p>

<p>        {</p>

<p>            vData.Messages.Add(new ErrorHtmlMessage(message));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddErrorHtmlmessage(string message, string controlID)</p>

<p>        {</p>

<p>            vData.Messages.Add(new ErrorHtmlMessage(message, controlID));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddAlertHtmlMessage(string message)</p>

<p>        {</p>

<p>            vData.Messages.Add(new AlertHtmlMessage(message));</p>

<p>        }</p>

<p> </p>

<p>        protected void AddAlertHtmlMessage(string message, string controlID)</p>

<p>        {</p>

<p>            vData.Messages.Add(new AlertHtmlMessage(message, controlID));</p>

<p>        }</p>

<p> </p>

<p>        #endregion</p>

<p> </p>

<p>        #region RenderView method hides</p>

<p> </p>

<p>        protected new virtual void RenderView(string viewName)</p>

<p>        {</p>

<p>            RenderView(viewName, string.Empty, vData);</p>

<p>        }</p>

<p> </p>

<p>        protected new void RenderView(string viewName, string masterName)</p>

<p>        {</p>

<p>            RenderView(viewName, string.Empty, vData);</p>

<p>        }</p>

<p> </p>

<p>        protected new void RenderView(string viewName, object viewData)</p>

<p>        {</p>

<p>            RenderView(viewName, string.Empty, vData);</p>

<p>        }</p>

<p> </p>

<p>        #endregion </p>

<p>    }</p>

<p> </p>

<p>del.icio.us Tags: <a href="http://del.icio.us/popular/aspnetmvc">aspnetmvc</a></p>

<p> </p>

<p><a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2007%2f12%2f15%2fxsltviewengine-patch-submitted.aspx"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fflanders.co.nz%2fblog%2farchive%2f2007%2f12%2f15%2fxsltviewengine-patch-submitted.aspx" alt="kick it on DotNetKicks.com" /></a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">12</p>  
    <div class="month-year"><p><span>Dec</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/12/12/aspnet-mvc-taken-for-a-test-drive/" title="">ASP.NET Mvc Taken for a Test Drive</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>A couple of days ago Microsoft released a CTP of the much discussed ASP.NET MVC handler. I decided to take it for a test drive.</p>

<p>At first I just wanted to have a look at how to use the MVC handler with the ADO.NET Entities but quickly found that I can easily replace like the view engine.</p>

<p>So I diverted my intentions and wanted to look at how hard it would be to plug it straight into the architecture of xero.</p>

<p>At Xero we currently use a 2 step view approach where each page transforms its output through xsl and renders html that way.  Our O/R Mapper of choice is LLBLGen Pro, who does a great job at mapping stuff but the API could be a lot nicer IMHO.</p>

<p>I&#8217;ll make my application available soon, as soon as I removed the dependencies on LLBLGen and some of our custom classes. I have to do it this way because we&#8217;re a publicly listed company and I&#8217;m not allowed to give out that information.</p>

<p>Aaanyway in all it took me about 4 hours to plug in an xslt view engine and implement attribute based filters.</p>

<p>Overall I&#8217;m quite happy with what I&#8217;m seeing that&#8217;s in there. A couple of convenience methods like RenderText(&#8230;) would be nice. It would also be cool if it could find out the name of the requested action and then pass that as the current view so you don&#8217;t have to specify the name of which view you want to render all the time.</p>

<p>We did run into some trouble while writing unit tests apparently we can&#8217;t pass the view context a temp data dictionary but I&#8217;m sure that will be fixed soon.</p>

<p>So my conclusion is: There did go a fair bit amount of thought into the handler. I like what I see very much and I&#8217;ll definitely keep a close eye on new developments in that space.</p>

<p>del.icio.us Tags: <a href="http://del.icio.us/popular/asp.net%20mvc">asp.net mvc</a>,<a href="http://del.icio.us/popular/xero%20architecture">xero architecture</a>,<a href="http://del.icio.us/popular/aspnetmvc">aspnetmvc</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">27</p>  
    <div class="month-year"><p><span>Nov</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/11/27/re-the-difference-between-meta-programming-and-il-weaving/" title="">Re: The Difference Between Meta Programming and IL Weaving</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Ayende <a href="http://ayende.com/Blog/archive/2007/11/27/The-difference-between-meta-programming-and-IL-weaving.aspx">replied</a> to <a href="http://flanders.co.nz/blog/archive/2007/11/27/mixins-in-c-3.0.aspx">my post</a> from this morning. His point is that the in order to be able to do meta programming Reflection.Emit isn&#8217;t enough because it happens after the compilation has taken place. And in order to do meta programming you need to be able to do that during the compilation step. This is my reply, hence the title :)</p>

<p>Meta-programming can be achieved by having the language implementation change classes or generate classes at some point. In dynamic languages that is generally at run time, it&#8217;s most common use is where the data format drives the code ie. a database, csv files etc. For the sake of this discussion i&#8217;m going to keep it at runtime, if meta programming occurs at compilation time it loses a lot of its power, how is it going to respond to changes at runtime like changes in the data schema.</p>

<p>You could do this by having an interface of your implementation, If you&#8217;re going to use an interface implementation you can just as well generate the class or implement the class. Another thing you need for meta programming is duck typing. So for meta programming to happen you would have to forgo things like type checking, looking for existing methods on classes etc. You would lose the biggest advantage of a statically typed language and one of the biggest reasons for having a compiler at all. So, with all due respect, I wonder at that point why use a static typed language implemented on a compiler, that will make things really hard for you, at all when you can achieve the same things in other dynamically typed languages with hardly any effort.</p>

<p>If all you want is ruby with c# syntax, then you will lose exactly what makes ruby so attractive its more natural syntax. At this moment the IronRuby implementation still needs a lot of work but you could use Ruby.NET and get a good working version of Ruby that runs and compiles on the CLR. Or use ironpython that implementation is a lot more usable at this moment and you can do interop with .NET assemblies.</p>

<p>With Reflection.Emit you can get similar things. You can&#8217;t modify existing classes but when you would be using something like an IoC container that keeps track of dynamic proxy wrappers that are being generated so that it can always use the latest proxy wrapper, that way you could achieve almost the same thing. This won&#8217;t be the fastest method around but it would give you most the needed abilities. You would still need at least some interfaces and know about those interfaces upfront. After all MSIL is much like a dynamic language.</p>

<p>I still wouldn&#8217;t exactly call it meta programming but it can come close, you wouldn&#8217;t be able to modify existing classes but you would be able to add functionality to classes. It also won&#8217;t be the most easy thing to implement correctly but in theory it can be done.</p>

<p>Method missing in ruby works because the ruby interpreter walks up its tree of objects looking for an implementation of method_missing but that&#8217;s also what makes method missing not the fastest mechanism around.</p>

<p>This whole discussion made me think of a generalization Greenspun&#8217;s 10th law: &#8220;any sufficiently complicated program in a statically-typechecked language contains an ad-hoc, informally-specified bug-ridden slow implementation of a dynamically-checked language.&#8221; ;)</p>

<p>What would the implementation of IDynamicObject be ? Would it suddenly drop the type checking for implementing classes and defer that to runtime? How would you like to see IDynamicObject happening without losing static typing along the way ? I would like to find out these things interest me tremendously, I&#8217;m always looking for ways to make C# more dynamic but I don&#8217;t want to lose static typing along the way.  I would like to use C# instead of C++ for speed and use IronRuby for the rest for example, shifting those languages one era along.</p>

<p>del.icio.us Tags: <a href="http://del.icio.us/popular/Ruby">Ruby</a>,<a href="http://del.icio.us/popular/Ironruby">Ironruby</a>,<a href="http://del.icio.us/popular/C#%203.0">C# 3.0</a>,<a href="http://del.icio.us/popular/meta%20programming">meta programming</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">26</p>  
    <div class="month-year"><p><span>Nov</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/11/26/mixins-in-c-30/" title="">Getting Mixin Like Behavior in C# 3.0</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>UPDATE: I titled this post wrong. I should have said that you can mimic Mixins to a certain extend with extensions methods.  But extension methods are exactly that, <strong>Exten(d)</strong>sions of classes. These methods only have access to the public interface of a class you. You also need to specify a using statement with the namespace of your extension class to every class you want to be using the extended object in. Extension methods are syntactic sugar for what you used to do with static helper methods.  That are IMHO the most important differences with a mixin because instead of mixing in functionality you are now extending an existing objects. So the title of the post used to be Mixins in C# 3.0.  And now is getting mixin like behavior in C# 3.0</p>

<p>Yesterday Jeremy Miller put a post up with a <a href="http://codebetter.com/blogs/jeremy.miller/archive/2007/11/25/what-do-you-want-in-c-vnext.aspx">list of features</a> he would like to see added to the next version of C#. I don&#8217;t agree with everything on that list and some of it is already here.</p>

<p>I&#8217;ll take his points and add my comments to them.:</p>

<ol>
<li><p>Mixins (I&#8217;ll demonstrate how to get mixin like behavior in C#)</p></li>
<li><p>Symbols => useless, a symbol is nothing but an interned string. C# is a static language why on earth would you want to go and add non statically typed features to that language</p></li>
<li><p>Hashes => Hashes are already a languages feature in C# 3.0, they are called dictionaries.</p></li>
<li><p>Automatic delegation => as Ayende said: Mixins</p></li>
<li><p>Metaprogramming => no objection here although you can do it now with reflection emit</p></li>
<li><p>Make virtual the default to make mocking easier.</p></li>
</ol>


<p> </p>

<p>Ayende has got a similar <a href="http://www.ayende.com/Blog/archive/2007/11/26/C-vNext.aspx">reply up on his blog</a> and he adds a couple of features.     <br/>
I agree with his features so I won&#8217;t be commenting on them except for asking <em>when do we get those</em>?</p>

<p>Now the bigger problem I&#8217;ve got with this is I quite like the distinction of capabilities from one language to the next. Like say Ruby vs. C# there are things that can be easily or better done using c# and there are things that are easier using ruby. <strong>However why aren&#8217;t you using Ruby if all you want are language features from Ruby in C# ? </strong>Ruby is a beautiful language and it&#8217;s not just because of the features, they make it even nicer. It&#8217;s because of the syntax and the freedom.</p>

<p>I think Ayende clearly gets the benefits because he uses boo a lot. I tend to use Ruby a lot more than I do boo.</p>

<p>Now let&#8217;s get on to what is the title of this post.</p>

<p>The way I see it a Mixin is a way to add additional and common logic to classes, you can&#8217;t do that in C# at this moment but you can get mixin like behavior by using extension methods.</p>

<p>And this can be achieved by using extension methods in 2 different ways. The <a href="http://msdn2.microsoft.com/en-us/vcsharp/bb625996.aspx">first approach has been documented by Bill Wagner</a> but for the record I only found out about it after I had written my little test application to show you what I think is the best way of implementing Mixins. A mixin is often compared to an interface and it&#8217;s implementation (you can&#8217;t use an abstract class because that could break your inheritance chain in the long run, interfaces are the correct way to implement them)</p>

<p>The first method is to extend an interface and by adding that interface and the Extension methods namespace to your code file you get all those methods mixed into your class. Without the interface it doesn&#8217;t work. For simplicity I&#8217;ll use a IList in reality I would have somewhat more complex objects. There is only one thing that doesn&#8217;t feel too right to me and that is that every class you&#8217;re going to use it in needs to know about the extension methods location. I would like to see that if you implement it  on a class it gets propagated whenever you use an instance of that class. Anyway let&#8217;s see some code:</p>

<p>The first step is to define an interface that we can extend later.</p>

<p>using System.Collections.Generic;</p>

<p> </p>

<p>namespace Mixins.Mixins</p>

<p>{</p>

<p>    public interface IAuditable</p>

<p>    {</p>

<p>        IList<string> Auditors{ get; }</p>

<p>    }</p>

<p>}</p>

<p> </p>

<p>The next step is to define the extension methods</p>

<p>using System.Collections.Generic;</p>

<p> </p>

<p>namespace Mixins.Mixins.Auditable</p>

<p>{</p>

<p>    public static class AuditableMixin</p>

<p>    {</p>

<p>        public static bool HasBeenAudited(this IAuditable targetClass)</p>

<p>        {</p>

<p>            return targetClass.Auditors.Count > 0;</p>

<p>        }</p>

<p> </p>

<p>        public static bool HasBeenAuditedBy(this IAuditable targetClass, string name)</p>

<p>        {</p>

<p>            return targetClass.Auditors.Contains(name);</p>

<p>        }</p>

<p> </p>

<p>        public static IList<string> AddAuditor(this IAuditable targetClass, string name)</p>

<p>        {</p>

<p>            targetClass.Auditors.Add(name);</p>

<p>            return targetClass.Auditors;</p>

<p>        }</p>

<p> </p>

<p>        public static IList<string> RemoveAuditor(this IAuditable targetClass, string name)</p>

<p>        {</p>

<p>            if (HasBeenAuditedBy(targetClass, name))</p>

<p>            {</p>

<p>                targetClass.Auditors.Remove(name);</p>

<p>            }</p>

<p>            return targetClass.Auditors;</p>

<p>        }</p>

<p>    }</p>

<p>}</p>

<p>And the last step is to create an actual object that will have our mixin.</p>

<p>using Mixins.Mixins;</p>

<p>using System.Collections.Generic;</p>

<p> </p>

<p>//Extend our object with the mixin methods</p>

<p>using Mixins.Mixins.Auditable;</p>

<p> </p>

<p>namespace Mixins</p>

<p>{</p>

<p>    public class DataRecord : IAuditable</p>

<p>    {</p>

<p>        private List<string> auditors;</p>

<p> </p>

<p>        public DataRecord()</p>

<p>        {</p>

<p>            auditors = new List<string>();</p>

<p>        }</p>

<p> </p>

<p>        public string Name</p>

<p>        {</p>

<p>            get;</p>

<p>            set;</p>

<p>        }</p>

<p> </p>

<p>        public string Email</p>

<p>        {</p>

<p>            get;</p>

<p>            set;</p>

<p>        }</p>

<p> </p>

<p> </p>

<p>        #region IAuditable Members</p>

<p> </p>

<p>        public IList<string> Auditors</p>

<p>        {</p>

<p>            get { return auditors; }</p>

<p>        }</p>

<p> </p>

<p>        #endregion</p>

<p>    }</p>

<p>}</p>

<p> </p>

<p>Now to test it I used this console app:</p>

<p>using System;</p>

<p>using System.Collections.Generic;</p>

<p>using System.Linq;</p>

<p>using System.Text;</p>

<p> </p>

<p>// Extend our object with the mixin methods</p>

<p>using Mixins.Mixins.Auditable;</p>

<p> </p>

<p>namespace Mixins</p>

<p>{</p>

<p>    class Program</p>

<p>    {</p>

<p>        static void Main(string[] args)</p>

<p>        {</p>

<p>            DataRecord record = new DataRecord();</p>

<p>            record.AddAuditor(&#8220;Ivan Porto Carrero&#8221;);</p>

<p>            record.AddAuditor(&#8220;Kirk Jackson&#8221;);</p>

<p> </p>

<p>            Console.WriteLine(&#8220;The current auditors are: &#8220;);</p>

<p>            record.Auditors.ToList().ForEach(auditor => Console.WriteLine(auditor));</p>

<p> </p>

<p>            Console.WriteLine();</p>

<p> </p>

<p>            record.RemoveAuditor(&#8220;Kirk Jackson&#8221;);</p>

<p>            Console.WriteLine(&#8220;The current auditors are (after removal): &#8220;);</p>

<p>            record.Auditors.ToList().ForEach(auditor => Console.WriteLine(auditor));</p>

<p> </p>

<p>        }</p>

<p>    }</p>

<p>}</p>

<p>The second way I had in mind doesn&#8217;t provide everything I get from this first way and was by extending a base class. I&#8217;ll drop that explanation and just go for the conclusion.</p>

<p> </p>

<p>As I said before the only thing that doesn&#8217;t make extension methods to be complete mixins is the fact that you can&#8217;t actually mix it into a class, you can get really close but not all the way there. Now that isn&#8217;t such a huge problem, it gives you a bit more granular control. Another thought I have about this is, extension methods don&#8217;t have access to the private variables of your class only to the public interface of your class. That is also a limitation that proper mixins don&#8217;t have.</p>

<p> </p>

<p>What do you think ?</p>

<p> </p>

<p>del.icio.us Tags: <a href="http://del.icio.us/popular/C#%203.0">C# 3.0</a>,<a href="http://del.icio.us/popular/mixins">mixins</a>,<a href="http://del.icio.us/popular/programming">programming</a></p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  
    <article class="blogpost row">
      
  <div class="post-heading"> 
    



    <p class="date">20</p>  
    <div class="month-year"><p><span>Nov</span><br />2007</p></div>



    
      <div class="post-title">
        <h5>
          <a href="/2007/11/20/testing-ssl-on-vista/" title="">Testing SSL on Vista</a>
        </h5>
      </div> 
    
    <div class="clear"></div>
  </div>
  <!-- end of post heading -->
  
  <!-- start of post meta -->
  <div class="post-meta">
    <p>
       
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

       
     </p>  
  </div>
  <!-- end of post meta -->
  


  <div class="entry-content"><p>Today I had the requirement to add SSL encryption to some of the pages in one of my projects.</p>

<p>To test this I remembered that IIS6 had a tool SelfSSL and tried to use that.. failing my first attempt I also saw a folder OpenSSL in my tools folder. At which point i turned to google and google came up with this <a href="http://weblogs.asp.net/scottgu/archive/2007/04/06/tip-trick-enabling-ssl-on-iis7-using-self-signed-certificates.aspx">link to Scott Gu&#8217;s blog</a>. I&#8217;m stoked about the fact that IIS7 has this ability built into it. Following the steps he outlines there helped me get going really quickly.</p>

<p>Thanks  Scott :)</p>
</div>
  
  


    </article>
    <!-- divider for blog post -->
    <div class="divider"></div>
  
  <div class="pagination">
    
      <a class="prev" href="/page/8/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/6/">Newer &rarr;</a>
    
  </div>
</div>
</div>


      </div>
    </div>
    <footer role="contentinfo"><!-- start of footer container -->
  <div class="container">
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="twelve columns">
        <div class="logo">
          <img src="/images/logo.png" alt="" />
          <h2>Rants &amp; ramblings</h2>
        </div>
      </div>

      <div class="four columns">        
        <h6>Social networks</h6>
        <ul class="social_network">
          <li class="rollover"><a href="http://facebook.com/ivanportocarrero" class="yellowtip" title="Facebook"><span class="fb-rollover"></span><img src="/images/social/fb.png" alt="" /></a></li>
          <li class="rollover"><a href="http://twitter.com/casualjim" class="yellowtip" title="Follow me"><span class="twitter-rollover"></span><img src="/images/social/twitter.png" alt="" /></a></li>
          <li class="rollover"><a href="https://plus.google.com/u/1/106536131996809745163/posts" class="yellowtip" title="Google plus"><span class="google-rollover"></span><img src="/images/social/google-plus.png" alt="" /></a></li>
        </ul>       
      </div>
    </div>
    <!-- end of row -->
  
    <!-- start of row - 4 widget columns -->
      <div class="row clearfix">
      <div class="eight columns">
        <h6>About me</h6>
        <p>
        Welcome to my blog. This is a collection of random thoughts and rants.
        </p>
        <p>
        Allow me to introduce myself. My name is Ivan Porto Carrero and I'm an enthusiastic developer on  Scala, .NET and Ruby.<br />Through this blog I hope I can share some of that passion and maybe help somebody out when they are looking on how to do something.
        </p>
      </div>
      <div class="four columns">
        <h6>Latest posts</h6>
        <ul class="square">
        
          <li>
            <a href="/2011/08/01/backchat-developers/">work for backchat</a>
          </li>
        
          <li>
            <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
          </li>
        
          <li>
            <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
          </li>
        
          <li>
            <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
          </li>
        
          <li>
            <a href="/2009/11/08/a-good-url-regular-expression-repost/">A good url regular expression? (repost)</a>
          </li>
        
        </ul> 
      </div>
      <div class="four columns">
        <h6>Browse pages</h6>
        <ul class="square">
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archives</a></li>
          <li><a href="/projects">My projects</a></li>
        </ul> 
      </div>
    </div>
    <!-- end of row -->
    

    <!-- start of footer divider -->
    <div class="sixteen columns">
      <div class="footer-divider row"></div>
    </div>  
    <!-- end of footer divider -->
    
    <!-- start of bottoms -->
    <div class="clearfix footnote">
      <div class="eight columns">
        <p class="copyright">Copyright &copy; 2012 - Ivan Porto Carrero - All Right Reserved</p>
      </div>
      <div class="eight columns">
        <p class="align-right"><span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, designed by <a href="http://iweb-studio.com" target="_blank">iwebstudio</a></p>
      </div>
    </div>
    <!-- end of bottoms -->

  </div>
  <!-- end of footer container -->

</footer>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'casualjim';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<p id="back-top">
  <a href="#top"><span></span>To top</a>
</p>

</body>
</html>
