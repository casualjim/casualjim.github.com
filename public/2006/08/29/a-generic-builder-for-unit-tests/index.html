
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A generic builder for unit tests - Ivan Porto Carrero</title>
  <meta name="author" content="Ivan Porto Carrero">

  
  <meta name="description" content="I&#8217;ve been using base4 quite a lot lately
:). And obviously I like it. But anyway for unit testing i found myself writing
virtually the same &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://flanders.co.nz/2006/08/29/a-generic-builder-for-unit-tests">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Ivan Porto Carrero" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-240612-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ivan Porto Carrero</a></h1>
  
    <h2>IO(thoughts) foreach (_.propagandize)</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:flanders.co.nz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Generic Builder for Unit Tests</h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-29T11:45:06+02:00" pubdate data-updated="true">Aug 29<span>th</span>, 2006</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&#8217;ve been using <a href="http://www.base4.net/">base4</a> quite a lot lately
:). And obviously I like it. But anyway for unit testing i found myself writing
virtually the same builder class over and over again.</p>

<p>And since it is just test data that needs to be removed later it is always
very similar. I started thinking about my problem and came to the conclusion
that I could easily enough build a generic class that iterates over the object
and takes all the properties that belong to that type and not to any of the
parent types and fill them with valid data for their returntype.</p>

<p>I got to work and not so long after that I came up with the following class:</p>

<pre><code>                    using System;





                    using System.Collections.Generic;





                    using System.Text;





                    using Base4.Storage;
</code></pre>

<p> </p>

<pre><code>                    namespace NBlogr.NUnitTests.HelperClasses
</code></pre>

<p>{</p>

<p>    publicclassBuilder where T : class,IItem,new()</p>

<p>    {</p>

<p>        privateList items;</p>

<p> </p>

<p>        publicList Items</p>

<p>        {</p>

<p>            get</p>

<p>            {</p>

<p>                if (items == null) items = newList();</p>

<p>                return items;</p>

<p>            }</p>

<p>            set { items = value; }</p>

<p>        }</p>

<p> </p>

<p>        publicvirtual T Add()</p>

<p>        {</p>

<p>            return Add(null);</p>

<p>        }</p>

<p> </p>

<p>        public T Add(int? index)</p>

<p>        {</p>

<p>            T t = new T();</p>

<p>            return Add(t, index, true);</p>

<p>        }</p>

<p> </p>

<p>        publicvirtual T Add(T t, int? index, bool generateValues)</p>

<p>        {</p>

<p>            IItem item = t;</p>

<p>            if (generateValues)</p>

<p>            {</p>

<p>                foreach (PropertyImpl p in item.TypeDefinition.Properties)</p>

<p>                {</p>

<p>                    switch (p.ReturnTypeName)</p>

<p>                    {</p>

<p>                        case&#8221;bool&#8221;:</p>

<p>                        case&#8221;Boolean&#8221;:</p>

<p>                        case&#8221;System.Boolean&#8221;:</p>

<p>                            item[p.Name] = index.HasValue;</p>

<p>                            break;</p>

<p>                        case&#8221;string&#8221;:</p>

<p>                        case&#8221;String&#8221;:</p>

<p>                        case&#8221;System.String&#8221;:</p>

<p>                            if (index.HasValue)</p>

<p>                                item[p.Name] = string.Format(&#8220;Unittest {0} {1}&#8221;, item.TypeDefinition.Name, index);</p>

<p>                            else</p>

<p>                                item[p.Name] = string.Format(&#8220;Unittest {0}&#8221;, item.TypeDefinition.Name);</p>

<p>                            break;</p>

<p>                        case&#8221;uint&#8221;:</p>

<p>                        case&#8221;short&#8221;:</p>

<p>                        case&#8221;int&#8221;:</p>

<p>                        case&#8221;long&#8221;:</p>

<p>                        case&#8221;Int16&#8221;:</p>

<p>                        case&#8221;Int32&#8221;:</p>

<p>                        case&#8221;Int64&#8221;:</p>

<p>                        case&#8221;System.Int16&#8221;:</p>

<p>                        case&#8221;System.Int32&#8221;:</p>

<p>                        case&#8221;System.Int64&#8221;:</p>

<p>                            item[p.Name] = index.HasValue ? index.Value : newRandom().Next();</p>

<p>                            break;</p>

<p>                        case&#8221;byte&#8221;:</p>

<p>                        case&#8221;Byte&#8221;:</p>

<p>                        case&#8221;System.Byte&#8221;:</p>

<p>                            item[p.Name] = index.HasValue ? Convert.ToByte(index.Value) : newbyte();</p>

<p>                            break;</p>

<p> </p>

<p>                        case&#8221;double&#8221;:</p>

<p>                        case&#8221;Double&#8221;:</p>

<p>                        case&#8221;System.Double&#8221;:</p>

<p>                            item[p.Name] = index.HasValue ? Convert.ToDouble(index.Value) : newRandom().NextDouble();</p>

<p>                            break;</p>

<p> </p>

<p>                        case&#8221;byte[]&#8221;:</p>

<p>                        case&#8221;Byte[]&#8221;:</p>

<p>                        case&#8221;System.Byte[]&#8221;:</p>

<p>                            Byte[] bytes = newbyte[128];</p>

<p>                            Random rnd = newRandom();</p>

<p>                            rnd.NextBytes(bytes);</p>

<p>                            item[p.Name] = bytes;</p>

<p>                            break;</p>

<p> </p>

<p>                        case&#8221;Guid&#8221;:</p>

<p>                        case&#8221;System.Guid&#8221;:</p>

<p>                            item[p.Name] = Guid.NewGuid();</p>

<p>                            break;</p>

<p>                    }</p>

<p>                }</p>

<p>            }</p>

<p>            item.Save();</p>

<p> </p>

<p>            items.Add((T)item);</p>

<p> </p>

<p>            return item as T;</p>

<p>        }</p>

<p> </p>

<p>        publicvoid BuildList()</p>

<p>        {</p>

<p>            BuildList(5);</p>

<p>        }</p>

<p> </p>

<p>        publicvoid BuildList(int length)</p>

<p>        {</p>

<p>            if (items == null) items = newList();</p>

<p> </p>

<p>            for (int i = 0; i &lt; length; i++)</p>

<p>            {</p>

<p>                int index = i + 1;</p>

<p> </p>

<p>                Add(index);</p>

<p>            }</p>

<p> </p>

<p>        }</p>

<p> </p>

<p>        publicvoid CleanUp()</p>

<p>        {</p>

<p>            if (items != null &amp;&amp; items.Count> 0)</p>

<p>            {</p>

<p>                foreach (IItem item in items)</p>

<p>                {</p>

<p>                    item.Delete();</p>

<p> </p>

<p>                }</p>

<p>            }</p>

<p>        }</p>

<p>    }</p>

<p>}</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ivan Porto Carrero</span></span>

      








  


<time datetime="2006-08-29T11:45:06+02:00" pubdate data-updated="true">Aug 29<span>th</span>, 2006</time>
      

<span class="categories">
  
    <a class='category' href='/categories/-net-2-0/'>.NET 2.0</a>, <a class='category' href='/categories/base4/'>Base4</a>, <a class='category' href='/categories/c-/'>C#</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://flanders.co.nz/2006/08/29/a-generic-builder-for-unit-tests/" data-via="casualjim" data-counturl="http://flanders.co.nz/2006/08/29/a-generic-builder-for-unit-tests/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2006/08/24/aptana-for-writing-atlas-script/" title="Previous Post: Aptana for writing atlas script">&laquo; Aptana for writing atlas script</a>
      
      
        <a class="basic-alignment right" href="/2006/08/29/did-teched-have-an-impact/" title="Next Post: Did Teched have an impact">Did Teched have an impact &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/09/03/scalatra-is-a-dsl-in-a-string/">Scalatra is a DSL in a string</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/01/backchat-developers/">work for backchat</a>
      </li>
    
      <li class="post">
        <a href="/2010/09/30/radical-language-and-platform-shift/">Radical language and platform shift</a>
      </li>
    
      <li class="post">
        <a href="/2010/03/12/video-of-fosdem-ironruby-presentation/">Video of FOSDEM IronRuby presentation</a>
      </li>
    
      <li class="post">
        <a href="/2009/12/01/adding-a-console-to-your-ironruby-application/">Adding a console to your IronRuby application</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/casualjim">@casualjim</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'casualjim',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("casualjim", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/casualjim" class="twitter-follow-button" data-show-count="false">Follow @casualjim</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/casualjim?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/casualjim">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/106536131996809745163?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Ivan Porto Carrero -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'casualjim';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
